# Liferay 認証

**概要**

* 認証は、誰がアプリケーションへのログインを許可されるかを決定する。
* 認可は、ログイン後に許可されることを決定する。
* Liferayは強固できめ細かな認可機能を提供します。
* LiferayはOAuth 2.0をサポートし、LiferayユーザーがLiferayの**外**に存在するアプリケーションにアクセスできるようにします。
* 強固なセキュリティは、OWASPのトップ10で最も重要視されている。

```{note}
* 本モジュールのライブワークショップの[録画](https://learn.liferay.com/web/guest/d/se1-2-public-pages-experience) をご覧ください。
* 上記ワークショップで使用されたプレゼンテーション資料はこちら [PDF](https://learn.liferay.com/documents/d/guest/se1-2-public-pages-experience-pdf)からダウンロードしてください。
```

## 承認

認証は、ユーザーがログインを許可されるかどうかを決定する。 承認,

* 認証されたユーザーができることを決定します。
* サイト、ページ、コンテンツ、画像、ドキュメントなどの資産へのアクセスを制限する。
* 閲覧、編集、作成、削除など、さまざまな **レベル** のアクセスを提供します。
* Liferayでは、RoleにPermissionを割り当て、UsersにRoleを付与することで定義します。

Liferayの権限付与機能は、ユーザが見ることができるものだけでなく、アセットを編集できるか、新しいものを作成できるか、既存のものを削除できるかなど、ユーザができることもコントロールできることを見込み客に呼びかけることが重要です。

Liferayは、システムのほぼすべての側面に対して、1つまたは複数のRoleに異なるパーミッション（表示、編集、作成など）を付与し、ユーザーが1つまたは複数のRoleに所属できるようにするためのきめ細かいモデルを提供します。

これにより、異なるタイプのユーザーが同じアセットに対して異なるインタラクションを行うことができる。 通常のユーザーはページを見ることができますが、管理者はそのページを編集したり、削除したりすることができます。

## Liferay認証とOAuth 2.0

Liferayの認可機能は、認証されたユーザーがLiferayアプリケーション内でどのようにやり取りできるかを決定します。

これらのネイティブ認可機能に加え、Liferayは業界標準の認可プロトコルであるOAuth 2.0をサポートしています。

OAuth 2.0はLiferayと共に使用し、認証されたLiferayユーザーにLiferayの一部ではないリソースやアプリケーションへのアクセスを許可することができます。 これはわかりやすく言えば、隣人が「私が休みの間、猫に餌をやるために私の家に入ることを許可します」と言っているようなものだ。

LiferayのデモがLiferayのOAuth 2.0機能のデモを含む必要がある可能性は非常に低いです。 しかし、見込み客のインフォセック・チームが関心を持つ可能性は高い。 さらに、LiferayのClient ExtensionはOAuth 2.0を利用しているので、Client Extensionはシームレスかつ安全にLiferayのリソースにアクセスすることができます。

LiferayとClient Extensions間のOAuth通信プロセスの例を以下に示します。

![Liferay と Client Extensions 間の OAuth 通信プロセスの例。](./authorization/images/01.png)

## 認可を示すためのヒント

**インコグニート・ブラウザ・セッション**

* インコグニート・ブラウザ・セッションを使用して、セカンド・ユーザーとして同時にログインする。
* ユーザーによってシステムがどのように見え、どのように振る舞うかを簡単に示すことができる：
  * さまざまな結果を表示する検索ページ。
  * 異なる内容を持つコレクション表示。
  * など。

**パーミッションはほとんどのものに適用される**

* 特定のアプリケーション（ウィジェット）の権限を削除することで、劇的に異なる見た目のページを表示することができます。
* ユーザーが特定のページを閲覧する権限を持っていない場合、そのページはナビゲーションに表示されません。

**パーミッションはAPIにも適用される**

* パーミッション、つまり認可はLiferay UIからのアクセスに適用されます。
* パーミッションはLiferayのHeadless APIを使ったアクセスにも適用されます。

**パーソナライゼーションの導入**

* オーソライゼーションは、パーソナライゼーションと「エクスペリエンス」を導入する機会を提供する。
* 情報へのアクセスを制限することが有効な場合もある。権限を与えなければ、可能な限りのアクセスをロックアウトしてしまうからだ。
* これは非常に二元的なもので、ユーザーはアクセス権を持つか持たないかのどちらかである。
* 多くの場合、特定の情報を特定の時間に表示し、ユーザーに見てもらいたいものを案内する必要があるかもしれないが、アクセスを完全にブロックする必要はないかもしれない。
* パーソナライゼーションは、ユーザー・セグメントを作成し、セグメントに結びついたページのエクスペリエンスを構築することで、これをサポートする方法を提供します。
* 各エクスペリエンスは、希望するもの、またはそのセグメントに属するユーザーに関連する可能性のあるものを正確に表示できます。
* 必要でない場合は、権限を使用してアクセスをブロックしないことが重要です。 ほとんどのアプリケーションでは、権限**と**パーソナライゼーションの組み合わせが必要です。

## 認証と認可の位置づけ

![Liferayのハイレベルなアーキテクチャは、認証と認可の機能を提供し、セキュリティーが必要なものはすべてセキュリティーを確保できるようにしています。](./authorization/images/02.png)

認証と認可に関するデモを行う際には、認証と認可のレベルがどこにあるのか、ハイレベルな概要を示すとよい。

見込み客は、Liferayがトップレベルの認証と認可のメカニズムを持っており、すべてが安全であることがわかります。

つまり、Liferayにアクセスしようとするユーザーやシステムは、それがユーザーインターフェイスであれAPIであれ、Liferayに保存されている情報、あるいは外部システムとの統合によって公開される情報にアクセスする前に、まず認証され、次に認可されなければなりません。

## 認証と認可の広範な意味合い

強力な認証と認可機能は、あらゆるウェブベースのアプリケーションの重要な検討事項です。 認可に関連する重要なトピックは、OWASPトップ10である。

* OWASP（オープン・ワールドワイド・アプリケーション・セキュリティ・プロトコル）は、ソフトウェアのセキュリティ向上に取り組む非営利団体である。
* OWASP Top 10 は、ウェブアプリケーションにとって最も重大なセキュリティリスクに関するガイダンスを提供します。
* 「ブロークン・アクセス・コントロール」の重要性はますます高まっている。 2017年は5位だったが、2021年には1位に躍り出た。

不正アクセスに対する保護は、議論すべき非常に重要なトピックであり、顧客または見込客が有する法令遵守と説明責任を考慮に入れる。

実績のあるセキュアなプラットフォームがあれば、信頼は高まります - そしてそれは、Liferayの能力の中核をなすものです。

## レベル1を超える高度なアプローチ！

このセクションでは、デモで使用される可能性のある追加のアプローチをいくつか紹介するが、これらは通常、最初の30分間のデモではカバーされない：

* キークローク
* 認証0
* Azure AD
* 多要素認証

**キークローク**

シングルサインオンを実証する必要があり、Oktaのようなサービスが利用できない場合、Keycloakのインスタンスを実行することが可能だ。 Keycloakは、IDとアクセス管理でシングルサインオンを可能にするオープンソースのソフトウェア製品である。

Liferayのコンサルタントの一人が、Keycloakのセットアップ手順を網羅した [ブログ](https://liferay.dev/blogs/-/blogs/liferay-sso-step-by-step)。

**認証0**

Okta の Auth0 のようなサードパーティ・サービスを使用して、SAML または OpenID Connect 認証を設定することができる。

Liferayはこの種のサービスをすぐにサポートし、動作させるために必要なのは基本的な設定だけです。

**Azure AD**

SAMLをサポートしているMicrosoft Azure ADを使用する方法もある。

**多要素認証**

もちろんLiferayの認証メカニズムには多要素認証モジュールがあり、設定することができます。

## 概要

おめでとうございます-これでこのモジュールは終わりです。

ここで重要なのは、デモでさまざまな認証と認可の方法について話し始めるポイントは、ログインが行われるときだということだ。

一部の顧客にとっては、Liferayのネイティブな認証・認可機能で十分でしょう。

SAMLを使用してイントラネットを構築し、シングルサインオンを実装する、あるいはOpenID Connectを介して既に存在する認証情報をユーザーに使用させるなど、他の多くの要件については、Liferayがすぐに提供する幅広い機能について説明することが重要です。

一度認証されれば、ネイティブできめ細かなロールとパーミッション機能によって提供される柔軟性と、OAuth 2.0を使用して外部リソースへのアクセスも認証できる機能が相まって、顧客は自社のアプリケーションが安全、セキュアでアクセス可能であることを確信できるはずだ。

次へ [エクスペリエンス・マネジメント](../experience-management.md).
