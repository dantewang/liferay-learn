# プラットフォームの制限

Liferay Cloudとそのサービスには、サブスクリプションレベルに応じて、いくつかの顕著な制限があります。 制限事項は、Liferay Cloudのインフラに変更が加えられた場合、時間の経過とともに変更される可能性があります。

## 概要

Liferay Cloudの利用を計画する際には、これらの一般的な制限を考慮してください。

* 各サービスの利用可能なvCPU、メモリ、スケーリング、ネットワーク設定　(ドメイン、SSL証明書、IPアドレス）、VPN帯域幅に制限があります。 例えば、各サービスは最大200GBのRAMに制限されています。 カスタムドメインも、 [Webサーバーの設定に応じて、50または1500に制限されています](#network-configuration) 。

* 同時操作(同時アップロードなど）、ビルドサイズ、同時ビルド、バックアップにも制限があります。

* 特にLiferayまたはSearchサービスの単一インスタンスを使用している環境では、計画的なメンテナンスのためにサービスのダウンタイムが発生することがあります。

* より厳格なセキュリティ、コンプライアンス、またはVPNの要件を満たすためには、プライベートクラスターのサブスクリプションが必要になる場合があります。

* Liferay Cloudでは、リモートステージングはサポートされていません。

詳細は以下の項目を参照してください。

* [すべてのサービス](#all-services)
* [Liferayサービス](#liferay-service)
* [データベースサービス](#database-service)
* [検索サービス](#search-service)
* [バックアップサービス](#backup-service)
* [Webサーバーサービス](#web-server-service)
* [継続的インテグレーションサービス](#continuous-integration-service)
* [カスタムサービス](#custom-services)
* [セキュリティ](#security)
* [ファイル ストレージ](#file-storage)
* [ネットワーク設定　](#network-configuration)
* [VPNサーバー](#vpn-servers)

## すべてのサービス

これらの制限は、Liferay Cloud環境のすべてのサービスに適用されます。

**古いログへのアクセス** : デフォルトでは、各サービスの過去30日分のログがコンソールから利用できます。 [サポートリクエストを送信する](https://help.liferay.com/) 古いアプリケーションログ(最大1年前まで）にアクセスする。 ステータスログやビルドログは、30日を過ぎると取得できなくなります。

**サービスごとの追加インスタンス** : [`スケール` 設定](../manage-and-optimize/auto-scaling.md) は、当初、お客様の契約プランの購入インスタンス数を使用します。 デフォルトでは、Searchを除き、サービスは1つのインスタンスを追加することができます。 Searchサービスでは、奇数個のインスタンスを使用する必要があります。

**ダウンタイム** : Liferay Cloudのインフラが定期メンテナンスのために更新された場合、単一インスタンスで動作しているサービスが再起動することがあります。 本番環境では、高可用性設定(WebサーバーとLiferayサービスは各2インスタンス、Searchサービスは3インスタンス）にして、混乱を回避してください。 計画的なメンテナンスのスケジュールは [こちら](https://help.liferay.com/hc/ja/articles/360032562611-DXP-Cloud-Platform-Maintenance-and-Release-Schedule) で確認できます。

**サービスインスタンスあたりのメモリ** : サービスは最大200GBのRAMを持つことが可能で、これはお客様の契約プランによって決定されます。 デフォルトのプランでは、1サービスあたり16GBとなっています。

**サービスインスタンスあたりの仮想CPU** : サービスは最大32個のvCPUを持つことが可能で、これは契約プランによって決定されます。

## Liferayサービス

これらの制限は、各Liferay Cloud環境における [Liferayサービス](../customizing-liferay-dxp-in-the-cloud/using-the-liferay-dxp-service.md) に適用されます。

**リモートステージング** : [リモート本番環境ステージングの設定](https://learn.liferay.com/w/dxp/site-building/publishing-tools/staging/configuring-remote-live-staging) はLiferay Cloudでは利用できません。 ローカルステージングは引き続き利用可能で、サポートされています。

**Auto-scaling** : 有効な場合、オートスケーリングは、デフォルトの最大10までしか新しいインスタンスを追加できない。 最大100個のインスタンスまで、異なる最大数のインスタンスを構成できます。

**ドキュメントライブラリストレージ** ：サブスクリプションプランにより、Liferayサービスの `データ`のボリュームが決められます。 これには、Liferayのドキュメントライブラリに使用されるストレージが含まれます。 デフォルトのボリュームサイズは100GBですが、4TB以下であればサイズを増やすことができます。 プロジェクトに4TBを超えるストレージが必要な場合は、プライベートクラスターが必要です。

**セッションレプリケーション** ：Liferay Cloud内の複数のLiferayインスタンス間でセッションをレプリケートすると、インスタンスのパフォーマンスに影響を与える可能性があり、サポートされていません。 <!-- Instead, use sticky sessions, or avoid using session storage entirely in your custom applications. -->

### Dynatrace

[Dynatrace](../manage-and-optimize/application-metrics.md#advanced-application-metrics-production-only) は、Liferay Cloud 環境のStandard セットアップには含まれませんが、別途購入することで併用することが可能です。 Dynatraceは高可用性の設定に含まれていますが、本番環境またはUAT環境にのみ適用されます。

これらの制限は、Dynatraceに適用されます。

**Dynatrace Metrics Discrepancy** ：DynatraceのメトリクスがLiferay Cloud Consoleに表示されているメトリクスと一致しません。 これは、DynatraceがJVMプロセスのメトリクスを表示するのに対し、コンソールのメトリクスはJVMをホストするコンテナ全体を測定するためです。

**Liferay Logのストリーミング** : Liferay LogをDynatraceログにストリーミングすることはできません。

**Session Replay** : Liferay CloudではDynatrace Session Replayの機能は使用できません。

## データベースサービス

これらの制限は、各Liferay Cloud環境の[Database サービス](../platform-services/database-service/database-service.md)に適用されます。

**Database Metrics** : Liferay Cloudコンソールに表示されるメトリクスは、個々のサービスメトリクスではなく、サービスコンテナのデータを反映しています。

**データベースのサイズ** ：通常、データベースの最大サイズは100GBです。 [この制限を増やすには、サポートリクエスト](https://help.liferay.com/) を提出してください。

**ダウンタイム** ：データベースのメンテナンスにより、数ヶ月に一度、ダウンタイムが発生することがあります。 このダウンタイムは通常2分程度です。 これは、事前に通知がない場合もあります。 ダウンタイムの影響を軽減するために、 [優先メンテナンスウィンドウ](../platform-services/database-service/database-service.md#database-maintenance-window-variables) を設定することができます。

**Read/write splits** ：データベースサービスでのread/write splitの構成は、Liferay Cloudではサポートされていません。

## 検索サービス

これらの制限は、各 Liferay Cloud 環境の [Search サービス](../platform-services/search-service.md) に適用されます。

**設定** ：Elasticsearchは、Liferay UIでは **なく** 、Liferay Cloudワークスペースから設定する必要があります。 プロジェクトのワークスペースにある設定ファイルは、デプロイのたびに使用され、以前の設定が上書きされます。

**メモリ設定** ：Elasticsearchサーバーのデフォルト(および最大）のJVMヒープサイズは4GBです。 最大割り当て数は、お客様のサブスクリプションプランによって決まります。

**OS Packages** : 検索サービス用に追加のOSパッケージをインストールすることはサポートされていません。

**Pod Management Policy** : クラスター内のElasticsearchノードが正常に起動するためには、ノード同士が接続されている必要があります。 起動するサービスの問題を避けるために、複数のインスタンスを使用している検索サービスの場合、 `LCP.json` ファイルの中の`podManagementPolicy` の値を` parallel ` に設定する必要があります。

## バックアップサービス

これらの制限は、各Liferay Cloud環境の[バックアップサービス](../platform-services/backup-service/backup-service-overview.md)に適用されます。

**Backup Consistency** ：データが変更されたデータベースからコピーする他のプロセスと同様に、更新の実行中にバックアップが作成された場合、データベース内のデータとドキュメントライブラリ間の整合性は保証されません。 完全に一貫したバックアップを行うためには、データベース管理者と調整して、 [手動バックアップ](../platform-services/backup-service/backup-service-overview.md#creating-a-manual-backup) を行っている間は更新をフリーズするようにしてください。

**バックアップサイズ** : Liferay Cloudバージョン 4.2.0以前、バックアップは [エフェメラルストレージ](#file-storage) を使用していました。 これらのバージョンでは、バックアップのサイズは、共有のエフェメラルディスクの残りのスペースに制限されています。

**バックアップのアップロード** : 1分間に1つのバックアップしかアップロードできません。

**同時操作** : バックアップの作成、復元、アップロードの同時実行はサポートされていません。 ただし、同時ダウンロードには対応しています。

**リソースの割り当て** : Backupサービスに割り当てられるRAMとvCPUの数は、サブスクリプションプランによって決定されます。 デフォルトでは、サービスに2つのvCPUと1GBのRAMが割り当てられています。

**アップロード/ダウンロード速度** : バックアップのアップロードまたはダウンロードの速度は、インターネットの接続速度とバックアップのサイズによって制限されます。 非常に遅い回線では、バックアップのダウンロードに数時間かかる場合があります。

## Webサーバーサービス

これらの制限は、各Liferay Cloud環境の [Webサーバーサービス](../platform-services/web-server-service.md) に適用されます。

**プラグイン** ：Webサーバーの追加プラグインのインストールはサポートされていません。

**リソースの割り当て** : Webサーバーはデフォルトで2つのvCPUと512MBのメモリを搭載しています。 そのため、大容量のアップロードやダウンロードの際には、応答が遅くなることがあります。 お客様のサブスクリプションプランによって、サービスの具体的なリソース配分が決まります。

## 継続的インテグレーションサービス

これらの制限は、各Liferay Cloud環境の[CIサービス](../platform-services/continuous-integration.md)に適用されます。

**管理者アクセス** : 管理者レベルのアクセスはJenkinsサーバでは許可されていません。 代わりに、 [Jenkinsパイプラインフック](../platform-services/continuous-integration.md#extending-the-default-jenkinsfile) を使ってCIパイプラインを拡張します。 既存のDevOpsプロセスは、このパイプラインに合わせて調整する必要があるかもしれません。

**APIの同時呼び出し** ：プロジェクトはLiferay Cloud APIへの同時呼び出しを行うことはできません。 これには、 [CLIツール](./command-line-tool.md)を使ってビルドを環境にデプロイするといったタスクが含まれます。

**リソースの割り当て** ：CIサービスに割り当てられるRAMとvCPUの数は、サブスクリプションプランによって決定されます。 デフォルトでは、サービスに4つのvCPUと8GBのRAMが割り当てられています。

**サーバーの容量** ：サブスクリプション・プランによって、CIサーバーのデータ・ボリュームのサイズが決まります。  デフォルトのサイズは100GBです。

### ビルド

これらの制限は、プロジェクト内で作成されたすべてのビルドに適用されます。

**ビルドサイズ** ：個々のビルドはそれぞれ2GBに制限されています。 リポジトリ内のプロジェクトの合計サイズがこの制限以下であることを確認する必要があります。

**同時ビルド** ： Jenkinsでは2つのエクゼキュータ・スレッドが使用されるため、最大2つの同時ビルドが実行可能です。

**1日あたりの最大ビルド数** ：ビルドは1日あたり300回までとなります。 [この制限を増やすには、サポートリクエスト](https://help.liferay.com/) を提出してください。

**プライベート GitHub サーバー** ：プライベート GitHub サーバーとの統合はサポートされていません。

## カスタムサービス

これらの制限は、Liferay Cloud環境における [カスタムサービス](../platform-services/using-a-custom-service.md) に適用されます。

**ホストOSアクセス** ：ホストOSカーネルへの特権的なアクセスは、プライベート・クラスターを含むサブスクリプションに限定されます。

## セキュリティ

これらの制限は、Liferay Cloud内で利用可能なセキュリティ機能に適用されます。

**アンチウイルス** ：ファイルアップロード時にウイルスをスキャンするためのデフォルトのLiferayDXP機能は使用できません。 Liferay Cloud の [アンチウイルスソリューション](./liferay-cloud-infrastructure.md#antivirus) が代わりに使用されます。 アップロードされたコンテンツはスケジュールに沿ってスキャンされるため、ファイルがアップロードされた時点ではリスクが検出されない場合があります。

**1分あたりの認証** ：1分あたり最大8400の認証が許可されます。

**ファイアウォールルール** : プライベートクラスタ付きのサブスクリプションを購入し、Liferay Cloud Supportと調整してカスタムファイアウォールルールを設定する必要があります。 カスタムファイアウォールルールは、共有クラスタサブスクリプションでは使用できません。 プライベートクラスター用に作成されたカスタムファイアウォールルールは、プロジェクト内のすべての環境に適用されます。

**IPアドレスフィルタリング** ：IPアドレスフィルタリングは、Webサーバーサービスにのみ適用できます。

## ファイル ストレージ

これらの制限は、複数のサービスのファイル保存に適用されます。

**Ephemeral Storage** ：ボリュームに保存されていないすべてのファイルに使用されます。 Ephemeral Storageは、ホストノードの内部ストレージに配置され、そのノード上で動作するすべてのコンテナ間で共有されます。 コンテナがホストノードの空き容量以上のスペースを要求した場合、そのコンテナは別のノードに移動されます。 ホストディスクの容量は250GBです。

**サービス間でのデータの共有** ：StatefulSet [配布タイプ](../updating-services-in-liferay-paas/understanding-deployment-types.md) のサービスは、他のサービスとデータを共有できません。

**StatefulSetストレージサイズ** ：[デプロイメントタイプ](../updating-services-in-liferay-paas/understanding-deployment-types.md)サービスのストレージを追加するには、サポートチケットを作成する必要があります。 StatefulSetサービスの保存サイズは、一度大きくすると縮小できません。

## ネットワーク設定　

これらの制限は、Liferay Cloud環境におけるお客様のサービスのネットワーク構成に適用されます。

**カスタムドメインへの変更** ：カスタムドメインへの変更や追加がプロパゲートされるまで、最大で60分程度の遅延が発生する場合があります。

**最大カスタムドメイン数** ：(デフォルトのWebサーバーに加えて）複数のサービスを環境外に公開している場合、最大[カスタムドメイン数](../configuring-the-cloud-network/custom-domains.md)が50個まで設定されています。 ただし、Webサーバーが唯一のエントリーポイントである場合には、1500個のカスタムドメインの制限を使用することができます。 この制限を超えて使用量を増やすためにWebサーバーサービスを変更する場合は、 [サポートチケットを開設](https://help.liferay.com/) する必要があります。

**最大SSL証明書** ：最大14個のカスタムSSL証明書を許可します。 また、証明書を発行するプロバイダーは、これを少なくするために独自の制限を課すことがあります。

**アウトバウンド接続** ：プロジェクト環境から外部エンドポイントへの接続は、1接続あたり120秒のタイムアウトを伴うNATソリューションを使用します。 短時間に次々と新しい接続が作成されると、ポートの枯渇や送信トラフィックのドロップにつながる可能性があります。 コネクションプーリングは、この問題を防ぐことができます。

**パブリックIPアドレス** ：デフォルトでは、すべての環境は1つのパブリックIPアドレスを持ち、環境内のサービスは内部IPアドレスを持ちます。 ただし、サービスのポートを外部に設定し、サービスにパブリックIPアドレスを割り当てることは可能です。 インターネットにサービスのエンドポイントを公開するのは **推奨されていません** 。なぜなら、 [HTTPSロードバランサ](../configuring-the-cloud-network/load-balancer.md)からDDoS防御を迂回するからです。

**ワイルドカードSSL証明書** ：ワイルドカード証明書はLiferayの自動生成SSL証明書ではサポートされていません。 ただし、カスタムワイルドカードSSL証明書でインスタンスを設定　することができます。

**TCPポートの状態** : TCPポートの中には、そのポートを使用して外部からのトラフィックが顧客の環境に到達していなくても、オープンと表示されるものがあります。 これらのポートは、サーバーの同じディスクを共有している他のプロジェクトのために開かれており、ユーザーの環境のセキュリティ上のリスクはありません。

## VPNサーバー

これらの制限は、お客様の環境で [VPNサーバー](../configuring-the-cloud-network/vpn-integration-overview.md)をサービスに接続している場合に適用されます。

**Site-to-Site VPN** ：Site-to-Site VPN サーバーは、Google Cloud VPN でのみ設定　できます。 また、プライベートクラスターのサブスクリプションが必要です。

**帯域幅** ：各VPNトンネルの総帯域幅は3Gbpsに制限されています。 この制限は、受信トラフィックと送信トラフィックの合計に適用されます。

**オンプレミスのネットワークを拡張する** ：オンプレミス・ネットワークからのCloud InterconnectやExpress Routeの専用接続はサポートされていません。 これは、直接またはパートナープロバイダーを経由した接続、共有またはプライベートクラスターでの接続に適用されます。
