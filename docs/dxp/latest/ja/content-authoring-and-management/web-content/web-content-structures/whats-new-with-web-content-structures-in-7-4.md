# Liferay 7.4におけるWebコンテンツストラクチャーの新機能

Liferay 7.4以降、Webコンテンツストラクチャーはフォームを構築するバックエンドのフレームワークとして、DDM（動的データマッピング）からDE（データエンジン）に移行されました。

![Webコンテンツストラクチャーは、データエンジンフレームワークを元にしたフォームビルダーで構築されます。](./whats-new-with-web-content-structures-in-7-4/images/04.png)

データエンジンフレームワークは、Webコンテンツストラクチャーに新たな変更と機能拡張をもたらします。

## 改良された新しいフィールドタイプ

データエンジンへの移行に伴い、フィールドタイプを追加し、改良しました。

- ［Select from List］フィールドのオプションをアルファベット順に並べることができます（［Select from List］フィールドの詳細設定を使用します）。
- 数値フィールドを整数または小数のフィールドとして設定します。
- グリッドフィールドは、［Webコンテンツ］と［ドキュメントとメディア］の新しいフィールドタイプです。 [フォーム項目タイプのリファレンス](../../../process-automation/forms/creating-and-managing-forms/forms-field-types-reference.md)を参照してください。
- HTMLフィールドは、便利なツールバーを備えたリッチテキストフィールドに変更されました。

```{warning}
**ブール値と複数選択フィールド:** データエンジンは当初 ブール値フィールドを搭載していませんでした。 代わりに、アップグレードされたストラクチャーのブール値フィールドは、データエンジンの複数選択フィールドを使用するように移行され、同じラベルと1つのオプションだけを使用するようになりました。 これにより、いくつかの問題が発生する可能性があります（例：ブール値フィールドを持つストラクチャー上でテンプレートが構築された場合など）。 Liferay 7.4 アップデート/GA 23で、データエンジンにブール値項目タイプが追加されました。 アップデート23以降にアップグレードされたストラクチャーは、Webコンテンツストラクチャーの7.3 DDMブール値フィールドを7.4 DE ブール値フィールドに正常に変換します。 この変更以前にインストールをアップグレードした場合は、該当するストラクチャーを編集して、これらの単一オプションの複数選択フィールドをブール値フィールドに手動で変更する必要があります。 
```

## 子ストラクチャーをストラクチャーフィールドセットに置き換える

DDMでバックアップされたストラクチャーは、親のフィールドと設定をすべて継承した子ストラクチャーを含むことができます。 Liferay 7.4では、フィールドセットを作成できるようになったので、この関係はもはや存在しません。同様に、ストラクチャーに対して再利用可能なフィールドセットを作成できるようになりました。 フィールドセットを使用すると、ストラクチャーがどのように見えるかを確認しながら編集できるため、編集の効率が向上します。

```{warning}
- フィールドセットは、複数のストラクチャーにまたがって再利用可能です。 単一のストラクチャー内で編集すると、すべてのストラクチャーに一度に変更が加えられます。

- フィールドセットやストラクチャーがWebコンテンツで使用されている場合、編集するとユーザーへの警告が表示されます：

   ![コンテンツ参照を持つストラクチャーやフィールドセットの編集に注意してください。](./whats-new-with-web-content-structures-in-7-4/images/09.png)
```

フィールドセットと連動するには、以下を行います。

1. ［Webコンテンツストラクチャー］フォームビルダービューで、 _［Fieldsets］_ タブをクリックします。
1. _［Create New Fieldset］_ をクリックします。 フィールドセットに名前を付けます。
1. そのフィールドを追加し、設定します。 _［保存］_ をクリックします。

![ストラクチャーまたは専用のフィールドセットをストラクチャーで使用します。](./whats-new-with-web-content-structures-in-7-4/images/07.png)

新しいストラクチャーの作成を開始すると、既存のフィールドセットやストラクチャーが［Fieldsets］タブで選択できるようになります。 基本Webコンテンツストラクチャーは、標準のフィールドセットとして含まれています。

## ストラクチャー定義ソースの変更

DEではストラクチャーがJSONで表されます（DDMではXMLでした）。 WebコンテンツストラクチャーUIでソースを編集することなく、ストラクチャー定義をインポートおよびエクスポートして、ストラクチャーのソースJSONをローカルで操作できるようになりました。

```{warning} 
JSONストラクチャーのソースは、一見すると複雑なので、注意して作業してください。 例えば、ストラクチャーにフィールドを追加する場合、 `dataDefinitionFields`配列と`defaultDataLayout`要素の両方を更新しなければなりません。 
```

ストラクチャーのJSONをエクスポートするには、以下の手順に従います。

1. サイトメニュー &rarr;［コンテンツとデータ］&rarr;［Web Content］に移動します。
1. _［Structures］_ タブをクリックします。
1. 既存のストラクチャーがない場合は、ストラクチャーを作成し、保存します。
1. メインストラクチャーのリスト表示で、アクションメニューを開き、_［Export as JSON］_ をクリックします。

既存のストラクチャーにストラクチャーJSONをインポートします（つまり、既存のストラクチャーJSONを上書きする）。

1. サイトメニュー &rarr;［コンテンツとデータ］&rarr;［Web Content］に移動します。
1. _［Structures］_ タブをクリックします。
1. メインストラクチャーのリスト表示で、ストラクチャーのアクションメニューを開き、_［Import and Override］_ をクリックします。
1. JSONファイルをアップロードします。

![WebコンテンツストラクチャーのJSONをエクスポートおよびインポートします。](./whats-new-with-web-content-structures-in-7-4/images/01.png)

新しいストラクチャーをインポートします。

1. サイトメニュー &rarr;［コンテンツとデータ］&rarr;［Web Content］に移動します。
1. _［Structures］_ タブをクリックします。
1. 画面右上の［Web Content］のオプションメニューを開きます。
1. _［Import Structure］_ をクリックします。

   ![JSONストラクチャーファイルをインポートします。](./whats-new-with-web-content-structures-in-7-4/images/02.png)

## フレキシブルなストラクチャーレイアウト

以前は、ストラクチャー項目はフォーム上で順序付けされ、ネストされてフォームの階層的なビューを作成することができました。 ストラクチャーデータエンジン表示では、列を定義する機能が追加されています。

![1行に2列のストラクチャーを作成します。](./whats-new-with-web-content-structures-in-7-4/images/08.png)

ストラクチャービルダーで2つのフォーム項目を隣同士に追加し、フィールドの端をドラッグして列のサイズを変更します。

列だけでなく、フィールドグループを使って、ストラクチャーのフィールドのサブセットをロックして、簡単に管理できます。 フィールドを他のフィールドの上にドロップして、フィールドグループを作成します。

## Webコンテンツストラクチャーキーの設定

1. ［システム設定］&rarr; ［Webコンテンツ］（［コンテンツとデータ］の下）&rarr; ［管理］にアクセスします。 _［自動生成ストラクチャーキー］_ のチェックを外します。

1. サイトメニュー &rarr;［コンテンツ&データ］&rarr;［Webコンテンツ］に移動します。 ［ストラクチャー］タブを開き、新しいストラクチャーを追加します。

1. フィールドを追加し、ストラクチャーに名前を付けます。 ストラクチャーキーを手動で設定するには、設定アイコン (![Configuration](../../../images/icon-cog3.png)) をクリックして、プロパティサイドバーを開きます。

1. _［ストラクチャーキー］_ フィールドを編集し、カスタム値を追加します（例： `MY_STRUCTURE_KEY`）。

1. ストラクチャーを保存します。

新しいデータエンジンに基づくストラクチャーでは、エクスポート処理でJSONからストラクチャーキーが取り除かれます。 つまり、定義を（例えば新しいサイトに）インポートすると、新しいストラクチャーキーが生成されます。 エクスポートとインポートのプロセスでストラクチャーキーを保持したい場合、または新しいカスタムキーを提供したい場合は、エクスポートされたJSONを編集する必要があります。

[エクスポートされたJSON](#structure-definition-source-changes)にカスタムストラクチャーキーを追加するには、以下の手順に従います。

1. エクスポートしたJSONファイル（例： `Structure_my structure_42153_20220721144913685.json`）を開きます。
1. `"dataDefinitionField"`要素の前に`"dataDefinitionKey"`要素を追加します。
   ```json
   {
      "availableLanguageIds": ["en_US"],
      "contentType": "journal",
      "dataDefinitionKey": "MY_STRUCTURE_KEY",
      "dataDefinitionFields": [{"..."}]
   }
   ```

1. ストラクチャー定義ファイルを[インポート](#structure-definition-source-changes)して、キーがインポートされたことを［Properties］タブで確認します。

   ![［プロパティ］タブには、ストラクチャーキーがカスタムキーであるか、Liferayによって自動生成されたかに関わらず、ストラクチャーキーが表示されます。](./whats-new-with-web-content-structures-in-7-4/images/11.png)
