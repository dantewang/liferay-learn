# 類似結果

{bdg-primary}`サブスクリプション`

{bdg-link-secondary}` [DXP 7.3 および 7.4 にバンドル、DXP 7.2 SP2+/FP5+のLiferay マーケットプレイス](https://web.liferay.com/marketplace/-/mp/application/172465398) `

```{note}
この機能は、[Elasticsearchのみ](../installing-and-upgrading-a-search-engine/solr/solr-limitations.md) で機能します。
```

類似結果ウィジェットには、ページで選択されたメインアセットに類似した検索結果が表示されます。

主なアセットの概念は重要です。 DXPの特定のウィジェットは、アセットのリストを表示します：アセットパブリッシャー、ブログ、ウィキなど。 ユーザーが表示されたアセットの1つをクリックし、ウィジェットがそのすべてのコンテンツをページ上に表示する場合、それはページの **メインアセット** です。 Similar Results ウィジェットを同じページに配置すると、 [More Like This クエリ](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-mlt-query.html) で返されるような類似アセットのリストを表示します。 メインアセットという概念は、Elasticsearch の [入力ドキュメント](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-mlt-query.html#_how_it_works) と同義です。

類似結果は、入力ドキュメント/メインアセットを使用して、クエリに最も一致するものとして自分自身を返すクエリを作成し、この選言クエリ（または `OR`）を検索エンジンに送信して、一致する結果ドキュメントを返します。 このプロセスは構成可能です。入力ドキュメントを処理する方法、処理されたコンテンツから用語を選択する方法、およびクエリ自体を形成する方法です。 [詳細](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-mlt-query.html#_parameters_2) は、Elasticsearchのドキュメントを参照してください。

## 検索結果ウィジェットの構成

1. [新規ページの作成](../../site-building/creating-pages/adding-pages/adding-a-page-to-a-site.md) または [既存ページの編集](../../site-building/creating-pages/using-content-pages/adding-elements-to-content-pages.md)

1. **Add**( ![Add widget icon](../../images/icon-add-widget.png) ) をクリックして、Fragments and Widgets パネルを開きます。

1. ウィジェットタブの検索カテゴリーで、 **Similar Results** ウィジェットをページ上の任意の場所にドラッグします。

1. 類似結果ウィジェット &rarr; **構成** の右上にある **アクション**( ![Actions icon.](../../images/icon-actions.png) ) をクリックします。

   ![類似結果ウィジェットの表示設定を構成します。](./similar-results/images/01.png)

利用可能なプロパティの全リストについては、 [Similar Results Configurations](#similar-results-configurations) を参照。

## 類似結果ウィジェットの使用

類似結果ウィジェットがページに配置されるとどうなるかは、ページに現在表示されているコンテキストとアセットによって異なります。 ページでメインアセットが選択されていない場合、類似結果には何も表示されません。ページのスペースは空白のままです。 サイト管理者には次の情報メッセージが表示されます。

**類似の結果は存在しません。**

メインアセットのドキュメントが検出されると、ウィジェットは、設定された [ウィジェットテンプレート](#similar-results-widget-templates) によって指定されたフォーマットで表示された、同じアセットタイプの類似した結果を表示します。

2つの使用例を検討して詳細ヘルプを確認してください。

## ユースケース1：アセットパブリッシャーページでの類似結果

アセットパブリッシャーでアセットを選択すると、同じアセットタイプの類似結果（一致する検索ヒットとして返される結果）が表示されます。

この例を構成するには、

1. ウィジェットページを作成します。 ［Asset Publisher］ウィジェットと ［Similar Results］ウィジェットを追加します。

   ![アセット・パブリッシャー・ウィジェットと類似結果ウィジェットを備えたページ。](similar-results/images/02.png)

1. [Asset Publisher's configuration Display Settings にアクセスし、Asset Link Behavior を Show Full Content に設定してください。](../../site-building/displaying-content/using-the-asset-publisher-widget/configuring-asset-publisher-display-settings.md)

   これにより、選択したアセット表示がアセットパブリッシャー内でコンテンツ全体を表示します。 **View On New Page** を選択すると、アセットがネイティブで存在するページにリダイレクトされるため、Similar Results ウィジェットは役に立ちません。

1. 以下にリストされているタイプの類似のアセットを複数作成します。 それらが十分に類似していることを確認して、類似結果ウィジェットに結果が表示されるようにします。

   More Like Thisクエリで返されるアセットを作成するには、作成するアセットのコンテンツと、 [Similar Resultsウィジェットの設定](#similar-results-configurations) に注意してください。  テストの場合、 **最小用語頻度** と **最小文書頻度** 値を両方とも `1`に設定することをお勧めします。

   * ブログエントリー
   * ドキュメントとメディアファイル
   * ドキュメントとメディアフォルダー
   * Webコンテンツの記事
   * Webコンテンツフォルダー
   * Wikiページ
   * 掲示板スレッド
   * 掲示板のメッセージ
   * 掲示板カテゴリ

アセットパブリッシャーウィジェットで表示されたアセットをクリックすると、同様の結果が類似結果ウィジェットに表示されます。

![選択したアセットについても類似結果が表示されます。](similar-results/images/03.png)

類似結果の1つをクリックします。 アセットパブリッシャーはメインアセットを更新し、新しいメインアセットについて類似結果が再計算されます。

## ユースケース2：アセット表示ページでの類似結果

これらのウィジェットと付随するアセットは、それらのアセットのリストを表示し、類似結果ウィジェットのメインアセットとして使用するものを選択できます。

| ウィジェット名     | アセットタイプ                 |
| ----------- | ----------------------- |
| ブログ         | ブログエントリー                |
| ドキュメントとメディア | ドキュメントとメディアファイル、フォルダ    |
| Wiki        | Wikiページ                 |
| 掲示板         | 掲示板のスレッド、メッセージ、およびカテゴリー |

ブログでSimilar Resultsを使用する例を設定する、

1. ウィジェットページを作成します。 ブログウィジェットと類似結果ウィジェットを追加します。

1. 同じようなブログエントリーを複数作成する。 それらが類似していることを確認し、類似結果ウィジェットがそれらを結果として返すようにします。

   More Like Thisクエリで返されるアセットを作成するには、作成するアセットのコンテンツと、 [Similar Resultsウィジェットの設定](#similar-results-configurations) に注意してください。  テストの場合、 **最小用語頻度** と **最小文書頻度** 値を両方とも `1`に設定することをお勧めします。

1. ブログ・ウィジェットのブログ記事をクリックする。 ブログエントリーが表示され、類似結果ウィジェットには類似エントリーへのリンクが表示されます。

1. 類似結果の1つをクリックします。 そのブログコンテンツは、現在のページのブログウィジェットにレンダリングされます。

   ![類似結果ウィジェットは、他の類似したブログ記事を表示します。](similar-results/images/04.png)

## 類似結果ウィジェットテンプレート

デフォルトでは、類似結果は **コンパクトレイアウト**[ウィジェットテンプレート](../../site-building/displaying-content/additional-content-display-options/styling-widgets-with-widget-templates.md)を使用して描画され、ハイパーリンクされたタイトルのリストが表示されます。

2つのウィジェットテンプレートが最初から用意されています。 **リストレイアウト** と **カードレイアウト** です。

リストレイアウトです。

![リストレイアウトでは、結果の一覧とその概要が表示されます。](similar-results/images/05.png)

カードのレイアウトです。

![カードレイアウトでは、それぞれの結果がカードとして表示されます。](similar-results/images/06.png)

### 類似結果のカスタムウィジェットテンプレートを追加する

類似結果表示用の独自のウィジェットテンプレートを作成するには、

1. Similar Results ウィジェットの **Options** メニュー ( ![Options icon](../../images/icon-app-options.png) ) を開き、 **Configuration** をクリックする。

1. ［**テンプレートの管理**］ をクリックして、［ウィジェットテンプレート］画面を表示します。

1. **Add**( ![Add icon](../../images/icon-add.png) ) をクリックして、テンプレート作成パレットを開きます。

   標準の[ウィジェットテンプレート](../../site-building/displaying-content/additional-content-display-options/styling-widgets-with-widget-templates.md)変数に加え、テンプレートエディタで提供される検索専用の変数を活用します。

1. 好みに合わせてテンプレートをデザインしてください。 詳細は、 [ウィジェットテンプレート](../../site-building/displaying-content/additional-content-display-options/styling-widgets-with-widget-templates.md) ドキュメントをご覧ください。

同じテンプレートエディターには、［サイトメニュー］の［ サイトビルダー］ セクションの［ウィジェットテンプレートエントリー］からアクセスできます。

## 類似結果設定

最初の設定オプションは、［表示設定］というセクションに表示されます。

［**Display Template］：** ウィジェットテンプレートを選択して、類似結果の表示方法を設定します。

［**Maximum Item Display］：** ウィジェットに表示する結果の最大数を設定します。

詳細設定セクションでは、ウィジェットの動作を微調整するための設定を収集します。 これらの設定の多くは、 [ Elasticsearchのその他の類似結果](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-mlt-query.html) を設定するために使用されています。

| 詳細設定                                                | 定義                                                                                                                                                                                                                                               |
|:--------------------------------------------------- |:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| スコープ<br />{bdg-secondary}`Available 7.4 U17+` | ［このサイト］（デフォルト）と［すべて］から選択し、現在のサイト（このサイト）のみから類似結果を表示するか、すべてのサイト（すべて）に検索範囲を拡大します。                                                                                                                                                                   |
| リンクビヘイビア<br />{bdg-secondary}`利用可能 7.4 U18+`  | クリックした結果を同じ表示ページに表示する（Show Content）か、そのコンテキストに表示する（View On New Page；例えば、別のページの表示ウィジェットに表示する）かを、Show Content（デフォルト）とView On New Pageから選択します。                                                                                                      |
| 項目                                                  | 別のアセットがメインアセットと一致するかどうかを判断するためにコンテンツが使用されるキーワードまたはテキストフィールドをカンマ区切りのリストで指定します。                                                                                                                                                                    |
| 最大クエリ用語数                                            | メインアセットから展開するクエリ用語の最大数を設定します。 これらは、検索結果をメインアセットに一致させるために使用される用語です。 この値を大きくすると、実行速度が低下することで、返される結果の関連性が高まります。 空白のままにすると、デフォルトは`25`です。                                                                                                             |
| 最小用語頻度                                              | 類似結果のマッチングに使用するために、ある用語がインデックスに表示される回数の最小しきい値を設定します。 空白のままにすると、デフォルトは`2`です。                                                                                                                                                                      |
| 最小文書頻度                                              | その他の類似結果クエリの作成に用語を使用するために、その用語を含むドキュメントの数の最小閾値を設定します。 空白のままにすると、デフォルトは`5`です。                                                                                                                                                                     |
| 最大文書頻度                                              | Set 類似した結果のマッチングに使用するために、ある用語が出現する可能性のあるインデックス内の文書数の最大閾値。 これを使用して、ストップワードなどの頻繁に使用される単語を無視します。 空白のままにすると、上限は設定されません。                                                                                                                              |
| 最小単語長                                               | 単語の長さの最小値を設定すると、それ以下の単語はその他の類似結果クエリから除外されます。 空白のままにすると、デフォルトは`0`です。                                                                                                                                                                              |
| 最大単語長                                               | 最大単語長を設定し、それ以上の単語はその他の類似結果クエリから除外されます。 空白のままにすると、上限は設定されません。                                                                                                                                                                                     |
| ストップワード                                             | 似たような結果を見つけるために無視すべき、面白みのないストップワードの配列（コンマで区切られたリスト）。 設定されたアナライザでストップワードが許可されている場合、これらは完全にその他の類似結果クエリへの送信を避けることができます。                                                                                                                             |
| アナライザー                                              | 入力ドキュメントのフィールドに使用するアナライザーを指定します。 空白のままにすると、デフォルトでフィールド構成の最初のエントリに関連付けられたアナライザーになります。                                                                                                                                                             |
| 最低必須一致                                              | 選言クエリが形成された後、このパラメータは、一致しなければならない用語の数をコントロールします（デフォルトは `30%`）。 使用できる構文については、 [Elasticsearchのドキュメント](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-minimum-should-match.html#query-dsl-minimum-should-match) 参照してください。 |
| 用語ブースト                                              | [tf-idf](https://en.wikipedia.org/wiki/Tf%E2%80%93idf) のスコアで用語をブーストしたい場合に使用するブーストファクターを設定します。 空白の場合、このデフォルトは無効になります (`0`)。 その他の正の値は、指定されたブーストファクタで用語ブーストを有効にします。                                                                                  |
| 統合検索キー                                              | このウィジェットが参加している代替検索のキーを入力してください。                                                                                                                                                                                                                 |
