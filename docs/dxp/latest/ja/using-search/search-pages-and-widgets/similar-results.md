# 類似結果

{bdg-primary}`サブスクリプション`

{bdg-link-secondary}`DXP 7.3 および 7.4 にバンドル、DXP 7.2 SP2 /FP5 用 LiferayLiferay マーケットプレイス<https://web.liferay.com/marketplace/-/mp/application/172465398>`。

類似結果ウィジェットには、ページで選択された **メインアセット** に類似した検索結果が表示されます。

主なアセットの概念は重要です。 DXPの特定のウィジェットには、アセットのリストが表示されます。アセットパブリッシャー、ブログ、Wikiなどです。 ユーザーが表示されたアセットの1つをクリックし、ウィジェットがそのすべてのコンテンツをページ上に表示する場合、それはページの **メインアセット** です。 類似結果ウィジェットは、同じページに配置されている場合、 [**その他の類似結果** クエリ](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-mlt-query.html) によって返されるのに十分に類似しているアセットのリストを表示します。 メインアセットの概念は、Elasticsearchの [**入力ドキュメント**](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-mlt-query.html#_how_it_works) と同義です。

類似結果は、入力ドキュメント/メインアセットを使用して、クエリに最も一致するものとして自分自身を返すクエリを作成し、この選言クエリ（または `OR`）を検索エンジンに送信して、一致する結果ドキュメントを返します。 このプロセスは構成可能です。入力ドキュメントを処理する方法、処理されたコンテンツから用語を選択する方法、およびクエリ自体を形成する方法です。 [詳細](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-mlt-query.html#_parameters_2) は、Elasticsearchのドキュメントを参照してください。

## 類似結果ウィジェットの構成

1. メニューを追加（![Add](../../images/icon-add-widget.png)） &rarr; ［ウィジェット］ &rarr; ［検索］をクリックし、［類似結果］ウィジェットをページにドラッグします。

1. 構成するには、ウィジェットの［オプション］メニュー（![Options](../../images/icon-app-options.png)）を開き、［**構成**］をクリックします。

    ![類似結果ウィジェットの表示設定を構成します。](./similar-results/images/01.png)

使用可能なプロパティの完全なリストは、</a>下

にあります。</p> 



## 類似結果ウィジェットの使用

類似結果ウィジェットがページに配置されるとどうなるかは、ページに現在表示されているコンテキストとアセットによって異なります。 ページでメインアセットが選択されていない場合、類似結果には何も表示されません。ページのスペースは空白のままです。 サイト管理者には次の情報メッセージが表示されます。

**類似の結果は存在しません。**

メインアセットのドキュメントが検出されると、ウィジェットは同じアセットタイプの同様の結果を表示し、設定された [ウィジェットテンプレート](#similar-results-widget-templates) 指定された形式で表示されます。

2つの使用例を検討して詳細ヘルプを確認してください。



## ユースケース1：アセットパブリッシャーページでの類似結果

アセットパブリッシャーでアセットを選択すると、同じアセットタイプの類似結果（一致する検索ヒットとして返される結果）が表示されます。

この例を構成するには、

1. ウィジェットページを作成します。 ［Asset Publisher］ウィジェットと ［Similar Results］ウィジェットを追加します。
   
   ![アセットパブリッシャーウィジェットと同様の結果ウィジェットを持つページ。](similar-results/images/02.png)

1. Asset Publisherの構成の［表示設定］に移動し、Asset Link Behaviorを［すべて表示する］ に **設定します** 。
   
   これにより、選択したアセット表示がアセットパブリッシャー内でコンテンツ全体を表示します。 **コンテキストの参照** を選択すると、アセットがネイティブに存在するページにリダイレクトされ、類似結果ウィジェットが役に立たなくなります。

1. 以下にリストされているタイプの類似のアセットを複数作成します。 それらが十分に類似していることを確認して、類似結果ウィジェットに結果が表示されるようにします。
   
   その他の類似結果によって返されるアセットを作成するには、作成するアセットのコンテンツと [類似結果ウィジェットの構成](#similar-results-configurations) 注意してください。  テストの場合、 **最小用語頻度** と **最小文書頻度** 値を両方とも `1`に設定することをお勧めします。

    * ブログエントリー
    * ドキュメントとメディアファイル
    * ドキュメントとメディアフォルダー
    * Webコンテンツの記事
    * Webコンテンツフォルダー
    * Wikiページ
    * 掲示板スレッド
    * 掲示板のメッセージ
    * 掲示板カテゴリ

アセットパブリッシャーウィジェットで表示されたアセットをクリックすると、同様の結果が類似結果ウィジェットに表示されます。

![選択したアセットについても類似結果が表示されます。](similar-results/images/03.png)

類似結果の1つをクリックします。 アセットパブリッシャーはメインアセットを更新し、新しいメインアセットについて類似結果が再計算されます。



## ユースケース2：アセット表示ページでの類似結果

これらのウィジェットと付随するアセットは、それらのアセットのリストを表示し、類似結果ウィジェットのメインアセットとして使用するものを選択できます。

| ウィジェット名     | アセットタイプ                |
| ----------- | ---------------------- |
| ブログ         | ブログエントリー               |
| ドキュメントとメディア | ドキュメントとメディアファイル、フォルダ   |
| Wiki        | Wikiページ                |
| 掲示板         | 掲示板のスレッド、メッセージ、およびカテゴリ |


ブログで類似結果を使用する例を構成するには、

1. ウィジェットページを作成します。 ブログウィジェットと類似結果ウィジェットを追加します。

1. 同様のブログエントリーを複数作成します。 それらが類似していることを確認し、類似結果ウィジェットがそれらを結果として返すようにします。
   
   その他の類似結果によって返されるアセットを作成するには、作成するアセットのコンテンツと [類似結果ウィジェットの構成](#similar-results-configurations) 注意してください。  テストの場合、 **最小用語頻度** と **最小文書頻度** 値を両方とも `1`に設定することをお勧めします。

1. ブログウィジェットのブログ投稿をクリックします。 ブログのエントリが表示され、類似結果ウィジェットに類似エントリーへのリンクが表示されます。

1. 類似結果の1つをクリックします。 そのブログコンテンツは現在のページのブログウィジェットに描画されています。
   
   ![類似結果ウィジェットは、他の類似したブログ記事を表示します。](similar-results/images/04.png)



## 類似結果ウィジェットテンプレート

デフォルトでは、類似結果は **コンパクトレイアウト** [ウィジェットテンプレート](https://help.liferay.com/hc/ja/articles/360029132571-Styling-Widgets-with-Widget-Templates) を使用して描画され、ハイパーリンクされたタイトルのリストが表示されます。

2つのウィジェットテンプレートが最初から用意されています。 **リストレイアウト** と **カードレイアウト** です。

リストレイアウトです。

![リストレイアウトでは、結果の一覧とその概要が表示されます。](similar-results/images/05.png)

カードのレイアウトです。

![カードレイアウトでは、それぞれの結果がカードとして表示されます。](similar-results/images/06.png)



### 類似結果のカスタムウィジェットテンプレートを追加する

類似結果表示用の独自のウィジェットテンプレートを作成するには、

1. 類似結果ウィジェットの［オプション］メニュー（![Options](../../images/icon-app-options.png)）を開き、［**構成**］をクリックします。

1. ［**テンプレートの管理**］ をクリックして、［ウィジェットテンプレート］画面を表示します。

1. ［追加］ボタン（![Add](../../images/icon-add.png)）をクリックして、テンプレートクリエーターパレットを開きます。
   
   標準の [ウィジェットテンプレート](https://help.liferay.com/hc/ja/articles/360029132571-Styling-Widgets-with-Widget-Templates) 変数に加え、テンプレートエディタで提供される検索専用の変数を活用します。

1. 好みに合わせてテンプレートをデザインしてください。 詳細は、 [ウィジェットテンプレート](https://help.liferay.com/hc/ja/articles/360029132571-Styling-Widgets-with-Widget-Templates) ドキュメントをご覧ください。

同じテンプレートエディターには、［サイトメニュー］の ［**サイトビルダー**］ セクションの［ウィジェットテンプレートエントリー］からアクセスできます。



## 類似結果設定

最初の設定オプションは、 ［**表示設定**］ というセクションに表示されます。

![類似結果設定で異なるオプションを設定する。](similar-results/images/01.png)

［**Display Template］：** ウィジェットテンプレートを選択して、類似結果の表示方法を設定します。

［**Maximum Item Display］：** ウィジェットに表示する結果の最大数を設定します。

**Advanced Configuration** セクションでは、ウィジェットの動作を微調整するための設定を集めています。 これらの設定の多くは、 [ Elasticsearchのその他の類似結果](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-mlt-query.html) を設定するために使用されています。

| 詳細設定                                            | 定義                                                                                                                                                                                                                                               |
|:----------------------------------------------- |:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| {bdg-secondary}`利用可能 7.4 U17`<br />スコープ   | ［このサイト］（デフォルト）と［すべて］から選択し、現在のサイト（**このサイト**）のみから類似結果を表示するか、すべてのサイト（**すべて**）に検索範囲を拡大します。                                                                                                                                                               |
| {bdg-secondary}`利用可能 7.4 U18`<br />リンクの動作 | クリックした結果を同じ表示ページに表示する（**コンテンツの表示**）か、そのコンテキストに表示する（**すべて** ；例えば、 [表示ページテンプレート](../../site-building/displaying-content/displaying-content-intro.md#display-page-template) や他のサイトでのそのコンテキスト）かを、コンテンツの表示（デフォルト）とコンテキストの参照のどちらかで選択します。                      |
| フィールド                                           | 別のアセットがメインアセットと一致するかどうかを判断するためにコンテンツが使用されるキーワードまたはテキストフィールドをカンマ区切りのリストで指定します。                                                                                                                                                                    |
| 最大クエリ用語数                                        | メインアセットから展開するクエリ用語の最大数を設定します。 これらは、検索結果をメインアセットに一致させるために使用される用語です。 この値を大きくすると、実行速度が低下することで、返される結果の関連性が高まります。 空白のままにすると、デフォルトは`25`です。                                                                                                             |
| 最小用語頻度                                          | 類似結果のマッチングに使用するために、ある用語がインデックスに表示される回数の最小しきい値を設定します。 空白のままにすると、デフォルトは`2`です。                                                                                                                                                                      |
| 最小文書頻度                                          | その他の類似結果クエリの作成に用語を使用するために、その用語を含むドキュメントの数の最小閾値を設定します。 空白のままにすると、デフォルトは`5`です。                                                                                                                                                                     |
| 最大文書頻度                                          | Set 類似した結果のマッチングに使用するために、ある用語が出現する可能性のあるインデックス内の文書数の最大閾値。 これを使用して、ストップワードなどの頻繁に使用される単語を無視します。 空白のままにすると、上限は設定されません。                                                                                                                              |
| 最小単語長                                           | 単語の長さの最小値を設定すると、それ以下の単語はその他の類似結果クエリから除外されます。 空白のままにすると、デフォルトは`0`です。                                                                                                                                                                              |
| 最大単語長                                           | 最大単語長を設定し、それ以上の単語はその他の類似結果クエリから除外されます。 空白のままにすると、上限は設定されません。                                                                                                                                                                                     |
| ストップワード                                         | 似たような結果を見つけるために無視すべき、面白みのないストップワードの配列（コンマで区切られたリスト）。 設定されたアナライザでストップワードが許可されている場合、これらは完全にその他の類似結果クエリへの送信を避けることができます。                                                                                                                             |
| アナライザー                                          | 入力ドキュメントのフィールドに使用するアナライザーを指定します。 空白のままにすると、デフォルトでフィールド構成の最初のエントリに関連付けられたアナライザーになります。                                                                                                                                                             |
| 最低必須一致                                          | 選言クエリが形成された後、このパラメータは、一致しなければならない用語の数をコントロールします（デフォルトは `30%`）。 使用できる構文については、 [Elasticsearchのドキュメント](https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-minimum-should-match.html#query-dsl-minimum-should-match) 参照してください。 |
| 用語ブースト                                          | [tf-idf](https://en.wikipedia.org/wiki/Tf%E2%80%93idf) のスコアで用語をブーストしたい場合に使用するブーストファクターを設定します。 空白の場合、このデフォルトは無効になります (`0`)。 その他の正の値は、指定されたブーストファクタで用語ブーストを有効にします。                                                                                  |
| 統合検索キー                                          | このウィジェットが参加している代替検索のキーを入力してください。                                                                                                                                                                                                                 |
