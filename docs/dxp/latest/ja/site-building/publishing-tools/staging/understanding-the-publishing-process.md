# 公開プロセスを理解する

公開設定は、ステージング環境で行われた変更が本番環境に転送されるプロセスです。 このプロセスを理解すると、効率が向上し、シームレスな公開エクスペリエンスを実現するための事前の計画に役立ちます。

* [ステージングプロセス](#the-staging-process)
* [ステージングのための事前計画](#planning-ahead-for-staging)

## ステージングプロセス

低レベルの観点から見ると、ステージングとは、同じエンティティが2つのサイトまたはアセットライブラリ間でミラーリングされる両者間の関係のことです。 高度な観点からは、ステージングには、エクスポート、検証、およびインポートの3つの連続したフェーズで実行される公開プロセスが含まれます。

```{important}
[カスタムフィールド](../../../users-and-permissions/users/adding-custom-fields-to-users.md)をリモートライブステージングで使用する場合、公開前に新しいカスタムフィールドをライブ環境へ手動でエクスポートおよびインポートする必要があります。 これは、カスタムフィールドはサイトスコープを持たないため、コンテンツの変更に伴って自動的にエクスポート/インポートすることができないからです。
```

### エクスポートフェーズ

エクスポート中に、公開設定が処理され、必要な参照エンティティが収集されます。 次に、すべてがインスタンス独自のファイル形式に処理され、ローカルに保存されるか、リモート本番環境のDXPインスタンスに転送されます。

### 検証フェーズ

検証中に、すべてがチェックされ、インポートプロセスを開始できるかどうかが判断されます。 これには、ファイルのバージョンと整合性の確認、追加のシステム情報（言語設定など）の確認、ファイルが欠落しているコンテンツを参照していないかどうかの確認が含まれます。

公開プロセス中に何も検証されない場合、トランザクションデータベースはサイトまたはアセットライブラリを元の状態に戻し、現在の公開プロセスを破棄します。 これは、不完全な情報の公開を防ぐために必要です。

ただし、ドキュメントライブラリのファイルシステムがデータベース（たとえば、 [DBStore](../../../system-administration/file-storage/other-file-store-types/dbstore.md) ）に保存されていない場合、それはトランザクションではないので、ステージングに失敗しても元には戻されません。 これにより、ファイルとデータベース内のファイルの参照との間に不一致が生じる可能性があります。 データの整合性を維持するには、ドキュメントライブラリをステージングする前に、データベースとファイルシステムの両方の定期的なバックアップが維持されていることを確認してください。

### インポートフェーズ

インポート中に、公開パラメーターに従って、サイトのコンテンツ、レイアウト、およびアプリに必要な更新または追加が行われます。 すべてが検証されて正しい場合、ステージコンテンツは本番環境サイトに公開されます。 アセットライブラリについても同様です。

## ステージングのための事前計画

ステージングは、柔軟性と拡張性を備えた複雑なサブシステムです。 サイトまたはアセットライブラリで使用する前に、事前に計画を立て、シームレスなプロセスのためのいくつかのヒントを覚えておくことが重要です。 評価するいくつかの要素があります。

### コンテンツの種類

サイトおよびアセットライブラリのコンテンツに応じて、初期設定時に必要なコンテンツの種類に対してのみステージングをオンにすることができます。 特定の種類のコンテンツのみを含めるように公開プロセスを設定することもできます。 これらの対策は両方とも、不要な作業を回避するのに役立ちます。

```{important}
デフォルトでは、動的データリスト(DDL)表示、フォーム、Webコンテンツの表示、およびWiki表示のウィジェットを使用して表示されるコンテンツは、公開プロセスに常に含まれています。 Liferay DXP/Portal 7.4以降では、この動作を無効にして、表示されるコンテンツが公開プロセスの構成に明示的に含まれている場合にのみ公開されるようにすることができます。 詳細については、 [表示されたコンテンツの自動公開の設定](./configuring-automatic-publishing-of-displayed-content.md) を参照してください。
```

### ハードウェア環境

コンテンツの種類に応じて環境を計画します。 サイトまたはアセットライブラリで大きな画像やビデオファイルを使用する場合は、共有ネットワークドライブが最適なオプションかどうかを判断してください。 ドキュメントライブラリに多くの大きな画像を保存するには、通常、より高速なネットワークまたはローカルストレージが必要です。 ただし、Webコンテンツであれば、通常は容量が小さくディスク領域をほとんど占有しません。

### ステージング環境のカスタマイズとカスタムロジック

組織のビジネスロジックはアプリに実装されている可能性が高く、そのアプリのステージングをサポートする場合は、そのためのコードを作成する必要があります。 ステージング環境のルックアンドフィールを変更する場合は、新しいJSPコードを記述してデフォルトのUI設定を変更することも検討できます。

### 公開設定の待ち時間

サイトまたはアセットライブラリの作成の開始時にステージングを有効にして、実行に時間がかかる巨大な公開処理を避けることができます。 小規模で段階的な変更のほうが、大規模に再構築するよりもはるかにパフォーマンスが高くなります。

### JVM/ネットワーク構成

ステージングでは、JVM /ネットワークは最低4GBのメモリと20MB/秒の転送速度（ディスク）で構成する必要があります。

## 関連トピック

* [ローカル現行環境ステージングの設定](./configuring-local-live-staging.md)
* [リモート本番環境ステージングの設定](./configuring-remote-live-staging.md)
