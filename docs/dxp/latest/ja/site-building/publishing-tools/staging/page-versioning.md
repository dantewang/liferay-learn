# ページバージョニング

ページのバージョン管理を有効にすると、サイトのページの複数のバージョンで並行して作業することができます。 異なるバージョンは *variation*と呼ばれ、ステージングバーからウィジェットページとコンテンツページに対して作成、管理することができます。 ページのバージョニングは履歴を管理し、必要に応じてステージングされたページに加えられた変更を以前のバージョンに戻すために使用します。

```{note}
Liferay DXP 7.4、7.3フィックスパック1、および7.2フィックスパック11以降では、ウィジェットページとコンテンツページにバリエーションを作成できます。 以前のLiferay DXPバージョンでは、ウィジェットページでのみバリエーションを作成できました。 これらのタイプのページのバリエーションの詳細については、 [Types of Variations](#types-of-variations) を参照してください。
```

*Staging Configuration* ページから、初期設定時またはそれ以降いつでもページのバージョニングを有効にすることができます。 有効にすると、個々のページまたはページのグループに対して、バリエーションの作成、結合、公開が可能になります。 さまざまなユーザーロールのバリエーション権限を管理することもできます。

## バリエーションの種類

ステージングには、2種類のバリエーションがあります。

* **サイトページバリエーション**: このタイプは、複数のサイトページの変更を1つのバリエーションにグループ化します。 ウィジェットページとコンテンツページの両方を含むことができます。

* **Page Variations**: このタイプは、個々のページのバリエーションを作成するためのものです。 サイトページバリエーション内に作成され、ウィジェットページでのみ利用可能です。

   ```{note}
   [Experiences](../../../site-building/personalizing-site-experience/experience-personalization/content-page-personalization.md) を使用して、異なるバージョンのコンテンツページを作成します。
   ```

ステージングサイトのすべてのバリエーションが同じコンテンツを共有するため、両方のバリエーションタイプはページにのみ影響し、サイトのコンテンツには影響しません。 つまり、各バリエーションは、同じコンテンツまたはアプリケーションを異なる方法で使用および構成することができ、各サイトページバリエーションは異なるページを含むことができます。

また、ページのメタデータはバージョン管理されていません（例：レイアウトの種類、フレンドリーURL）。 これは、メタデータの変更がすべてのバリエーションに適用されることを意味します。 例えば、ページのテンプレートが変更された場合、その変更はテンプレートからの変更を継承するように設定されたすべてのページに伝搬されます。

```{note}
ページテンプレートは、ステージングフレームワークによって認識されません。 これは、既存のページテンプレートがステージングされたサイトで表示または編集できないことを意味します。 ステージングされたサイトで作成されたテンプレートは、ステージングが無効になっていると失われます。
```

## バリエーションの作成

以下の手順で、ページまたはページのグループの新しいバリエーションを作成します。

1. ステージングバーの *アクション* ボタン ( ![Actions button](../../../images/icon-actions.png) ) をクリックし、 *サイトページバリエーション* ( ウィジェットページまたはコンテンツページ用 ) または *ページバリエーション* ( ウィジェットページのみ ) を選択します。

   ![ステージングバーの「アクション」ボタンをクリックし、作成したいバリエーションタイプを選択します。](./page-versioning/images/03.png)

1. モーダルウィンドウの右下にある「 *Add* 」ボタンをクリックします。

   ![モーダルウィンドウの右下にある [追加]ボタンをクリックします](./page-versioning/images/04.png)

1. 新しいバリエーションの*名前*と*説明*を入力します。 これらのフィールドは、バリエーションに合わせていつでも変更できます。

   ![新しいバリエーションの名前と説明を入力します。](./page-versioning/images/05.png)

   サイトページバリエーションでは、新しいバリエーションが既存のバリエーションからページをコピーするかどうかを、以下のオプションから選択することができます。

   * **全サイトページバリエーション**: 既存のサイトページバリエーションから全ページをコピーします。

   * **None (Empty Site Pages Variation)**: 新しい、空の Site Pages Variation を作成します。

   * **[既存のバリエーション]**: 1つのサイトページバリエーションからすべてのページをコピーします。

   ![新しいサイトページバリエーションが既存のバリエーションからページをコピーしているかどうかを判断します。](./page-versioning/images/06.png)

   ```{note}
   既存のバリエーションからページをコピーする場合、公開準備中とマークされた最新バージョンのみがコピーされます。
   ```

1. *追加* をクリックして、新しいバリエーションを作成します。

一度作成したページやページのグループは、ステージングバーのドロップダウンメニューで各バージョンを切り替えることができます。 詳細については、 [サイトステージングUIリファレンス](./site-staging-ui-reference.md) を参照してください。

![Stagingバーのドロップダウンメニューで、ページやページグループの各バージョンを切り替えることができます。](./page-versioning/images/02.png)

## バリエーションのマージ

2つのサイトページバリエーションを統合することができます。 これは、すべてのページとページバリエーションを、そのコンテンツに影響を与えたり上書きしたりすることなく、サイトページバリエーションに追加します。

1. Staging bar の *Actions* ボタン ( ![Actions button](../../../images/icon-actions.png) ) をクリックし、Site Pages Variation を選択します。

   ![ [サイトページバリエーション]を選択します。](./page-versioning/images/07.png)

1. マージするベースとして使用するバリエーションの *アクション* ボタン ( ![Actions button](../../../images/icon-actions.png) ) をクリックし、 *マージ*を選択します。

   ![統合のベースとするバリエーションの「アクション」ボタンをクリックし、「統合」を選択します。](./page-versioning/images/08.png)

1. ベースとなるバリエーションの上にマージするバリエーションを選択します。

   ![ベースとなるバリエーションの上にマージするバリエーションを選択します。](./page-versioning/images/09.png)

サイトページの2つのバリエーションがマージされると、ベースとなるバリエーションに存在しない新しいページが追加されます。 また、ページが両方のバリエーションで存在し、ページの少なくとも1つのバージョンが公開の準備ができているとマークされている場合、準備ができているとマークされた最新バージョンが、ベースとなるバリエーションの対応するページの新しいバリエーションとして追加されます。 公開の準備ができているとマークされていない古いバリエーションはコピーされません。

## バリエーション権限の管理

パーミッションを使用して、バリエーションへのユーザーのアクセスを管理することができます。 詳細は、[ステージング権限の管理](./managing-staging-permissions.md)を参照してください。

## 追加情報

* [ステージングの概要](../staging.md)
* [ローカル現行環境ステージングの設定](./configuring-local-live-staging.md)
* [リモート本番環境ステージングの設定](./configuring-remote-live-staging.md)
* [サイトステージングUIリファレンス](./site-staging-ui-reference.md)
