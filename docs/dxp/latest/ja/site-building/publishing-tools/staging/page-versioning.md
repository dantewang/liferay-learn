# ページバージョニング

ページバージョニングを有効にすると、サイトのウィジェットページの複数のバージョンを並行して作業することができます。 これらのバージョンは *variations*と呼ばれ、ステージングバーで作成・管理することができます。 ページのバージョニングは履歴を管理し、ステージングされたページに加えられた変更を、必要に応じて以前のバージョンに戻すことができます。

```{note}
ステージングでは、ウィジェットページのバリエーションとページ履歴のみをサポートしています。 コンテンツページのバージョニングには、Publicationsを使用します。 詳しくは、[出版ツールの比較](../comparing-publishing-tools.md)をご覧ください。
```

ページのバージョニングは、ページの初期設定時、またはその後いつでも Staging Configuration ページから有効にすることができます。 有効にすると、個々のページまたはページのグループに対して、バリエーションの作成、結合、公開が可能になります。 また、ユーザーロールごとにバリエーションパーミッションを管理することもできます。

```{important}
ページのバージョニングを使用し、後で無効にした場合、ページのバージョンの履歴は削除され、最新の公開ページのバージョンのみが保存されます。 これは、Local LiveとRemote Live Stagingのどちらにも当てはまります。
```

## バリエーションの種類

ステージングには2種類のバリエーションがあります。

* **サイトページバリエーション**: 複数のサイトページに対する変更を1つのバリエーションにまとめます。

* **Page Variations**: 個別のページのバリエーションを作成することができます。 サイトページのバリエーション内に作成されます。

   ```{note}
   ページバリエーションが有効なサイトにウィジェットページをインポートすると、そのページは、サイトページのメインバリエーションの新しいバリエーションとしてインポートされます。

   コンテンツ・ページでは、 [Experiences](../../../site-building/personalizing-site-experience/experience-personalization/content-page-personalization.md) を使って代替ページを作成することができます。
   ```

ステージングサイトのすべてのバリエーションは同じコンテンツを共有しているため、どちらのバリエーションタイプもページにのみ影響し、サイトのコンテンツには影響しません。 つまり、各バリエーションは同じコンテンツやアプリケーションを異なる方法で使用、構成することができ、各サイトページのバリエーションは異なるページを含むことができます。

また、ページのメタデータはバージョン管理されていません（例：レイアウトタイプ、フレンドリーURL）。 これは、メタデータの変更がすべてのバリエーションに適用されることを意味します。 例えば、ページのテンプレートが変更された場合、テンプレートからの変更を継承するように設定されたすべてのページにその変更が伝搬されます。

```{important}
ページテンプレートは、ステージングフレームワークによって認識されません。 つまり、ステージングされたサイトでは、既存のページテンプレートは表示も編集もできないのです。 ステージングされたサイトで作成された場合、ステージングを無効にすると失われます。
```

## バリエーションの作成

1. Staging bar の *Actions* ボタン ( ![Actions button](../../../images/icon-actions.png) ) をクリックし、 *Site Pages Variation* または *Page Variations*を選択します。

   ![ステージングバーの「アクション」ボタンをクリックし、作成したいバリエーションタイプを選択します。](./page-versioning/images/03.png)

1. モーダルウィンドウの右下にある「 *Add* 」ボタンをクリックします。

   ![モーダルウィンドウの右下にある[追加]ボタンをクリックします](./page-versioning/images/04.png)

1. 新しいバリエーションの*名前*と*説明*を入力します。 これらのフィールドは、バリエーションに合わせていつでも変更できます。

   ![新しいバリエーションの名前と説明を入力します。](./page-versioning/images/05.png)

   サイトページバリエーションでは、新しいバリエーションが既存のバリエーションからページをコピーするかどうかを、以下のオプションから選択することができます。

   * **All Site Pages Variations**: 既存のサイトページバリエーションから全ページをコピーします。

   * **None (Empty Site Pages Variation)**: 新しい、空のサイトページバリエーションを作成します。

   * **[既存のバリエーション]**: 1つのサイトページバリエーションからすべてのページをコピーします。

   ![新しいサイトページバリエーションが既存のバリエーションからページをコピーしていないかどうかを判断します。](./page-versioning/images/06.png)

   ```{note}
   既存のバリエーションからページをコピーする場合、出版準備中とマークされた最新バージョンのみがコピーされます。
   ```

1. *追加* をクリックして、新しいバリエーションを作成します。

一度作成したページやページグループは、ステージングバーのドロップダウンメニューで各バージョンを切り替えることができます。 詳細については、[Site Staging UI Reference](./site-staging-ui-reference.md)を参照してください。

![ステージングバーのドロップダウンメニューで、ページやページグループの各バージョンを切り替えることができます。](./page-versioning/images/02.png)

## バリエーションのマージ

2つのサイトページバリエーションを統合することができます。 これは、すべてのページとページバリエーションを、その内容に影響を与えたり上書きしたりすることなく、サイトページバリエーションに追加するものです。

1. Staging bar の *Actions* ボタン ( ![Actions button](../../../images/icon-actions.png) ) をクリックし、 *Site Pages Variation*を選択します。

   ![［サイトページバリエーション］を選択します。](./page-versioning/images/07.png)

1. マージするベースとして使用するバリエーションの *アクション* ボタン ( ![Actions button](../../../images/icon-actions.png) ) をクリックし、 *マージ*を選択します。

   ![統合のベースとするバリエーションの「アクション」ボタンをクリックし、「統合」を選択します。](./page-versioning/images/08.png)

1. ベースとなるバリエーションの上にマージするバリエーションを選択します。

   ![ベースとなるバリエーションの上にマージするバリエーションを選択します。](./page-versioning/images/09.png)

サイトページの2つのバリエーションを統合すると、ベースとなるバリエーションに存在しない新しいページが追加されます。 そして、ページが両方のバリエーションに存在し、少なくとも1つのバージョンのページが公開準備完了とマークされている場合、準備完了とマークされた最新のバージョンが、ベースバリエーションの対応するページ用の新しいバリエーションとして追加されます。 公開の準備ができているとマークされていない古いバリエーションはコピーされません。

## バリエーション権限の管理

パーミッションを使用して、バリエーションへのユーザーのアクセスを管理することができます。 詳細は、[ステージング権限の管理](./managing-staging-permissions.md)を参照してください。

## 追加情報

* [ステージングの概要](../staging.md)
* [Configuring Local Live Staging](./configuring-local-live-staging.md)
* [Configuring Remote Live Staging](./configuring-remote-live-staging.md)
* [サイトステージングUIリファレンス](./site-staging-ui-reference.md)
