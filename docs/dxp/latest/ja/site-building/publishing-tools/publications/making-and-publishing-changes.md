# 変更の作成と公開

> 対応可能：Liferay DXP/Portal 7.3以降

パブリケーションは、Liferayインスタンスへの変更を管理するための便利な方法を提供します。 パブリケーションを使用すると、あなたとあなたのチームは、'パブリケーション'と呼ばれる変更のブロックを作成して共同作業できます。 その後、準備ができたら、これらの変更を本番環境に公開できます。

```{note}
デフォルトでは、ユーザーは自分が作成したパブリケーションのみを使用できます。 ただし、他のユーザーを招待して、自分のパブリケーションで共同作業を行うことができます。 詳細については、 [パブリケーションでのコラボレーション](./collaborating-on-publications.md) を参照してください。
```

変更を追跡するためのパブリケーションをまだ作成していない場合は、詳細について [Creating a New Publication](./creating-and-managing-publications.md#creating-a-new-publication) を参照してください。

作成されたパブリケーションは、パブリケーションで行われた変更と競合しない限り、本番環境に加えられた変更で自動的に更新されます。 これにより、あなたとあなたのチームは最新バージョンの本番環境で作業をすることができます。

```{important}
Liferayのバージョンをアップグレードすると、既存のパブリケーションを変更、公開、または元に戻すことができなくなります。 すべてのアクティブなパブリケーションは、期限切れとしてマークされ、表示または削除のみが可能です。 また、アップグレード前に発行された出版物については、*Revert*オプションが削除されます。
```

## パブリケーションに変更を加える

インスタンスに変更を加える前に、本番環境や別のパブリケーションではなく、正しいパブリケーションで作業していることを確認してください。 これは、パブリケーションバーで確認できます。

目的のパブリケーションで現在作業していない場合は、*［Select a Publication］*をクリックして、正しいパブリケーションを選択してください。

![［公開を選択］をクリックして、目的のパブリケーションを選択します。](./making-and-publishing-changes/images/01.png)

パブリケーションで作業している間、サポートされているLiferayコンポーネントに加えられた変更は、パブリケーションで追跡されます。 これには、複数のサイトにわたる変更が含まれる場合があります。

```{important}
同じパブリケーション内の異なるサイトを編集する場合、すべての変更履歴は、パブリケーションの公開時に本番環境に適用されることに注意してください。
```

パブリケーションでアセットを追加、編集、または削除すると、変更が行われたパブリケーションでのみその変更が表示されます。

各アプリケーションは、アセットのどの部分をパブリケーションで追跡できるかを制御します。 ただし、パブリケーションをサポートしていないアプリケーションやコンテンツタイプに関連するウィジェットも、ページの一部としてパブリケーションに追加できます。

```{note}
パブリケーション内のアセットを削除すると、DXPはアセットに削除のマークを付け、パブリケーションを表示するときにそのアセットを非表示にします。 パブリケーションでのアセットの削除は論理的な削除にすぎないため、アセットは本番環境やその他のパブリケーションで引き続き表示できます。
```

## 並行パブリケーションに変更を加える

ユーザーは、同時に複数のアクティブなパブリケーションを持つことができます。 これらの並行パブリケーションで変更が行われると、インスタンスのエンティティの代替編集履歴が作成されます。 これらの変更は、同じコンテンツを変更するか関連するコンテンツを変更するかに応じて、互換性がある場合と競合する場合があります。

### 互換性のある変更

並行パブリケーションに互換性のある変更が含まれている場合、問題なく公開できます。 この場合、両方のパブリケーションの変更履歴が本番環境に適用されます。

### 競合する変更

並行パブリケーションに互換性のない変更が含まれていて、パブリケーションの1つが最初に本番環境に適用された場合、もう一方のパブリケーションで公開設定時に競合が発生します。 これらの競合は、本番環境が直接更新された場合にも発生する可能性があります。 このプロセスの詳細は、[競合の解決](./resolving-conflicts.md)を参照してください。

## パブリケーションの変更の確認

公開する前に、パブリケーションの変更履歴を確認して、必要な編集のみが含まれていることを確認できます。 これを行うには、［Publications］ドロップダウンメニューを開き、*［Review Changes］*を選択します。

![［Publications］ドロップダウンメニューを開き、［変更の確認］を選択します。](./making-and-publishing-changes/images/02.png)

または、パブリケーションアプリケーションを介して、パブリケーションの変更履歴を確認することもできます。 *［進行中］*タブに移動し、目的のパブリケーションの*アクション*ボタン（![Actions button](../../../images/icon-actions.png)ボタン）をクリックして、*［Review Changes］*を選択します。

### 表示スタイル

変更を確認する際、*変更*と*コンテキスト*の2つの表示スタイル間を切り替えることもできます。

* **変更**：すべての変更履歴が一覧で表示され、*変更の種類*、*編集日時*、*サイト*、*タイトル*、または*ユーザー*でソートできます。

    ![変更履歴をリストに表示します。](./making-and-publishing-changes/images/03.png)

* **コンテキスト**：追跡されたすべての変更がツリー状に表示されるため、関連する変更と照らしてそれらを表示できます。

    ![変更履歴をコンテキストで表示します。](./making-and-publishing-changes/images/04.png)

### シンプルで高度な変更の概要

デフォルトでは、DXPは変更履歴の簡単な要約を表示しますが、スイッチを*［Show All Items］*に切り替えることができます。 これには、変更に関連するすべてのバックグラウンドプロセスが含まれます。

![［すべての項目を表示］に切り替えて、パブリケーションに含まれるすべての変更を確認します。](./making-and-publishing-changes/images/05.png)

個々の変更をクリックすると、詳細が表示されます。 ここから、変更履歴の*アクション*ボタン（![Actions button](../../../images/icon-actions.png)）をクリックして、*［Edit］*または*［Discard］*することもできます。 使用可能なアクションは、変更のタイプによって異なります。

![個々の変更をクリックすると、詳細が表示されます。](./making-and-publishing-changes/images/06.png)

## 変更内容の公開

変更作業が完了したら、すぐに公開するか、後で公開するようにスケジュールすることができます。 公開されると、パブリケーションはパブリケーションアプリケーションの［履歴］タブに一覧表示されます。 これにより、レビューを使用して必要に応じてサイトの変更を元に戻すことができる明確な監査証跡が維持されます。 詳細は、[変更を元に戻す](./reverting-changes.md)を参照してください。

公開プロセスを開始すると、Liferayは互換性チェックを実行して、パブリケーションと本番環境の間に競合があるかどうかを判断します。 競合がある場合は、DXPから通知されます。 一部の競合は自動的に解決されますが、その他の競合は手動で解決する必要があります。 変更を公開するには、すべての競合を解決する必要があります。 詳細は、 [競合の解決](./resolving-conflicts.md) を参照してください。

### 今すぐ公開

次の手順に従って、変更をすぐに公開します。

1. ［Publications］*ドロップダウンメニュー*を開き、*［変更の確認］*を選択します。

   または、パブリケーションアプリケーションを開き、目的のパブリケーションをクリックします。

1. *[公開]*をクリックします。

   ![目的のパブリケーションに移動し、［公開］をクリックします。](./making-and-publishing-changes/images/07.png)

1. 必要に応じて、検出された競合を手動で解決します。 すべての競合が解決されたら、次に進むことができます。

   ![公開する前に、すべての競合を解決します。](./making-and-publishing-changes/images/08.png)

1. *[公開]*をクリックします。

パブリケーションの変更はすぐに本番環境に適用され、*［履歴］*タブにリダイレクトされます。  ここから、公開設定の詳細（日付、発行者、ステータスなど）を表示し、必要に応じてパブリケーションの変更を[元に戻す](./reverting-changes.md)ことができます。

### 後でスケジュールする

次の手順に従って、後日の公開をスケジュールします。

1. ［Publications］*ドロップダウンメニュー*を開き、*［変更の確認］*を選択します。

   または、パブリケーションアプリケーションを開き、目的のパブリケーションをクリックします。

1. *［Schedule］*をクリックします。

   ![目的のパブリケーションに移動し、［スケジュール］をクリックします。](./making-and-publishing-changes/images/09.png)

1. 必要に応じて、検出された競合を手動で解決します。 すべての競合が解決されたら、次に進むことができます。

   ```{important}
   公開時に、DXPは2回目の競合検出を実行して、新たな競合する変更がないことを確認します。 DXPが自動的に解決できない新しい競合を検出すると、公開は失敗します。 競合を自動的に解決できる場合、DXPは公開を続行します。
   ```

1. 変更を本番環境に公開する*日付*と*時刻*を入力します。

   ![変更を公開する日時を設定します。](./making-and-publishing-changes/images/10.png)

1. *［Schedule］*をクリックして、プロセスを完了します。

*［予定済み］*タブにリダイレクトされ、 [スケジュールされたパブリケーションを表示および管理](./creating-and-managing-publications.md#managing-scheduled-publications) できます。

## 追加情報

* [パブリケーションの概要](../publications.md)
* [パブリケーションの有効化](./enabling-publications.md)
* [パブリケーションの作成と管理](./creating-and-managing-publications.md)
