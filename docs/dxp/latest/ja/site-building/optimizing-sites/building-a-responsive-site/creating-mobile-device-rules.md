# モバイルデバイスルールの作成

> モバイルデバイスルールは、Liferay Mobile Device Detection Liteが7.3で廃止予定になったため、Liferay7.2以前でのみ使用できます。

前提条件として、Liferay マーケットプレイスから [Liferay Mobile Device Detection Lite (LMDD)](https://web.liferay.com/marketplace/-/mp/application/92831494) アプリをインストールする必要があります。 このアプリは、どのモバイルデバイスがアクセスしているかを検出するために必要なデバイス検出データベースを提供します。

## モバイルデバイス種別の作成

モバイルデバイス種別は、デバイスのタイプに基づいたモバイルデバイスアクションのグループです。 [モバイルデバイスアクション](#adding-mobile-device-actions) を作成する前に、モバイルデバイス種別を作成します。 たとえば、すべてのAndroidデバイスのグループを作成します。LiferayがAndroidデバイスを検出すると、訪問者をモバイル対応のページにリダイレクトできます。

モバイルデバイス種別を作成するには、

1. 目的のサイトに移動します。
1. (![Menu](../../../images/icon-menu.png)) アイコンをクリックする。
1. **Configuration** &rarr; **Mobile Device Families** にアクセスしてください。
1. **Add** ボタン( [Add Family](../../../images/icon-add.png) )をクリックして、 **New Device Family** を追加します。
1. **名前** と **説明** を入力してください。
1. **保存** をクリックします。

［モバイルデバイスファミリー］ページには、定義された種別が一覧表示されます。

![Create a Mobile Device Family so you can create rules.](./creating-mobile-device-rules/images/01.png)

すべてのサイトにファミリーを追加するには、サイトセレクタ（ [サイトへ移動](../../../images/icon-compass.png) ）をクリックしてグローバルサイトに移動します。 &rarr; **My Sites** &rarr; **Global** をクリックし、新しいデバイスファミリーを追加します。

種別に対して定義されたルールは、特定のサイトまたはページに対して選択された種別の優先順位とともに、特定のリクエストに適用される種別のアクションを決定します。 新しいルールでは、オペレーティングシステム、ルールタイプ、物理スクリーンサイズ、および画面の解像度を指定できます。 アクションを実行するデバイスを分類するために、必要な数のルールを種別に追加できます。

1. **モバイルデバイスファミリー** ページで、モバイルデバイスファミリーの名前をクリックします。 ［判別ルール］ページが表示されます。

1. 新しいルールを追加するには、 **追加** ボタン（！ [分類ルールの追加](../../../images/icon-add.png) ）をクリックします。

1. **名前** と **説明** を入力します。

1. このルールに必要な分類を、 **Operating System and Type** 、 **Physical Screen Size** 、 **Screen Resolution** から選択します。

   ![Add a Mobile Device Rule.](creating-mobile-device-rules/images/02.png)

1. ［**保存**］をクリックします。

## モバイルデバイスルールの適用

種別は、それぞれの構成ページからサイト、個々のページ、またはページセットに追加できます。 ページセットに対してそれを行うには、

1. サイトビルダー **&rarr;***ページ** にアクセスしてください。

1. 公開ページの (![Configure](../../../images/icon-cog.png)) アイコンをクリックします。

1. **詳細** タブをクリックします。

1. **Mobile Device Rules** セクションを展開します。

1. **選択** をクリックして、家族のリストを開きます。

1. 適用する種別を選択します。

   ![Configure the Mobile Device Rule for a site.](./creating-mobile-device-rules/images/03.png)

1. 終了したら、 **保存** をクリックします。

### ページにモバイルデバイスルールを適用する

親サイトからモバイルデバイスルールを継承するように各ページを構成することも、特定のページに異なるルールを適用することもできます。

特定のページにモバイルデバイスルールを設定するには、

1. サイトビルダー **&rarr;***ページ** にアクセスしてください。

1. 希望するページの横にある![Options](../../../images/icon-options.png) アイコンをクリックし、次に **Configure** をクリックします。

1. **詳細** タブをクリックします。

1. **Mobile Device Rules** セクションを展開します。

1. トグルを **NO** にスライドさせると、親サイトとは異なるモバイル・デバイス・ルールが選択されます。

1. **選択** をクリックして、家族のリストを開きます。

1. 適用する種別を選択します。

   ![Use a different Mobile Device Rule on a page than the parent Site.](./creating-mobile-device-rules/images/04.png)

1. 終了したら、 **保存** をクリックします。

## モバイルデバイスアクションの追加

いくつかのモバイルデバイスファミリーを作成し、それらにいくつかのルールを追加したら、モバイルデバイスアクションを追加します。 種別に定義されたこれらのアクションは、デバイスが検出され、種別が適用されることが判明したときに、リクエストに何が起こるかを決定します。

```{tip}
セグメンテーションとパーソナライズには、ユーザーが特定のデバイス種別を使用してコンテンツにアクセスしているかどうかを評価する*デバイス*ルールがあります。 このルールは、モバイルデバイスファミリーアプリと統合されています。
```

モバイルデバイスアクションをページセットまたは特定のページに追加できます。

サイトのモバイルデバイスルールにアクションを追加するには、

1. Liferay ゲストサイトの **サイト管理** メニューを開きます。

1. サイトビルダー **&rarr;***ページ** をクリックします。

1. **公開ページ** の隣にある(![歯車アイコン](../../../images/icon-cog.png))アイコンをクリックします。

1. **詳細** タブをクリックします。

1. **Mobile Device Rules** セクションを展開します。

1. **Options**（[Options]（../../../images/icon-actions.png））をクリックします。 &rarr; アクションを追加したいデバイスファミリーの横にある **Manage Actions** をクリックします。

1. **Add Action** をクリックします。

1. 名前 **と** 説明を入力してください。

1. **Type**（例： **Redirect to Site**）を選択します。 タイプについては、次の [モバイルデバイスアクションのリファレンス](#mobile-device-actions-reference) を参照してください。

1. 訪問者がリダイレクトされる目的のサイトを選択します。

1. サイトのログインページを選択します。

    ![Add an action to the existing Mobile Device Rule.](./creating-mobile-device-rules/images/05.png)

1. 終了したら、 **保存** をクリックします。

モバイルデバイスアクションがこのサイトに追加されました。

## モバイルデバイスアクションのリファレンス

モバイルデバイス種別に定義されたモバイルデバイスアクションは、デバイスが検出され、種別が適用されることが判明したときに、リクエストに何が起こるかを決定します。

デフォルトでは、モバイル種別用に設定できるアクションは4種類あります。

![Add a Mobile Device Action to a Site, Page Set, or Page.](./creating-mobile-device-rules/images/06.png)

| モバイルデバイスアクション      | 説明                                                                                                                                          |
| :----------------- | :------------------------------------------------------------------------------------------------------------------------------------------ |
| **レイアウトテンプレートの変更** | モバイルデバイスに配信されるページでのポートレットの配置方法を変更します。 たとえば、複雑なレイアウトのページでは、モバイルデバイスが検出された場合、標準のレイアウトをサポートするのに十分な解像度が理論的に高い場合でも、より単純なテンプレートに自動的に切り替えることができます。 |
| **テーマの変更** | さまざまなモバイルデバイスファミリーの特定のテーマを選択します。 デバイスがページにヒットしたときに自動的に適用されるサイトのテーマのモバイルバージョンが必要になります。                                                       |
| **URLリダイレクト** | モバイルユーザーを任意のURLに送信します。 これは、モバイルユーザーをモバイルアプリのダウンロードまたはページのモバイルバージョンに誘導するために使用できます。                                                           |
| **サイトリダイレクト** | モバイルユーザーをポータル上の別のサイトに送信します。 場合によっては、モバイルコンテンツをサイトのミラーリング上に作成することもできます。                                                                      |

```{tip}
Liferayは、応答性が高く、アクセスする可能性のあるすべてのデバイスに適応するように一から設計されました。 新しいテーマを作成したり、レイアウトテンプレートを強制的に変更したりする前に、サイトが追加設定なしでどのように動作するかをテストする必要があります。 URLリダイレクトなどの特定の機能は、不適切に使用すると混乱を招き、挫折感を引き起こす可能性があります。
```

## 関連トピック

* [レスポンシブ・サイトの構築](../building-a-responsive-site.md)
