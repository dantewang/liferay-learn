# ウィジェットテンプレートの作成

ウィジェットテンプレートは、 [FreeMarker](https://freemarker.apache.org/) を使用して、サイトページ内でウィジェットがどのようにレンダリングされるかを決定します。 各テンプレートは、特定のウィジェットタイプ用に設計されており、ページ内のウィジェットを設定する際に選択できます。

```{note}
Liferay DXP/Portal 7.4+では、ウィジェットテンプレートはFreeMarkerにのみ対応しています。 Velocityへのサポートは終了しました。
```

以下の手順でウィジェットテンプレートを作成します。

1. ウィジェットテンプレートを作成する目的のサイトに移動します。

1. **サイトメニュー**（ ![サイトメニュー](../../../../../images/icon-product-menu.png) ) から、 ［**Design**］ &rarr; ［**Templates**］ &rarr; ［**Widget Templates**］ にアクセスします。

   ```{note}
   グローバルサイトでは、ウィジェットテンプレートのサンプルを見ることができます。 これらのサンプルテンプレートは、すでにアプリに設定されているデフォルトのテンプレートとは異なります。
   ```

1. **追加**( ![Add Button](../../../../../images/icon-add.png) ) をクリックし、作成するテンプレートの種類を選択します。

   ![デザインとウィジェットのテンプレートをクリックします。](./creating-a-widget-template/images/01.png)

1. テンプレートに **名前** を入力します。

1. エディターでテンプレートをデザインします。

   ［**Elements**］ サイドパネル( ![Elements](../../../../../images/icon-list-ul.png) )では、利用可能なウィジェットフィールド、変数、ユーティリティから選択することができます。 すべてのウィジェットに共通する要素もあれば、選択したウィジェットタイプに特化した要素もあります。

   ![フィールド要素を使用してテンプレートを設計します。](./creating-a-widget-template/images/02.png)

1. (オプション）詳細サイドパネル（![Details](../../../../../images/icon-cog3.png)）で、 **説明** を入力し、 **画像** をテンプレート用に選択します。

1. ［**保存**］ をクリックします。

## テンプレートエディター

テンプレートエディターの右側には、テンプレートの作成によく使われる変数がパレットで表示されています。 テンプレートを作成する際の参考にしてください。 テンプレートエディターに変数を配置するには、配置したい場所にテキストカーソルを置き、変数名をクリックします。

また、各変数には、詳細な説明を表示するツールチップがあります。 ウィジェットテンプレートには複数の種類があるため、ウィジェットテンプレートごとに異なる変数も存在します。 したがって、各テンプレートには、その特定のテンプレートにのみ適用可能な異なる変数のセットがあります。

![Liferayは、ウィジェットテンプレートをカスタマイズするための多機能なスクリプトエディターを提供します。](./creating-a-widget-template/images/03.png)

また、オートコンプリート機能を使って、テンプレートに変数を追加することもできます。 **${** と入力すると、利用可能な変数のドロップダウンメニューが表示され、呼び出すことができます。 変数の一つをクリックすると、エディターにその変数が挿入されます。

また、同じ種類のテンプレートを他のテンプレートに埋め込むことも可能です。 例えば、既存のWikiウィジェットテンプレートがあり、別のWikiウィジェットテンプレートをもう1つ作成したいとします。 ゼロから始めるのではなく、既存のWikiウィジェットテンプレートを新しいものにインポートして、それを元に構築することができます。 つまり、システム内のVelocityやFreeMarkerのテンプレートで取り込んだコードを再利用するための汎用テンプレートとしてウィジェットテンプレートを使用できます。

## ウィジェットテンプレートの設定

ウィジェットテンプレートを保存した後、そのアクションボタン(![Actions Button](../../../../../images/icon-actions.png))で管理することができます。 これにはいくつかのオプションがあります。

- **編集** ：ウィジェットテンプレートの設定プロパティを変更します。
- **権限設定** ：ウィジェットテンプレートの **アップデート** 、 **権限設定** 、 **削除** そして **表示** を管理します。
- **コピー** : ウィジェットテンプレートのコピーを作成します。
- **削除** : ウィジェットテンプレートを削除します。

さらに、ウィジェットテンプレートは、静的URLとWebDAV URLを生成します。 これらの値は、テンプレートのXMLソースにアクセスします。 これらのURLは、メニューからウィジェットテンプレートをクリックし、 ［**詳細**］ セクションを展開することで見つけることができます。 WebDAV URLにより、サイト管理者はリモートサーバー上のウィジェットテンプレートを追加、参照、編集、削除することができます。 WebDAV URLでできることの詳細は、[WebDAVアクセス](../../../../../content-authoring-and-management/documents-and-media/publishing-and-sharing/accessing-documents-with-webdav.md)を参照してください。

```{note}
ウィジェットテンプレートにウィジェットを埋め込むことは可能ですが、他のウィジェットとの競合や予期せぬ動作（例：パンくずリストへのデータ集計ウィジェットの埋め込み）を引き起こす可能性があるため、推奨されません。 ウィジェットテンプレートにウィジェットを埋め込むしかない場合、他のウィジェットと干渉しないことを確認してください。
```

次に、新しいウィジェットテンプレートを使用するようにウィジェットを設定します。

1. 修正したいウィジェットの ［**Configuration**］ ページを開き、 ［**表示設定**］ を開いてください。

1. ［**Display Template**］ で、ドロップダウンメニューからウィジェットテンプレートを選択します。

**また、アプリのサイト別表示テンプレートを管理することもできます。管理するには、** 表示テンプレート **ドロップダウンメニューの横にある［[SPECIFIC_SITE**] の表示テンプレートを管理する］リンクをクリックします。 設定されたテンプレートのリストが表示され、新しいテンプレートを追加したり、既存のテンプレートを編集したりすることができます。

![アプリの **設定** メニューをクリックすると、利用可能なウィジェットテンプレートを編集・管理できます。](./creating-a-widget-template/images/04.png)

## 関連トピック

- [ウィジェットテンプレートの例](./using-a-widget-template-example.md)
