# リダイレクションツールの使用

{bdg-secondary}`7.3以降で利用可能`

URLの整合性を維持することは、どのサイトにとっても重要です。 Liferay DXPの **リダイレクト** ツールは、HTTPリダイレクトを管理し、404エラーを追跡するための便利で統合された方法を提供します。 このツールを使えば、簡単にリンク切れを回避・修正することができ、ユーザーエクスペリエンスとSEOの両方を向上させることができます。

アクセスするには、サイトメニュー (![Site Menu](../../../images/icon-product-menu.png)) を開き、 **設定** &rarr; **リダイレクト** にアクセスしてください。

![サイトメニューの「リダイレクト」ページに移動します。](./using-the-redirection-tool/images/01.png)

ここでは、リダイレクトツールの機能性が ［**Redirects**］ と ［**404 URLs**］ の2つのタブに編成されています。

* [リダイレクト](#redirects)
* [404 URL](#urls)

```{important}
Liferay DXP/Portal 7.4+では、404トラッキングはデフォルトで無効になっています。 この機能を利用するには、 [404トラッキングを有効にする](#enabling-404-tracking) 必要があります。 これにより、404トラッキングとRedirectionアプリケーションの404 URLタブの両方が有効になります。
```

## リダイレクト

［**Redirects**］ タブでは、 **恒常的な** URLリダイレクト（301）と **一時的な** URLリダイレクト（302）の両方を作成および管理できます。

![ [リダイレクト]タブから、永続的および一時的なURLリダイレクトを作成および管理できます。](./using-the-redirection-tool/images/02.png)

どちらもユーザーを指定された宛先に自動的に誘導しますが、それぞれがサイトに固有の影響を及ぼします。 リダイレクトを作成する前に、状況に最適なタイプを検討してください。

* **永久** ：301コードを使用して、サイトにアクセスする検索エンジンやその他のツールに、要求されたリソースが永久的に再配置されたことを通知します。 検索エンジンは古いURLを検索結果の新しい宛先に置き換え、ブラウザは新しい宛先を不確定な時間だけキャッシュします。 301コードは、行先URLを無期限に使用する場合にのみ使用してください。 これにより、SEOが向上し、意図しないキャッシュを回避できます。
* **一時的** ：302コードを使用して、サイトにアクセスする検索エンジンやその他のツールに、要求されたリソースが一時的に移動されたことを通知します。 302コードは、サイトのランキングに影響を与えることなく、問題を修正しながらA/Bテストを実行したりトラフィックをリダイレクトしたりする場合に役立ちます。 DXPはデフォルトで302コードを使用します。

SEOの各リダイレクトタイプの影響の詳細については、 [サイトの最適化](../../optimizing-sites.md) を参照してください。 また、テスト時に302コードを使用する方法については、 [A/Bテスト](../../optimizing-sites/ab-testing/ab-testing.md) を参照してください。

### リダイレクトの作成

以下の手順に従って、リダイレクトを作成します。

1. **追加** ボタン（![Add button](../../../images/icon-add.png)）をクリックします。 ［**New Redirect**］ 画面が表示されます。

   ![追加ボタンをクリックして、新しいリダイレクトを作成します。](./using-the-redirection-tool/images/03.png)

1. ［**Source URL**］ フィールドに一意の相対URLを入力して、リダイレクトをトリガーするリンクを指定します。 入力した値は、その上に表示されるベースURLに追加されます。

   ![ [ソースURL]フィールドに一意の相対URLを入力します。](./using-the-redirection-tool/images/04.png)

1. ［**Destination URL**］ フィールドに絶対URLを入力して、目的の宛先へのリンクを指定します。

   この宛先は内部または外部にすることができますが、常に絶対URLとして入力する必要があります。 **ショートカット** アイコン（![Shortcut icon](../../../images/icon-shortcut.png)）をクリックして、入力したURLを確認することもできます。

   ![ [行先URL]フィールドに絶対URLを入力します。](./using-the-redirection-tool/images/05.png)

1. ［**Type**］ ドロップダウンメニューを使用して、リダイレクトが永続的（301）か一時的（302）かを判別します。

   ![リダイレクトが永続的か一時的かを判断します。](./using-the-redirection-tool/images/06.png)

1. オプションで、リダイレクトの自動 **有効期限** を設定できます。 有効期限が切れないように、このフィールドは空のままにします。

   ![リダイレクトの有効期限が切れるかどうかを確認します。](./using-the-redirection-tool/images/07.png)

1. 終了したら、 ［**Create**］ をクリックしてリダイレクトを保存します。

保存されると、Liferay DXPが設定を検証します。 他のリダイレクトが指定されたソースURLを指している場合、DXPはその旨を通知し、リダイレクトチェーンを回避するために既存のリダイレクトを更新するかどうかを尋ねます。

![DXPは、リダイレクトチェーンの作成を回避するのに役立ちます。](./using-the-redirection-tool/images/08.png)

同じソースURLに対して複数のリダイレクトを作成しようとした場合、または指定したソースURLと宛先URLによってリダイレクトループが発生した場合も、DXPはエラーを返します。

### リダイレクトの編集と削除

URLリダイレクトを正常に追加したら、 **アクション** ボタン（![Actions button](../../../images/icon-actions.png)）をクリックして ［**Edit**］ または ［**Delete**］ を選択することで、いつでもリダイレクトを編集または削除できます。

![リダイレクトはいつでも編集または削除できます。](./using-the-redirection-tool/images/09.png)

```{note}
リダイレクトに加えられた変更は、古いリダイレクト構成をキャッシュしたブラウザにすぐに表示されない場合があります。
```

## 404 URL

［**404 URLs**］ タブでは、404エラーにつながるサイトリクエストを表示および管理できます。 DXPでは各エラーがカタログ化されているため、エラーの原因を評価し、問題を迅速に解決できます。

![404 URLを表示および管理できます。](./using-the-redirection-tool/images/10.png)

ここでは、カタログ化された404 URLを検索、フィルタリング、順序付けしたり、必要に応じてリダイレクトを作成したりできます。 これらのURLは、コントロールパネルのリダイレクト設定に従ってデータベースに保持されます。ここで、カタログ化される404の数と期間の両方を設定できます。

```{note}
Liferay DXP/Portal 7.4+ の 404 URLs タブにアクセスするには、まず [404 トラッキングを有効にする](#enabling-404-tracking) ことが必要です。
```

### 404 URLの表示

カタログ化されたリクエストは、 **タイプ** と **日付** の両方でフィルタリングできます。 タイプでフィルタリングするときは、表示する404 URLを ［**Active URLs**］（ 、 ［**Ignored URLs**］ 、または ［**All**］ から選択できます。 日付によるフィルタリングでは、すべてのURLを表示するか、あるいは過去1日、1週間、1ヶ月以内にリクエストされたURLのみを表示するかを決めることができます。 また、カタログ化されたリクエストを、 **更新日** や **リクエスト数** で順序付けすることもできます。

デフォルトでは、このページにはすべての有効なURLが番号順に表示されます。

![カタログ化された404 URLをフィルタリングして順序付けできます。](./using-the-redirection-tool/images/11.png)

### 404 URLを無視する/無視しない

URLがアクティブか無視されているかを判断するには、 **アクション** ボタン (![Actions button](../../../images/icon-actions.png)) をクリックして、 ［**Ignore**］ / ［**無視しない**］ を選択します。 無視すると、URLはデフォルトの ［**有効**］ ビューで非表示になりますが、ステータスはいつでも変更できます。

![URLが有効か無視されているかを判別できます。](./using-the-redirection-tool/images/12.png)

### 404 URLのリダイレクトの作成

404 URLの **アクション** ボタン（![Actions button](../../../images/icon-actions.png)）をクリックし、 ［**Create Redirect**］ を選択することで、簡単にリダイレクトを作成することができます。 これにより、 ［**新規リダイレクト**］ 画面が表示され、ソースURLに選択した404が事前に入力されます。

フォームへの入力を完了し、 ［**Create**］ をクリックして新しいリダイレクトを保存します。

![404 URLのリダイレクトを作成します。](./using-the-redirection-tool/images/13.png)

### 404設定の構成

404URLをリクエスト間で保持する期間、データベースに保存される404URLの最大数、404URLチェックの間隔を決定することができます。

これを行うには、コントロールパネルを開き、 ［**System Settings**］（または ［**Instance Settings**］）&rarr; ［**Pages**］ &rarr; ［Virtual Instance Scope］の下の ［**Redirection**］ に移動します。

デフォルトでは、 **404 URL Maximum Age** は30日、 **Maximum Number of 404 URLs** は1000エントリに設定され、システムは24時間ごとに404 URLをチェックすることになっています。

![保持する404 URLの期間と数を決定します](./using-the-redirection-tool/images/14.png)

## 404トラッキングの有効化

{bdg-secondary}`7.4以降で利用可能`

以下の手順で、バックグラウンド404トラッキングを有効にし、404 URLタブを有効にします。

1. **グローバルメニュー**(![Global Menu](../../../images/icon-applications-menu.png)) を開き、 **コントロールパネル** タブをクリックし、 **システム設定** &rarr; **ページ** &rarr; **リダイレクト** と進みます。

   ![［Enabled］にチェックを入れ、［Save］をクリックします。](./using-the-redirection-tool/images/15.png)

1. Check **Enabled** .

1. ［**Update**］ をクリックします。

有効にすると、Redirectionアプリケーションの404URL管理タブにアクセスできるようになります。

```{important}
アプリケーションを有効化または無効化しても、データベースに保存されているデータには影響しません。 無効にした場合は、いつでもデータにアクセスできるように機能を再有効化することができます。
```

## 追加情報

* [バーチャルホストのサイトURLの設定](./configuring-virtual-hosts-site-urls.md)
* [サイトのフレンドリーURLの設定](./configuring-your-sites-friendly-url.md)
