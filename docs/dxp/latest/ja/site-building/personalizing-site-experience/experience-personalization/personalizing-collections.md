# コレクションのパーソナライズ

{bdg-secondary}`利用可能 Liferay Portal 7.3 GA6 / DXP 7.3+`

デフォルトでは、どのユーザーもコレクションのすべてのコンテンツを見ることができ、Anyoneパーソナライズバリエーションの一部となります。 しかし、 [セグメント](../segmentation/creating-and-managing-user-segments.md)を使って、コレクションのアイテムのパーソナライズされたバリエーションを作ることができる。 パーソナライズされたバリエーションを使用すると、コレクションの一部であるアイテムは変更されませんが、コレクションページ、コレクション表示フラグメント、またはアセット表示ウィジェットは、セグメント用にフィルタリングされたアイテムを表示します。

```{important}
セグメントを使用してコレクションをカスタマイズし、コレクションにパーソナライズされたバリエーションを設定するには、まずセグメントを定義する必要があります。 詳細については、 [ユーザーセグメントの作成と管理](../segmentation/creating-and-managing-user-segments.md) を参照してください。
```

![コレクションは、デフォルトで誰でも利用できます。](./personalizing-collections/images/01.png)

次の例を考えてみましょう。 あなたは、登録ユーザーに限定プロモーションを提供することで、オンラインのキッチン用品ストアでの売り上げを伸ばしたいと考えています。 登録ユーザー向けのプロモーションや製品に関するニュースを含むコレクションを作成します。 商品に関するニュースはすべての人に表示したいが、プロモーションは登録ユーザーのみに限定したいと考えています。 この例では、登録ユーザーのための新しいセグメントを作成し、プロモーションコンテンツをフィルタリングする新しいパーソナライズされたバリエーションにセグメントをリンクすることができます。

```{tip}
コレクションに複数のパーソナライズされたバリエーションを作成し、必要に応じて編集または削除できます。 また、Anyoneパーソナライズドバリエーションを編集することはできますが、削除することはできません。
```

## パーソナライズされたバリエーションを作る

ユーザーのために [セグメント](../segmentation/creating-and-managing-user-segments.md) を作成したら、それらのセグメントに基づいてコレクションにパーソナライズされたバリエーションを追加できます。

1. **サイトメニュー**( ![Site Menu](../../../images/icon-applications-menu.png) ) を開き、 **サイトビルダー** &rarr; **コレクション** に移動します。

1. [コレクション](../../../content-authoring-and-management/collections-and-collection-pages/creating-collections.md) を作成するか、既存のものを選択する。

1. **Add Personalized Variation** をクリックする。

   すでにパーソナライズされたバリエーションがあり、他の利用可能なセグメントがある場合は、パーソナライズされたバリエーションの横にある **追加**(![add icon](../../../images/icon-add-app.png)) をクリックして、新しいパーソナライズされたバリエーションを追加します。

1. セグメントを選択し、それに応じてコレクションをカスタマイズします。

[パーソナライズされたバリエーションの優先順位付け](#personalizing-collections) または [全セグメントからのコレクションエントリーの組み合わせ](#combining-collection-entries-from-all-segments) によって、ユーザーが見ることができるものをコントロールできるようになりました。

## バリエーションの優先順位付け

{bdg-secondary}`Liferay DXP 7.4+`で利用可能です。

ユーザーが複数のセグメントに属している場合、 [ユーザーが属しているすべてのセグメントからのコレクションエントリ](#combining-collection-entries-from-all-segments) を組み合わせたり、パーソナライズされたバリエーションに優先順位をつけたりして、どのパーソナライズされたバリエーションをユーザーに表示するかを決定することができます。

コレクションを編集する際、パーソナライズされたバリエーションのソート可能なリストにアクセスし、その **アクション** ボタン ( ![Actions button](../../../images/icon-actions.png) ) をクリックし、 **優先順位付け** または **非優先順位付け** を選択して、バリエーションのランクを変更します。 また、バリエーションをドラッグ＆ドロップして優先順位を並べ替えることもできる。

```{note}
優先順位は、リスト内の各項目の位置に応じて割り当てられる。 最優先されるのはリストの一番上のポジションだ。
```

![コレクションのバリエーションに優先順位をつけ、ユーザーに表示するバリエーションを決定する。](./personalizing-collections/images/02.png)

## 全セグメントからのコレクションエントリーを組み合わせる

複数の [セグメント](../segmentation/creating-and-managing-user-segments.md)に属するユーザについては、デフォルトエントリまたは優先順位 [のパーソナライズされたバリエーション](#prioritizing-variations) のみを表示するのではなく、そのユーザが属するすべてのセグメントからコレクションエントリを組み合わせて表示することができます。

1. **Global Menu**( ![Applications Menu icon](../../../images/icon-applications-menu.png) ) を開き、 **Control Panel** tab &rarr; **System Settings** under Configuration を選択します。

1. コンテンツとデータ」で、「**資産**」 を選択する。

1. システム・スコープで、 **コレクション** を選択します。

1. ダイナミック・コレクションとマニュアル・コレクションの機能を有効にします。

1. ［**Save**］ をクリックします。

![アセットパブリッシャーの全セグメントからアセットを組み合わせて、ダイナミックコレクションやマニュアルコレクションを行う機能を有効にします。](./personalizing-collections/images/03.png)

複数のセグメントに属するユーザーは、すべてのセグメントのコンテンツを見ることができるようになりました。

例えば、3つのセグメントがあります：登録ユーザー、ブラジル人ユーザー、カナダ人ユーザー。 登録ユーザーであれば、そのセグメントで選択されたコンテンツのみが表示されます。 ブラジルとカナダのユーザーも同様だ。 ただし、ブラジル在住の登録ユーザーであれば、両方のセグメントで選択されたコンテンツを見ることができます。 どのセグメントにも属していない場合は、「誰でも」に設定されたコンテンツが表示される。

![複数のセグメントに属するユーザーは、すべてのセグメントのコンテンツを見ることができます。](./personalizing-collections/images/04.png)

## Liferay DXP 7.2

### コンテンツセットのパーソナライゼーション

では、 [セグメント](../segmentation/creating-and-managing-user-segments.md) を使って、コンテンツセットのパーソナライゼーションを実演してみましょう。 この例では、ホームページにデフォルトで表示されるコンテンツセットを作成します。 次に、それを変更して、American Engineersセグメントのメンバー向けの技術記事を含む個人用バリエーションを作成します。

コンテンツ・セットについてご存じない方は、 [コンテンツ・セットの作成](../../../content-authoring-and-management/collections-and-collection-pages/creating-collections.md#creating-content-sets) の記事をご覧ください。

#### デフォルトのコンテンツセットの作成と設定

まずデフォルトのコンテンツセットを作成し、アセットパブリッシャーを使ってホームページに設定します。

1. **サイトメニュー**( ![Site Menu](../../../images/icon-applications-menu.png) ) を開き、 **コンテンツとデータ** &rarr; **コンテンツセット** に移動する。

1. **Add**( ![Add](../../../images/icon-add.png) ) をクリックし、 **Manual Selection** を選択する。

1. ［**ホームページコンテンツ**］ という名前を付けます。

1. 新しいコンテンツ・セットについては、「アセット・エントリー」の隣にある「**選択**」 をクリックし、「**基本ウェブ・コンテンツ**」 を選択します。

   ![新しいアセットエントリーを追加するには、「選択」をクリックします。](./personalizing-collections/images/05.png)

1. 基本ウェブコンテンツの選択ページで、追加したいコンテンツを選択し、 **追加** をクリックします。

1. ホーム・ページに移動し、アセット・パブリッシャー・ウィジェットをページに追加します。

1. アセットパブリッシャーの ［**設定**］ を開きます。

1. ［データ選択方法］の下で、 ［**コンテンツセット**］ を選択します。

1. ［コンテンツセットの選択］の下で、 ［**選択**］ をクリックし、 ［**ホームページコンテンツ**］ を選択して、 ［**保存**］ をクリックします。

これで、設定したコンテンツ・セットがホームページのAsset Publisherウィジェットに表示されるようになりました。 次に、パーソナライズ用のコンテンツセットを設定します。

#### コンテンツセットのパーソナライズ

次に、技術者向けのコンテンツセットを作成し、その表示を構成します。

1. サイト管理からコンテンツセットに戻る。

1. **New Personalized Variation** をクリックし、American Engineers セグメントを選択する。

   ![新しいパーソナライズされたバリエーションを作成する。](./personalizing-collections/images/06.png)

1. **Asset Entriesの隣にあるSelect** をクリックし、 **Basic Web Content** を選択する。

1. エンジニアの読者に適した記事を選択し、 ［**追加**］ をクリックします。

これで、アメリカのエンジニアセグメントのメンバーがこのコンテンツセットを表示するときはいつでも、デフォルトではなく、パーソナライズされたバージョンが表示されるようになりました。 シミュレーターを使ってテストしてみましょう。

## 関連情報

- [コンテントページのパーソナライゼーション](./content-page-personalization.md)
- [コレクションとコレクションページについて](../../../content-authoring-and-management/collections-and-collection-pages/about-collections-and-collection-pages.md)
- [ユーザーセグメントの作成](../segmentation/creating-and-managing-user-segments.md)
- [ユーザーセグメントへのロールの割り当て](../../../users-and-permissions/roles-and-permissions/assigning-roles-to-user-segments.md)
