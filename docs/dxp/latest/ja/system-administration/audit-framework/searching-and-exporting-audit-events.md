# 監査イベントの検索とエクスポート

この監査アプリケーションは、シンプルで高度な検索機能を備えています。 簡易検索を使用するには、検索語を入力し、虫眼鏡のアイコンをクリックします。 詳細検索を使用する、

1. 検索アイコンの横にある下向きの矢印をクリックします。

1. 検索フィールドにデータを入力する。

   | 項目                                                  | 説明                                                                                                                   |
   | :---------------------------------------------------------------| :---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
   | 一致                                                  | 指定したすべてのフィールド、または単一のフィールドに一致するものを検索します。                                                                              |
   | ユーザーID                                              | 検索するユーザーID。 これは通常、監査したいアクションを実行したユーザーである。                                                                            |
   | グループ ID {bdg-secondary}`Liferay DXP 7.4 U81+/GA81+` | 利用可能な場合、監査イベントのサイトコンテキストを示すグループID。                                                                                   |
   | 名前                                                  | 検索するユーザー名。 特にユーザーIDを含むデータベースにアクセスできない場合は、ユーザーIDを検索するよりも簡単な場合が多い。                                                     |
   | リソースID                                              | この監査レコードで変更または閲覧されたリソースのID。                                                                                          |
   | クラス名                                                | この監査レコードで変更または閲覧されたリソースの名前。 例えば、誰かがユーザーのアカウントを変更したかどうかを確認するために、ユーザーリソースを検索することができます。                                 |
   | リソースアクション                                           | リソースに対して実行されるアクションの1つ：add、assign、delete、impersonate、login、login_failure、logout、unassign、update。 |
   | セッションID                                             | 検索するセッションID。 これを使って、ウェブサーバーログのセッション ID と Liferay DXP のアクティビティを関連付けることができます。                                          |
   | クライアントIP                                            | 監査したいアクティビティを実行したクライアントのIPアドレス。                                                                                      |
   | クライアントホスト                                           | 監査したいアクティビティを実行したクライアントのホスト名。                                                                                        |
   | サーバ名                                                | アクティビティが発生したサーバー名。 クラスタを使用している場合は、クラスタの各メンバーを個別に照会できます。                                                              |
   | サーバポート                                              | アクティビティが発生したサーバーポート。 同じマシン上で複数のVMからなる垂直クラスターを実行する場合に必要だ。                                                             |
   | 開始日                                                 | 検索したい日付範囲の下限。                                                                                                        |
   | 終了日                                                 | 検索したい日付範囲の上限。                                                                                                        |

1. 虫眼鏡のアイコンをクリックする。

## 監査イベントの表示

特定の監査イベントを見つけたら、それをクリックして詳細情報を得ることができる。 各イベントは以下の分野にスポットを当てている：

* イベントID
* 作成日時
* グループID
* リソースID
* リソース名
* リソースアクション
* ユーザーID
* 名前
* クライアントホスト
* クライアントIP
* サーバ名
* 追加情報

追加情報`は、リソースのアクション中にエンティティに関連するデータをハイライトします。 例えば、ユーザーは作成時にデフォルトでアクティブになっている。 以下に、ユーザーを無効化したときの監査イベントの追加情報を示します。

```json
{"attributes":[{"newValue":"false","name":"active","oldValue":"true"}]}
```

`name`フィールドは変更された属性を示す。 `oldValue`フィールドは更新前のフィールドの値を示し、`newValue`フィールドは更新後のフィールドの値を示す。

## 監査イベントのエクスポート

{bdg-secondary}`liferay DXP 7.4 U81+/GA81+`

サードパーティシステムの監査イベントを分析するために、LiferayはCSVへの監査イベントのエクスポートをサポートしています。 これを行うには、グローバルメニューを開き、 **コントロールパネル** &rarr; **監査** に移動します。 ページ上部の **Actions**(![Actions](../../images/icon-actions.png)) アイコンをクリックし、 **Export Audit Events** を選択します。

これはLiferayインスタンスからすべての監査イベントをエクスポートします。 サブセットをエクスポートしたい場合は、シンプル検索またはアドバンスド検索を使用して結果のセットを取得し、エクスポート機能を使用することができます。 例えば、特定のユーザーの `LOGIN` イベントだけを表示したい場合である、

1. 検索バーに「login」と入力し、虫眼鏡のアイコンをクリックする。

1. ページ上部の **Actions**(![Actions](../../images/icon-actions.png)) アイコンをクリックします。

   ![Exporting audit events for user log in to CSV.](./searching-and-exporting-audits-events/images/01.png)

1. **Export Audit Events** を選択します。

![The CSV file contains all the information associated to login events audited by Liferay.](./searching-and-exporting-audits-events/images/02.png)

`CSV Logging Message Formatter`の設定を変更することで、CSVファイルにエクスポートされるカラムを編集することができます。 詳細は [CSV Logging Message Formatter](./audit-configuration-reference.md#csv-logging-message-formatter) を参照。

```{warning}
CSVエクスポートには、ユーザーが入力した内容が含まれます。 表計算ソフトで開くときは慎重に。
```

```{important}
CSVへのエクスポート機能は、現在リリース機能フラグの後ろにあります。 これを使用するには、`portal-ext.properties`に`feature.flag.LPS-177194=true`を追加するか、`LIFERAY_FEATURE_PERIOD_FLAG_PERIOD__UPPERCASEL__UPPERCASEP__UPPERCASES__MINUS__NUMBER1__NUMBER7__NUMBER1__NUMBER9__NUMBER4_=true`を環境変数として設定に追加します。
```

## 関連トピック

* [監査設定リファレンス](./audit-configuration-reference.md)
