# フォームを利用したユーザーへのアンケート

Liferayの以前のバージョンでは、サイト管理者はサイト管理 &rarr; コンテンツとデータメニューにある専用のPollsアプリケーションにアクセスすることができました。このアプリケーションはLiferay 7.3では [非推奨](../../installation-and-upgrades/upgrading-liferay/reference/maintenance-mode-and-deprecations-in-7-3.md#features-deprecated-in-7-3) 、Liferay 7.4 では [remove](../../installation-and-upgrades/upgrading-liferay/reference/maintenance-mode-and-deprecations-in-7-3.md#features-deprecated-in-7-4 ) となりました。

Liferayフォームは、旧バージョンのLiferayでアンケートアプリケーションが扱っていたユースケースを実現するために強化されました。 新しいアンケートを作成するには、ここで説明する機能を備えたLiferayフォームを使用します。

Liferay 7.2 &rarr; 7.3 &rarr; 7.4 のパスに沿ってアップグレードしている場合、アンケートは自動的に Liferayフォームを使用するようにアップグレードされます。

```{note}
フォームの設定に関する包括的なリストは、[フォーム設定リファレンス](creating-and-managing-forms/forms-configuration-reference.md)に含まれています。
```

## アンケートの作成

Liferayフォームでアンケートのような機能を有効にするために、フォームの設定モーダル、送信セクションに次の3つの設定が追加されました：［Limit to One Submission per User］、［Expiration Date］、［Show Partial Results to Respondents］。

![送信設定は、アンケートのような動作を設定するためのものです。](./using-forms-to-poll-users/images/01.png)

### ユーザーごとに 1 回の送信に制限されています

送信は1ユーザーにつき1回までとします。 ログインしているユーザーに対して、複数のフォーム送信を許可しません。

```{warning}
また、「ユーザーごとに 1 回の送信に制限されています」を有効にすると、フォームに入力する際にユーザーが認証される必要があります。 この要件は、フォームに設定された権限およびフォームの設定_Require User Authentication: False_をオーバーライドします。
```

![ユーザーはフォームを送信できなくなりますが、現在送信されているデータに関するフォームレポートを見ることができます。](./using-forms-to-poll-users/images/03.png)

ユーザーが送信後にフォームを表示すると、Liferayはメッセージを表示します。 Liferay U49+/GA49+では、このメッセージのヘッダーと本文のコンテンツをカスタマイズできます。 それ以外の場合は、デフォルトのメッセージが表示されます。

![ユーザーごとに1回の送信に制限する場合の警告メッセージを設定します。](./using-forms-to-poll-users/images/05.png)

### 有効期限を追加する

デフォルトでは、フォームの有効期限はありません。 ［期限を設定しない］の設定を無効にした場合、フォームの有効期限を設定することができます。 この日を過ぎると、送信はできません。 フォームのユーザーには、フォームへのアクセス時に有効期限切れの通知が表示されます。

![フォームの有効期限が切れた場合、ユーザーは部分的な結果のみを見ることができます（有効な場合）。](./using-forms-to-poll-users/images/04.png)

### 回答者に一部の結果を表示します

回答者が現在送信されているフォームレコードの集計データを閲覧できるようにします。 回答者は、フォームの現在の [フォームレポート](./sharing-forms-and-managing-submissions/form-reports.md#show-partial-results-to-form-respondents) のデータを見ることができます。 この機能を有効にすると、機密情報を送信しないように警告します。

![ユーザーは機密情報を共有しないように警告されています。](./using-forms-to-poll-users/images/02.png)

### Liferayフォームでアンケートを作成する

フォームを使ったアンケートを利用して、サイト訪問者をサイトのコンテンツに引き付けておくことができます。

サイトメニューの ［**フォーム**］ アプリケーションとページに追加する ［**フォーム**］ ウィジェットの2つのアプリケーションがアンケートを作成・表示します。

1. サイトメニューから ［**コンテンツ**］ &rarr; ［**アンケート**］ に進みます。 

1. ![Add](../../images/icon-add.png)ボタンをクリックし、タイトルと説明を入力します。

1. フォームがアンケートのように動作するように設定するには、［フォームの設定］ウィンドウを開き、［送信］セクションに移動し、次のようにします。 

   - ［**回答者に一部の結果を表示します**］ ：有効
   - ［**ユーザーごとに 1 回の送信に制限されています**］ ：有効
   - ［**期限を設定しない**］ ：必要に応じてチェックを外す（有効期限を設定する）

1. ここで、アンケートの質問を設定します。 フォームに複数行の必須テキストフィールドを追加します。

   - **ラベル：** 今回の訪問はいかがでしたか？
   - **フィールドタイプ：** 複数行
   - **必須項目：** 有効

1. ［**公開**］ をクリックすると、フォームがユーザーに公開されます。
   
   フォームには、直接リンクするか、Liferayのページにフォームを表示してアクセスします。 詳しくは、 [フォームの公開](creating-and-managing-forms/creating-forms.md#publishing-a-form) をご覧ください。 


## アンケートをフォームにアップグレードする

Liferay 7.2 &rarr; 7.3 &rarr; 7.4のパスに沿ってLiferayをアップグレードしている場合、［アンケート］は自動的に［フォーム］を使用するようにアップグレードされます。 7.4のライフサイクルの間、このタスクを達成するためのアップグレードプロセスが強化されました。Liferay 7.4 GA/Update 27の時点で、次のことが可能になりました。

- バックエンドでエンティティを変換することで、アンケートをフォームエンティティにし、フォームアプリケーションとAPIで管理できるようになります。
- アンケートのような動作をするフォーム設定を有効にします。
- アンケートが［Polls Display］ウィジェットでページ上に表示されていた場合、アップグレード後は［フォーム］ウィジェットでページ上に表示されるようになります。

```{warning}
DXP Update 27/CE GA 27より前のバージョンのLiferay 7.4に[アップグレードされた](../../installation-and-upgrades/upgrading-liferay.md)インストールの場合、アップグレード処理が不完全になることがありました。 アンケートを完全にアップグレードするには、

- フォームで_Limit to One Submission per User_が設定されていることを確認する必要があります。
- ページ上にあった［Polls Display］ウィジェットを手動で［フォーム］ウィジェットに置き換えます。
```

## 関連トピック

- [フォームの作成と管理](./creating-and-managing-forms.md)
- [7.4のメンテナンスモードと非推奨](../../installation-and-upgrades/upgrading-liferay/reference/maintenance-mode-and-deprecations-in-7-4.md)
