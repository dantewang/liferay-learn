# カスタム要素とIFrameクライアント拡張機能を理解する

カスタムエレメントとIFrameクライアント拡張は、アプリケーションをLiferayに登録し、サイトページ上にウィジェットとしてレンダリングします。

これらのフロントエンド拡張の1つを作成すると、Liferayはウィジェットを生成してOSGiサービスレジストリに追加します。 アプリケーションのレンダリング方法を設定するために、エントリまたはウィジェットスコープで追加のプロパティを設定することができます。

カスタムエレメントとIFrameアプリケーションは、異なるホスト、異なるレンダリング、そしてLiferayサービスとランタイムデータへの異なるレベルのアクセスを持っています。

```{tip}
カスタム要素](#using-the-custom-element-type)タイプは、Liferayプラットフォームとの統合性が高く、より複雑なシナリオをサポートします。
```

## カスタム要素タイプの使用

カスタム要素クライアント拡張タイプは、外部アプリケーションコードを独立したHTML `<custom-element>` にレンダリングし、Liferayホストページとの完全な統合を提供します。 カスタム要素アプリケーションのアーキテクチャは、Liferayサーバー、Liferayホストページ、アプリケーションのコードを格納するサーバーの3つの主要な部分を含んでいます。 Liferayはこれらのファイルを使用して、ブラウザでアプリケーションを作成します。

![カスタムエレメントアーキテクチャは、Liferayサーバーのエントリ、サーバーに格納されたアプリケーションコード、クライアント拡張のユニークなウィジェットを持つLiferayページが含まれます。](./understanding-custom-element-and-iframe-client-extensions/images/02.png)

各カスタム要素の項目には、HTML要素名と必要なJavaScriptやCSSファイルのURLが含まれています。 また、実行時にアプリケーションと一緒にレンダリングされるプロパティも含めることができます。

ページに追加されると、Liferayはクライアント拡張機能のJavaScriptとCSSファイルを `<script>` 、 `<link>` 要素を通じてページに直接挿入します。 JavaScriptはアプリケーションを宣言してインスタンス化し、CSSファイルはそれをスタイル化する。

```{important}
アプリケーションのコードは、カスタム要素を宣言し、リモートアプリのエントリにある名前と一致するHTML要素名を提供する必要があります。 このため、アプリのコードが読み込まれると同時にブラウザでカスタム要素宣言が実行されるように、 [IIFE](https://developer.mozilla.org/en-US/docs/Glossary/IIFE) を使用する必要があります。
```

リモートアプリのウィジェットがページに追加されると、まず指定されたHTML要素名のタグを生成し、その要素のコードで定義されたロジックを実行することによって、アプリケーションマークアップをレンダリングします。 エントリーまたはウィジェットインスタンスにプロパティが含まれる場合、それらは生成されたカスタム要素マークアップ(`<custom-element (+props)/>`）に追加されます。

レンダリングされると、アプリケーションはLiferayのページに完全に統合され、Liferayの公開JavaScript APIを使用したり、ホストページですでに利用可能なスタイルクラスを再利用したりすることができます。 ただし、カスタム要素の作り方やスタイルルールの置き場所によって、これを変更することは可能です。 例えば、アプリケーションのマークアップが [Shadow DOM](https://developer.mozilla.org/en-US/docs/Web/Web_Components/Using_shadow_DOM)を使用している場合、カスタム要素のスタイルとホストページを互いに分離することができます。

```{note}
カスタム要素ウィジェットの複数のインスタンスがページに追加された場合、LiferayはアプリケーションのURLを1回だけ含めるようにします。
```

## IFrameタイプの使用

IFrameクライアント拡張タイプは、外部アプリケーションを別の `<iframe>` 要素にレンダリングし、LiferayのクライアントSDK APIを使用してホストページとの限定的な対話を可能にします。 IFrameアプリケーションのアーキテクチャは、Liferayサーバー、Liferayホストページ、そしてアプリケーションをホストする外部サーバーの3つの主要な部分を含んでいます。

![IFrameアーキテクチャは、Liferayサーバーのエントリ、外部サーバーでホストされているアプリケーション、クライアント拡張のユニークなウィジェットを持つLiferayページが含まれています。](./understanding-custom-element-and-iframe-client-extensions/images/01.png)

各IFrameエントリーは、通常外部サーバーから提供されるアプリケーションにリンクするIFrame URLを格納します。 その結果、アプリケーションは、マークアップ、スクリプト、スタイル、および(オプションで）クライアントSDKを含むHTMLドキュメントを提供する必要があります。

クライアントの拡張機能のウィジェットをページに追加すると、LiferayはエントリーのURLを使用して、外部アプリケーションのコンテンツを入力した `<iframe>` タグをレンダリングします。 エントリーやウィジェットのインスタンスにプロパティが含まれている場合、それらは追加のURL属性(`<iframe (+properties)/>`）としてアプリケーションに渡され、アプリケーションはプログラム的にそれらにアクセスすることができます。

```{note}
IFrameアプリは、独自のマークアップを組み立てて、ウィジェットの `<iframe>` 要素を埋めるためにブラウザに送信できるように、サーバーにデプロイする必要があります。 これに対して、[カスタム要素アプリ](#using-the-custom-element-type)は、マークアップを生成するためにサーバーを必要としない。 ブラウザはアプリのウィジェットやJavaScriptのコードで必要なロジックを実行するため、アプリケーションのコードをURLで利用できるようにするだけです。
```

デフォルトでは、すべてのブラウザはIFrameアプリケーションに対して「同一生成元」ポリシーを課し、ホストページとその外部アプリケーション間の情報フローを防止しています。 Liferayは、IFrame要素とLiferayページの間の限定的な通信を可能にするクライアントSDKスクリプトを提供します。 `postMessage()` APIを介して、ページとの通信プロトコルを実装することで動作します。 このスクリプトを使用するには、アプリケーションのマークアップに含める必要があります。

IFrameアプリがクライアントSDKを使用する場合、Liferayページは現在のログインユーザーとしてアプリケーションに代わって特定のアクションを実行する指示を受け取ります。 これには、DXPサーバーへのサービス呼び出しや、ステータスの詳細へのアクセス(例：ホストページのトーストのオープン、Headless APIの呼び出し、GraphQLクエリの実行、スタイルプロパティへのアクセス）などがあります。

## 追加情報

* [クライアントエクステンションの紹介](../../client-extensions.md)
* [基本的なカスタム要素の作成](./tutorials/creating-a-basic-custom-element.md)
* [リモートアプリケーションUIリファレンス](./remote-applications-ui-reference.md)
