# 暗号化されたフィールド

{bdg-primary}`セルフホストおよびセルフマネジメントのみ`

{bdg-secondary}`Liferay 7.4 U72+/GA72+`

Liferayは機密性の高いユーザーデータを保存するために暗号化フィールドタイプを提供します。 暗号化フィールドを使用するには、まずポータルのプロパティに暗号化アルゴリズムとキーを追加します。 次に、オブジェクト定義に暗号化フィールドを追加する。 いったんデータが暗号化されると、復号化キーを持つユーザーのみがそれを読むことができる。

```{important}
暗号化フィールドは文字列値を保存し、画像やファイルタイプの暗号化には使用できません。 フィルタリング、ソート、インデックス作成は、暗号化されたフィールドではサポートされていません。 さらに、[プロキシ・オブジェクト定義](../../integrating-objects-with-third-party-services/managing-data-from-external-systems.md)では、フィールドの暗号化は利用できない。
```

## 暗号化アルゴリズムとキーの追加

オブジェクトの暗号化アルゴリズムとキーを使用するには、これらのプロパティを [`portal-ext.properties`](../../../../installation-and-upgrades/reference/portal-properties.md) ファイルに追加する必要があります：

```properties
object.encryption.algorithm=[value]

object.encryption.key=[value]
```

サポートされるアルゴリズム値には、 `AES`、 `Blowfish`、 `DES`がある。 暗号化キーの値は、base64エンコーディングを使用する必要があります。 たとえば、

```properties
object.encryption.algorithm=AES

object.encryption.key=D9z5Rwxkn+8SctNWW/q/OA==
```

## 暗号化フィールドの追加

1. ［**グローバルメニュー**］（![Global Menu](../../../../images/icon-applications-menu.png)）を開き、 ［**コントロールパネル**］ タブに移動して、 ［**オブジェクト**］ をクリックします。

1. 目的のオブジェクト定義の編集を開始します。

1. **Fields** タブを開き、 **Add**( ![Add Button](../../../../images/icon-add.png) ) をクリックする。

1. **ラベル** と **項目名** を入力します。

1. **Encrypted** フィールドタイプを選択する。

1. フィールドが必須かどうかを判断する。

1. ［**Save**］ をクリックします。

   ```{note}
   暗号化アルゴリズムとキーがなければ、暗号化されたフィールドを保存することはできない。
   ```

このフィールドを使用して、暗号化された文字列値を保存することができます。 必要であれば、フィールドの文字数制限を設定することができます。

## 暗号化されたデータへのアクセス

暗号化されたフィールド値を読むことができるのは、復号化キーを持つユーザーだけである。 Liferayインスタンスに有効な暗号化キーがあれば、許可されたユーザーはLiferay UIやREST API経由でフィールドのデータを表示したりエクスポートしたりできます。 しかし、暗号化キーが失われたり無効になったりすると、ユーザは暗号化されたフィールドを持つオブジェクト定義のエントリにアクセスしたりエクスポートしたりできなくなります。 試行すると、Liferayは400エラーを返し、有効な暗号化キーを挿入するか、オブジェクトの暗号化されたフィールドを削除してエントリーを回復するようにユーザーに指示します。

```{important}
キーを紛失すると、データが失われる可能性があります。 暗号鍵の管理には十分ご注意ください。 お客様は、ご自身のデータと鍵がバックアップされ、安全な場所に保管されていることを確認する責任があります。

<もし鍵が漏洩した場合は、Import/Export Centerを使用してオブジェクトデータをエクスポートし、`object.encryption.key`プロパティを更新してからデータを再インポートしてください。 -->
```

## 関連トピック

* [ポータルプロパティ](../../../../installation-and-upgrades/reference/portal-properties.md)
* [オブジェクトへのフィールドの追加](./adding-fields-to-objects.md)
