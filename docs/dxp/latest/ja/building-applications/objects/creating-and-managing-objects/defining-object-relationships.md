# オブジェクトリレーションの定義

{bdg-secondary}`Liferay 7.4以降で利用可能`

リレーションシップは、オブジェクト定義間の接続で、そのエントリーをリンクさせるために使用します。 システムオブジェクトとカスタムオブジェクトの両方を含む、あらゆる発行済みまたは未発行のオブジェクトにリレーションシップを追加することができます。

## リレーションシップの種類

オブジェクトには、次の2種類のリレーションシップがあります。

<!--TASK: Add One to One after it's been implemented-->

**One to Many** : 1つのオブジェクトエントリーを複数のオブジェクトエントリーに関連付けることができます。 選択すると、リレーションシップの子側（つまり「多」側）のエントリには新しいフィールドが追加され、「親」側（つまり「一」側）のエントリにはテーブルが追加されます。 子側では、オブジェクトのカスタムレイアウトの [Fields Tab](./designing-object-layouts.md#adding-fields-tabs) に新しいフィールドを追加して、そのエントリーをリレーションシップの親側のエントリーに関連付けることができます。 親側では、新しいテーブルをオブジェクトのカスタムレイアウトの [Relationships Tab](./designing-object-layouts.md#adding-relationships-tabs) に追加することができ、現在の親エントリに関連するすべてのエントリをリストアップします。

**Many to Many** : 複数のオブジェクトエントリーを、複数のオブジェクトエントリーに関連付けることができます。 選択すると、リレーションシップの両側に新しいデータベーステーブルが作成されます。 このテーブルは、オブジェクトのカスタムレイアウトの [Relationships タブ](./designing-object-layouts.md#adding-relationships-tabs) に追加でき、関連するすべてのエントリを一覧表示します。

```{important}
リレーションシップテーブルの表示には、カスタムレイアウトが必要です。 ただし、カスタムレイアウトはシステムオブジェクトには対応していないため、リレーションシップテーブルを表示することはできません。 詳しくは、[オブジェクトレイアウトの設計](./designing-object-layouts.md)を参照してください。 
```

## 新しいリレーションシップの追加

以下の手順で、オブジェクトにリレーションシップを追加します。

1. **グローバルメニュー**（![Global Menu](../../../images/icon-applications-menu.png)）を開き、 ［**コントロールパネル**］ タブをクリックして、 ［**オブジェクト**］ に進みます。

1. 目的のオブジェクト定義の編集を開始します。

1. **Relationships** タブを開き、 **Add** ボタン (![Add Button](../../../images/icon-add.png)) をクリックします。

   ![ラベルと名前を入力し、リレーションシップの種類と目的のオブジェクトの両方を選択します。](./defining-object-relationships/images/01.png)

1. **ラベル** と **名前** を入力します。

   **ラベル** ：オブジェクトUIでリレーションシップを識別し、リレーションシップの作成後にローカライズできます。

   **Name** : バックエンドでのリレーションシップの名前を決定し、キャメルケースを使用します。 リレーションシップが公開されると、この値は変更できません。

1. リレーションシップの種類（［**一対多**］ または ［**多対多**］）を選択します。 <!--TASK: Add One to One after it's been implemented-->

1. **オブジェクト** を選択し、現在のオブジェクトに関連付けます。 オブジェクトを自分自身や他のオブジェクト定義に関連付けることができます。

   ```{note}
   7.4 U46/GA46以降では、オブジェクト定義をそれ自身に関連付ける一対多および多対多のリレーションシップを定義することができます。 以前は、同じオブジェクト内のエントリーを関連付けるには、一対多のタイプしか使用できませんでした。 <!--タスク：実装後に1対1で追加-->
   ```

1. ［**保存**］ をクリックします。

   ![［保存］をクリックすると、保存された関連が［リレーションシップ］タブに一覧表示されます。](./defining-object-relationships/images/02.png)

[一度保存すると、新しいリレーションシップは、関連するオブジェクトのカスタムレイアウト](./designing-object-layouts.md) に追加することができます。 そして、リレーションシップフィールドとテーブルを使用して、オブジェクトエントリーを互いに関連付けることができます。

## 削除タイプの構成

リレーションシップが保存されたら、その削除タイプを構成できます。 この設定は、エントリーが別のエントリーに関連付けられている場合のエントリーの削除の処理方法を決定し、リレーションシップが作成された後にのみ使用できます。

![リレーションシップを作成した後、その削除タイプを構成できます。](./defining-object-relationships/images/03.png)

使用可能なオプションには、 ［**Prevent**］ 、 ［**Disassociate**］ 、および ［**Cascade**］ があります。

**Prevent**（デフォルト）：親側のエントリは、子エントリに関連している場合は削除できません。

**Disassociate** ：親側のエントリは、関連する子エントリに影響を与えることなく自由に削除できます。

**Cascade** : 親側のエントリーは自由に削除することができます。親エントリーを削除すると、関連する子エントリーも削除されます（ただし、ユーザーが子オブジェクトに対して必要な権限を持っている場合に限ります）。

## リレーションシップフィールドの必須化

{bdg-secondary}`For 7.4 U47+/GA47+`

シナリオによっては、リレーションシップフィールドを必須としたい場合があります。例えば、Ticket オブジェクトを作成する場合、'assignee' を選択するための必須リレーションシップフィールドを定義したいと思うかもしれません。あるいは、アカウントごとに [アカウントによるオブジェクトデータへのアクセス制限](./using-system-objects-with-custom-objects/restricting-access-to-object-data-by-account.md) 場合は、そのオブジェクトとアカウントオブジェクトの関係を必須とする必要があります。

リレーションシップのフィールドを必須にするには、以下の手順に従います。

1. 目的のリレーションシップフィールドを持つ **オブジェクト** の編集を開始します。

1. **Fields** タブを開き、 **Relationship field** の編集を開始します。
   
   ![フィールド]タブに移動し、リレーションシップフィールドの編集を開始する](./defining-object-relationships/images/04.png)

1. **Mandatory** スイッチを切り替えます。
   
   ![必須（Mandatory）スイッチを切り替えます。](./defining-object-relationships/images/05.png)

1. ［**Save**］ をクリックします。

## リレーションシップの削除

{bdg-secondary}`7.4 U26+/GA26+ 用`

ドラフトとパブリッシュされたオブジェクトの両方の定義からリレーションシップを削除することができます。 リレーションシップを削除すると、関連するオブジェクト定義からそのフィールドが永久に削除されます。 公開された定義の場合、これは多くのレコードに影響を与える可能性があります。

```{important}
Liferay 7.4 U26/GA26 以前のバージョンでは、 [published](./creating-objects.md#publishing-object-drafts) の時点でオブジェクトに含まれている関係をユーザーが削除できないようになっています。
```

以下の手順に従って、公開オブジェクト定義からリレーションシップを削除してください。

1. ［**グローバルメニュー**］（![Global Menu](../../../images/icon-applications-menu.png)）を開き、 ［**コントロールパネル**］ タブに移動して、 ［**Objects**］ をクリックします。

1. 目的のオブジェクト定義の編集を開始し、 **Relationships** タブに移動します。

1. 目的のリレーションシップの **アクション** ボタン (![Actions Button](../../../images/icon-actions.png))をクリックし、 ［**削除**］ を選択します。

1. ダイアログウィンドウで、リレーションシップの名前を入力し、 **Delete** をクリックして確認します。
   
   ![リレーションシップの名前を入力し、［Done］をクリックします。](./defining-object-relationships/images/06.png)

## 追加情報

* [オブジェクトの作成](./creating-objects.md)
* [オブジェクトへのフィールドの追加](./adding-fields-to-objects.md)
* [オブジェクトレイアウトの設計](./designing-object-layouts.md)
* [オブジェクトの管理](./managing-objects.md)
