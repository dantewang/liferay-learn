# カスタムバリデーションの追加

{bdg-secondary}`Liferay 7.4 U27以降とGA27以降で利用可能`

カスタムオブジェクトで、カスタムフィールドとメタデータフィールドの両方にバリデーションを追加できます。 バリデーションは有効なフィールドエントリーを決定するために使用されるルールを設定し、[Groovy](https://groovy-lang.org/)スクリプト、またはLiferayの[エクスプレッションビルダー](./expression-builder-validations-reference.md)を使って定義されます。 各バリデーションには、独自のトリガー、条件、エラーテキストがあり、オブジェクトUIから設定することができます。 バリデーションが開始されると、定義した条件に従ってフィールドエントリーが有効かどうかがチェックされ、無効なエントリーに対してはエラーテキストが表示されます。

![カスタムおよびメタデータのオブジェクトフィールドのバリデーションを作成します。](./adding-custom-validations/images/01.png)

```{note}
バリデーションを作成する前に、必要なデータフィールドが存在する必要があります。
```

以下の手順で、カスタムバリデーションを追加します。

1. **グローバルメニュー**（![Global Menu](../../../images/icon-applications-menu.png)）を開き、 ［**コントロールパネル**］ タブをクリックして、 ［**オブジェクト**］ に進みます。

1. カスタムオブジェクトの編集を開始します。

1. ［**Validations**］ タブに移動し、 **追加** ボタン（![Add Button](../../../images/icon-add.png)）をクリックします。

1. **ラベル** を入力し、バリデーションタイプ、つまり **Groovy** または **エクスプレッションビルダー** を選択します。

   ![ラベルを入力し、入力値の検証タイプを選択します。](./adding-custom-validations/images/02.png)

1. ［**Save**］ をクリックします。

1. 新しく作成したバリデーションの編集を開始します。

1. ［**Conditions**］ タブに移動して、バリデーションに条件を追加します。

   ![バリデーションに条件を追加します。](./adding-custom-validations/images/03.png)

   Groovyを使用する場合、サイドパネルから利用可能なデータフィールドを参照し、条件に追加することができます。 詳細は、[Groovyバリデーションの使用](#using-groovy-validations)を参照してください。

   エクスプレッションビルダーを使用する場合、サイドパネルからフィールド、演算子、関数を参照し、条件に追加できます。 詳細は、 [エクスプレッションビルダーバリデーションの使用](#using-expression-builder-validations) を参照してください。

   ```{tip}
   条件には、複雑な検証をするための複数のフィールドや関数を含めることができます。
   ```

1. ローカライズ可能な **エラーメッセージを入力します** 。 このメッセージは、バリデーションが開始され、フィールドエントリーが1つ以上の定義された条件を満たさない場合に表示されます。

1. ［**Basic Info**］ タブを開き、バリデーションを **有効に** します。

1. ［**Trigger Event**］ を選択し、フィールドエントリーに対して入力値の検証が実行されるタイミングを決定します。

   ```{note}
   各検証は、1つのトリガーイベントしか持つことができません。
   ```

   ![バリデーションを有効にし、トリガーイベントを設定します。](./adding-custom-validations/images/04.png)

1. ［**Save**］ をクリックします。

有効にすると、すべての新規オブジェクトエントリーに対して検証が実行されます。

## Groovyバリデーションの使用

Groovyバリデーションタイプは、標準Groovyスクリプト機能をすべてサポートしています。 ただし、Groovyの条件を定義する場合は、 `invalidFields` 変数を使用します。 この変数は、無効なフィールド値に対しては `true` を、有効なフィールド値に対しては `false` を返すようにする必要があります。 エラーメッセージは、 `invalidFields` が `true`を返すときだけ表示されます。

```{note}
Groovy型では、現在、チェック構文の検証を行いません。
```

![サイドパネルを使用して、Groovyバリデーションにフィールド要素を追加します。](./adding-custom-validations/images/05.png)

## エクスプレッションビルダーバリデーションの使用

エクスプレッションビルダータイプには、規定値フィールド、演算子、関数が用意されており、条件サイドパネルでアクセスすることができます。 要素をクリックすると、その要素が条件エディタに追加されます。 これらの関数は、ブール値を返します。 有効なエントリーを示す`true` もあれば、無効なエントリーを示す`true` もあります。 提供される演算子や関数の完全なリストについては、 [エクスプレッションビルダーバリデーションのリファレンス](./expression-builder-validations-reference.md) を参照してください。

```{important}
エクスプレッションビルダーバリデーションは、テキスト、数値、日付、ブール値の各フィールドタイプでのみ使用可能です。
```

![サイドパネルを使用して、フィールド、演算子、関数の要素をバリデーションに追加します。](./adding-custom-validations/images/06.png)

## 利用可能なフィールドのリファレンス

条件を作成する際、オブジェクトのカスタムフィールドやメタデータフィールドのいずれかを使用できます。 また、リレーションシップの「片側」のリレーションシップフィールドから選択することも可能です。

次の表は、カスタムオブジェクトに含まれるすべてのデフォルトのメタデータフィールドの一覧です。

| 項目                      | 説明                     |
|:----------------------- |:---------------------- |
| `companyId`             | エントリーが作成されたポータルインスタンス  |
| `createDate`            | エントリーが作成された日時          |
| `externalReferenceCode` | エントリーの外部参照コード          |
| `groupId`               | エントリーが作成されたサイトID       |
| `lastPublishDate`       | エントリーが最後に公開された日付       |
| `modifiedDate`          | エントリーが最後に更新された日付       |
| `mvccVersion`           | エントリーのMVCCバージョン        |
| `objectDefinitionId`    | エントリーのオブジェクトのID        |
| `objectEntryId`         | エントリーのID               |
| `status`                | エントリーのワークフローステータス      |
| `statusByUserId`        | ワークフローで割り当てられたユーザーのID  |
| `statusByUserName`      | ワークフローで割り当てられたユーザーの名前  |
| `statusDate`            | ワークフローステータスが最後に更新された日付 |
| `userEmailAddress`      | エントリー作成者のメールアドレス       |
| `userFirstName`         | エントリー作成者の名             |
| `userId`                | エントリー作成者のID            |
| `userLastName`          | エントリー作成者の姓             |
| `userName`              | エントリー作成者のユーザー名         |
| `uuid`                  | エントリーの重複しないユニバーサルID    |

```{note}
カスタムフィールドの他に、以下のメタデータフィールドが編集サイドバーに一覧表示され、簡単にアクセスできるようになっています。

* 作成者 (`userName`)
* 作成日 (`createDate`)
* ID (`objectEntryId`)
* 編集日時 (`lastPublishDate`)
* ユーザーのメールアドレス (`userEmailAddress`)
* ワークフローステータス (`status`)
```

## 追加情報

* [オブジェクトの作成](./creating-objects.md)
* [オブジェクトへのフィールドの追加](./adding-fields-to-objects.md)
* [エクスプレッションビルダーバリデーションのリファレンス](./expression-builder-validations-reference.md)
