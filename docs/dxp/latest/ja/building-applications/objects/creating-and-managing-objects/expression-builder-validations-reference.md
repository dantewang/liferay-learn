# エクスプレッションビルダーバリデーションのリファレンス

{bdg-secondary}`Liferay 7.4 U27以降とGA27以降で利用可能`

カスタムオブジェクトでは、Liferayのエクスプレッションビルダーを使用してフィールドのバリデーションを作成できます。 このツールには、定義済みのフィールド、演算子、関数を使用して複雑なバリデーションルールを迅速に定義するための統合エディターがあります。 利用可能なエレメントは、条件サイドパネルで閲覧できます。

```{important}
エクスプレッションビルダーバリデーションは、テキスト、数値、日付、ブール値の各フィールドタイプでのみ使用可能です。
```

## テキスト項目

Liferayは、テキストおよび長いテキストフィールドに対して以下の演算子および関数を提供します。 これらのフィールドのいずれかを引数として使用できます。 いくつかの要素では、フィールドの値と比較するためのString値を追加することもできます（例： `"foo"`、`"[A-Za-z]{1,50}"`）。

### 連結

複数の文字列またはテキストフィールドを結合して、他の検証関数で使用できる単一の文字列を返します。

```
concat(text_field_id, "<string>")
```

### が以下を含む

テキストフィールドが特定のString値を含んでいるかどうかを確認し、ブール値を返します。 フィールドに値を **含む** 場合は、無効となります。

```
contains(text_field_id, "<string>")
```

### が以下を含まない

テキストフィールドが特定のString値を含んでいるかどうかを確認し、ブール値を返します。 フィールドに値を **含む** 場合は、無効となります。

```
NOT(contains(text_field_id, "<string>"))
```

### URL である

テキストフィールドがURLであるかどうかを確認し、ブール値を返します。 フィールドがURLパターンに一致しない場合は、無効となります。 有効なエントリーには、標準的なURL要素（例： `http`, `://`, `.com`）を使用する必要があります。

```
isURL(text_field_id)
```

### メールアドレスである

テキストフィールドがメールアドレスであるかどうかを確認し、ブール値を返します。 フィールドが特定のメールアドレスまたはメールアドレスパターンに一致しない場合は、無効となります。 有効なエントリーには、標準的なURL要素（e.g., `@gmail`, `.com`）を使用する必要があります。

```
isEmailAddress(text_field_id)
```

### が空の場合

テキストフィールドが空であるかどうかを確認し、ブール値を返します。 空のフィールドは無効となります。

```
isEmpty(text_field_id)
```

### が以下と等しい

テキストフィールドが特定のString値に等しいかどうかを確認し、ブール値を返します。 等しくない場合は、無効となります。

```
text_field_id == "<string>"
```

### 等しくない

テキストフィールドが特定のString値と異なるかどうかを確認し、ブール値を返します。 等しい場合は、無効となります。

```
text_field_id != "<string>"
```

### 一致

テキストフィールドが特定のString値または正規表現と一致するかどうかを確認し、ブール値を返します。 フィールドが値と一致しない場合は、無効となります。

```
match(text_field_id, "<string>")

match(text_field_id, "<regex>")
```

## 数値フィールド

Liferayでは、整数、長整数、小数、小数の精度フィールドに対して以下の演算子や関数を提供します。 これらのフィールドのいずれかを引数として使用できます。 いくつかの要素では、フィールドの値と比較するための数値を追加することもできます（例：`123`、 `3.1415`）。

### が以下を含む

数値フィールドが特定の数値を含んでいるかどうかを確認し、ブール値を返します。 **含んでいる** 場合、そのフィールドは無効となります。

```
contains(numeric_field_id, <number>)
```

### 含まない

数値フィールドが特定の数値を含んでいるかどうかを確認し、ブール値を返します。 **含んでいない** 場合、そのフィールドは無効となります。

```
NOT(contains(numeric_field_id, <number>))
```

### 小数である

数値フィールドが小数であるかどうかを確認し、ブール値を返します。 小数である場合、そのフィールドは無効となります。

```
isDecimal(numeric_field_id)
```

### 整数である

数値フィールドが整数であるかどうかを確認し、ブール値を返します。 整数である場合、そのフィールドは無効となります。

```
isInteger(numeric_field_id)
```

### が以下と等しい

数値フィールドが特定の数値に等しいかどうかを確認し、ブール値を返します。 等しい場合、そのフィールドは無効となります。

```
numeric_field_id == <number>
```

### 等しくない

数値フィールドが特定の数値と異なるかどうかを確認し、ブール値を返します。 異なる場合、そのフィールドは無効となります。

```
numeric_field_id != <number>
```

### 以上

数値フィールドが特定の数値より大きいかどうかを確認し、ブール値を返します。 大きい場合、そのフィールドは無効となります。

```
numeric_field_id > <number>
```

### 以上もしくは等しい

数値フィールドが特定の数値以上もしくは等しいかどうかを確認し、ブール値を返します。 特定の数値以上もしくは等しい場合、そのフィールドは無効となります。

```
numeric_field_id >= <number>
```

### 以下

数値フィールドが特定の数値以下かどうかを確認し、ブール値を返します。 以下である場合、そのフィールドは無効となります。

```
numeric_field_id < <number>
```

### 以下もしくは等しい

数値フィールドが特定の数値以下もしくは等しいかどうかを確認し、ブール値を返します。 特定の数値以下もしくは等しい場合、そのフィールドは無効となります。

```
numeric_field_id <= <number>
```

### 合計

複数の数値フィールドをまとめて追加し、他の検証関数で使用可能な単一の数値を返します。

```
sum(firstNumeric_field_id, secondNumeric_field_id)
```

## 日付フィールド

Liferayは、日付フィールドに対して以下の演算子および関数を提供します。 任意の日付フィールドを引数として使用できます。 また、日付フィールドと比較するための日付値を設定できます（例： `2020-03-19`）。

### 未来の日付

日付フィールドの値が将来かどうかを確認し、ブール値をします。 将来でない場合、そのフィールドは無効となります。

```
futureDates(date_field_id, "<yyyy-MM-dd>")
```

### 過去の日付

日付フィールドの値が過去かどうかを確認し、ブール値をします。 過去でない場合、そのフィールドは無効となります。

```
pastDates(date_field_id, "<yyyy-MM-dd>")
```

### 範囲

日付の範囲が過去の日付で始まり、未来の日付で終わるかどうかを確認します。 そうでない場合、そのフィールドは無効となります。

```
pastDates(date_field_id, "<yyyy-MM-dd>")
AND
futureDates(date_field_id, "<yyyy-MM-dd>")
```

## 数学演算子

数値フィールドには、以下のいずれの数学演算子も使用できます。

### プラス（`+`）

複数の数値フィールドを加算して式を作成します。

```
firstNumeric_field_id + secondNumeric_field_id,
```

### マイナス（`-`）

複数の数値フィールドをお互いに減算して式を作成します。

```
firstNumeric_field_id - secondNumeric_field_id,
```

### 除算（`/`）

ある数値フィールドを別の数値フィールドで除算して式を作成します。

```
firstNumeric_field_id / secondNumeric_field_id,
```

### 乗算（`*`）

複数の数値フィールドを乗算して式を作成します。

```
firstNumeric_field_id * secondNumeric_field_id,
```

## 論理演算子

論理演算子は複数の要素で使用し、複数の要素から複雑な条件を集計します。 現在、エクスプレッションビルダーの検証は `AND` と `OR` の演算子を提供しています。

* `AND`：これは依存する関係を表すのによく使用される等位接続詞の一種です。

* `OR`：これは独立した関係を表す別タイプの等位接続詞です。

次の例では、 `AND`節は互いに依存しているので、一緒に適用される必要があります。 これに対し、 `OR` 節は論理的に分離されており、相互に依存していません。

```
match(cellphoneNumber_field_id, "^([1-9]{2}) (?:[2-8]|9[1-9])[0-9]{3}-[0-9]{4}$")
AND match(name_field_id, "[A-Za-z]{1,50}")
AND match(address_field_id, "[A-Za-z]{1,50}")
OR numeric_field_id == 1
OR match(lastName_field_id, "[A-Za-z]{1,50}")
```

## バリデーション例

以下のバリデーションは一般的な例です。

### 名前のバリデーション (テキスト)

このバリデーションでは、値をアルファベット文字に限定し、許容される文字数が制限されます。

```
match(name_field_id, ("[A-Za-z]{1,50}")
```

このバリデーションでは、姓に数字を含めることができます。

```
match(lastName_field_id, "[A-Za-z][0-9]{1,50}")
```

### パスワード（テキスト）

このバリデーションは、有効なパスワードかどうかを確認します。 これには、以下の制限が含まれます。

* 8文字以上
* 一意の5文字以上
* 1記号以上
* 1つ以上の数値
* スペースなし

```
match(password_field_id, "^(?=.*[A-Za-z])(?=.*d)(?=.*[@$!%*#?&])[A-Za-zd@$!%*#?&]{8,}$")
```

### 携帯電話番号（数値）

このバリデーションは、有効な電話番号かどうかを確認します。 バリデーションはエントリーを数字に限定し、文字数も制限し、標準的な電話番号のパターンを設定します。

```
match(cellphoneNumber_field_id, "^([1-9]{2}) (?:[2-8]|9[1-9])[0-9]{3}-[0-9]{4}$")
```

### 郵便番号（数値）

このバリデーションは、有効な郵便番号かどうかを確認します。 バリデーションはエントリーを数字に限定し、文字数も制限し、標準的な郵便番号のパターンを設定します。

```
match(postal_field_id, "^([1-9]{2}) (?:[2-8]|9[1-9])[0-9]{3}-[0-9]{4}$")
```

### 年齢幅の指定（日付）

この例では、ユーザーの年齢が18～65歳であるかどうかを確認します。 そうでない場合、そのエントリーは無効となります。

```
pastDates(date_field_id, startsFrom, responseDate, years, -120, endsOn, responseDate, years, -18)
AND
futureDates(date_field_id, startsFrom, responseDate, years, 0, endsOn, responseDate, years, 65)
```

## 追加情報

* [オブジェクトの作成](./creating-objects.md)
* [オブジェクトへのフィールドの追加](./adding-fields-to-objects.md)
* [カスタムバリデーションの追加](./adding-custom-validations.md)
