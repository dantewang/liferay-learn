# アカウントによるオブジェクトデータへのアクセス制限

{bdg-secondary}`Liferay 7.4 U58+/GA58+`

複数のビジネス・アカウント [accounts](../../../../users-and-permissions/accounts.md) があるシナリオでは、アカウント別にオブジェクト・エントリへのアクセスを制限したい場合があります。 これを行うには、カスタムオブジェクトがアカウントシステムオブジェクトとの有効な [関連](../relationships/defining-object-relationships.md) を持っている必要があり、入力データの制限にこの関連を使用するようにカスタムオブジェクトを構成する必要があります。 設定が完了すると、カスタムオブジェクトにエントリーを追加する人は、アカウントを選択する必要があります。 このアカウントがエントリーのオーナーになります。 [Account Restriction and User Roles](#account-restriction-and-user-roles) を参照して、ロールの種類がどのようにエントリへのアクセスを制御するか学んでください。

![Restrict access to custom object entries by account.](./restricting-access-to-object-data-by-account/images/01.png)

```{important}
アカウント制限はドラフトオブジェクトに対してのみ設定できます。[公開](../creating-objects.md#publishing-object-drafts)後は、これらの設定を変更することはできません。
```

アカウント制限を設定するには、

1. _グローバルメニュー_ (![グローバルメニュー](../../../../images/icon-applications-menu.png))を開き、*［コントロールパネル］*タブで*［オブジェクト］*をクリックします。

1. アカウントシステムオブジェクトの編集を開始します。

1. アカウントオブジェクトを目的の下書きオブジェクトに関連付ける一対多の関連を追加します。 詳しくは [オブジェクト関係の定義](../relationships/defining-object-relationships.md) を参照。

   ![Relate the Account system object to the desired custom object.](./restricting-access-to-object-data-by-account/images/02.png)

1. オブジェクトページに戻り、目的のカスタムオブジェクトの編集を開始します。

1. Details "タブで "_Account Restriction_"を有効にし、使用するアカウント関係を選択します。

   ![Toggle Account Restriction to active and select the account relationship you want to use.](./restricting-access-to-object-data-by-account/images/03.png)

1. ［_保存_］をクリックします。

これにより、アカウント関連フィールドが必須となり、ユーザーはエントリーを作成する際にアカウントを選択する必要があります。 利用可能なアカウントオプションは、各ユーザーの 権限によって決定されます。 アカウント制限が有効になっている間のロール権限の構成については、 [アカウント制限とユーザロール](#account-restriction-and-user-roles) を参照してください。 エントリー作成後、選択されたアカウントはエントリーのオーナーとなり、変更することはできません。

## アカウント制限とユーザーロール

アカウントによるオブジェクトデータの制限を行った後、ユーザーの権限に従ってエントリーが表示されます。 標準ロール範囲での権限はすべてのオブジェクトデータに適用され、組織またはアカウント範囲での権限は特定のアカウントに適用されます。 例えば、ユーザーが閲覧権限がある標準ロールを持っている場合、すべてのアカウントのすべてのデータを閲覧することができます。 ただし、ユーザーが閲覧権限があるアカウントロールしか持っていない場合は、自分のアカウントに関連するオブジェクトデータしか閲覧できません。

| 権限範囲     | 説明                                                   |
| :------- | :--------------------------------------------------- |
| 標準ロール    | アカウントや組織ロールの権限による制限を受けることなく、すべてのオブジェクトデータに適用される権限です。 |
| 組織ロール    | 組織およびそのサブ組織に関連する特定のアカウントのオブジェクトデータに適用される権限です。        |
| アカウントロール | 特定のアカウントのオブジェクトデータに適用される権限です。                        |

アカウント制限のためのロールを設定する場合、以下の点を考慮してください。

* アカウント制限オブジェクトがロールUIに表示されるには、_ウィジェットの表示_を有効にし、パネルリンクを設定する必要があります。

* 通常のロールは`Accounts > Account Entry：オブジェクトエントリを作成するには、` View` 権限が必要です。 これは、標準ロールがアカウントや組織と関連付けられていないためです。 この権限がないと、標準ロールを持つユーザーは、エントリーの作成時にアカウントを選択することができません。

* 組織ロールがオブジェクト・エントリを作成するには、以下のパーミッションが必要です：ユーザーと組織 &rarr; 組織：Manage Accounts`と`Users and Organizations &rarr; Organization：サブ組織のアカウント管理`。 この権限がないと、組織ロールを持つユーザーは、エントリーの作成時にアカウントを選択することができません。

* 組織およびアカウントロールのユーザがカスタムオブジェクトにアクセスするには、`Access in Control Panel` (company-scoped) または `Access in Site` (site-scoped) 権限を付与する別の通常ロールを持つ必要があります。 詳細については、 [Object Application Permissions](../../understanding-object-integrations/permissions-framework-integration.md#application-permissions) を参照のこと。

```{important}
アカウントと組織のロールは、アカウント制限が有効なオブジェクトでのみサポートされます。

アカウント制限では、デフォルトのアカウントメンバーおよび組織のユーザーロールはサポートされていません。 これらのロールは、関連するオブジェクトデータへのアクセスを自動的に付与するものではありません。

ユーザーが、異なるアカウントロールとオブジェクト権限を持つ複数のアカウントに所属している場合、これらの権限は、ユーザーが所属する各アカウントに適用されます。
```

## ユースケース例：保険金請求権

下記の条件がある保険のシナリオを考えてみます。

* ビジネスアカウントユーザーは、他のアカウントで行われた保険請求を表示することなく、保険請求を公開する必要がある。

* カスタマーサクセスマネージャー（CSM）は、自分が管理しているアカウントからの保険請求を確認する必要がある。

* 請求管理者は、すべての保険請求を監視しなければならない。

これを実現するために、 アカウント制限を有効にした保険請求オブジェクト を作成します。 次に、CSMをグループ化するための組織を作成し、各組織を適切なビジネスアカウントと関連付けます。 最後に、以下の [アカウント](#account-role) 、 [組織](#organization-role) 、 [通常の](#regular-role) ロールを作成し、適切なユーザーに割り当てる。 クレームオブジェクトは会社単位なので、アカウントと組織のユーザーは、`Portal：コントロールパネルのメニューの表示`と`Claims：コントロールパネルへのアクセス`権限を付与します。 利便性のため、これらの権限をデフォルトのユーザーロールに割り当てることができます。

```{note}
この例では、各ロールはクレームエントリを作成できますが、組織と通常のロールにはその権限を付与する必要はありません。
```

### アカウントロール

アカウントのオブジェクトデータを作成および管理する権限をアカウントのユーザーに付与します。

| 権限                        | 説明                          |
| :------------------------ | :-------------------------- |
| Claims: View              | オブジェクトのアプリケーションページを表示します。   |
| クレーム > クレーム削除             | オブジェクトのエントリーを削除します。         |
| クレーム > クレーム：パーミッション       | 個々のオブジェクトエントリーの権限を表示・変更します。 |
| クレーム > クレーム：更新            | オブジェクトのエントリーを更新します。         |
| クレーム > クレームオブジェクトエントリーの追加 | オブジェクトエントリーを作成します。          |

```{important}
アカウントロールには、`Claims &rarr; Claim: View` リソース権限を割り当てないでください。 この権限は、標準的なロール行動を妨げる可能性があります。
```

### 組織ロール

組織とそのサブ組織に関連するすべてのアカウントのオブジェクトデータを作成および管理する権限を組織のユーザーに付与します。

| 権限                        | 説明                          |
| :------------------------ | :-------------------------- |
| Claims: View              | オブジェクトのアプリケーションページを表示します。   |
| クレーム > クレーム削除             | オブジェクトのエントリーを削除します。         |
| クレーム > クレーム：パーミッション       | 個々のオブジェクトエントリーの権限を表示・変更します。 |
| クレーム > クレーム：更新            | オブジェクトのエントリーを更新します。         |
| クレーム > クレーム：表示            | オブジェクトのエントリーを表示します。         |
| クレーム > クレームオブジェクトエントリーの追加 | オブジェクトエントリーを作成します。          |
| ユーザーと組織 > 組織アカウント管理       | 組織のアカウントを表示します。             |
| ユーザーと組織 > 組織サブ組織のアカウント管理  | サブ組織に関連するアカウントを表示します。       |

### 標準ロール

すべてのアカウントのオブジェクトデータを作成・管理する権限をユーザーに付与します。

| 権限                              | 説明                                                                                                    |
| :------------------------------ | :---------------------------------------------------------------------------------------------------- |
| アカウント > アカウント入力：表示              | アカウントエントリーへのアクセスを表示します。                                                                               |
| Portal: View Control Panel Menu | グローバル・メニューにアクセスする ( ![グローバル・メニュー](../../../../images/icon-applications-menu.png))。 |
| Claims: Access in Control Panel | グローバルメニューのオブジェクトにアクセスします.                                                                             |
| Claims: View                    | オブジェクトのアプリケーションページを表示します。                                                                             |
| クレーム > クレーム削除                   | オブジェクトのエントリーを削除します。                                                                                   |
| クレーム > クレーム：パーミッション             | 個々のオブジェクトエントリーの権限を表示・変更します。                                                                           |
| クレーム > クレーム：更新                  | オブジェクトのエントリーを更新します。                                                                                   |
| クレーム > クレーム：表示                  | オブジェクトのエントリーを表示します。                                                                                   |
| クレーム > クレームオブジェクトエントリーの追加       | オブジェクトエントリーを作成します。                                                                                    |

## 関連トピック

* [アカウント](../../../../users-and-permissions/accounts.md)
* [システムオブジェクトの拡張](../extending-system-objects.md)
* [オブジェクトの関係の定義](../relationships/defining-object-relationships.md)
* [カスタムオブジェクトからの口座データへのアクセス](./accessing-accounts-data-from-custom-objects.md)
* [役割と権限を理解する](../../../../users-and-permissions/roles-and-permissions/understanding-roles-and-permissions.md)
