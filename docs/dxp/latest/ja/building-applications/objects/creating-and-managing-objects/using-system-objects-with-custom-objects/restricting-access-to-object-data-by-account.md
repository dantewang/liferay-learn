# アカウントによるオブジェクトデータへのアクセス制限

{bdg-secondary}`Liferay 7.4 U58+/GA58+`

複数のビジネス[アカウント](../../../../users-and-permissions/accounts.md)があるシナリオでは、アカウントでオブジェクトエントリーへのアクセスを制限することができます。 これを行うには、カスタムオブジェクトがアカウントシステムオブジェクトとの有効な[関連](../relationships/defining-object-relationships.md)を持っている必要があり、入力データの制限にこの関連を使用するようにカスタムオブジェクトを構成する必要があります。 設定が完了すると、カスタムオブジェクトにエントリーを追加する人は、アカウントを選択する必要があります。 このアカウントがエントリーのオーナーになります。 ロール種類がエントリーへのアクセスを制御する方法については、 [アカウント制限とユーザーロール](#account-restriction-and-user-roles) を参照してください。

![カスタムオブジェクトエントリへのアクセスをアカウントごとに制限することができます。](./restricting-access-to-object-data-by-account/images/01.png)

```{important}
アカウント制限は、下書きオブジェクトにのみ設定できます。 [publishing](../creating-objects.md#publishing-object-drafts) 以降は、これらの設定を変更することができなくなります。
```

アカウント制限を設定するには、

1. **グローバルメニュー**（![Global Menu](../../../../images/icon-applications-menu.png)）を開き、 ［**コントロールパネル**］ タブに移動して、 ［**オブジェクト**］ をクリックします。

1. アカウントシステムオブジェクトの編集を開始します。

1. アカウントオブジェクトを目的の下書きオブジェクトに関連付ける一対多の関連を追加します。 詳細については、[オブジェクト関連の定義](../relationships/defining-object-relationships.md)を参照してください。

   ![アカウントシステムオブジェクトを目的のカスタムオブジェクトに関連付けます。](./restricting-access-to-object-data-by-account/images/02.png)

1. オブジェクトページに戻り、目的のカスタムオブジェクトの編集を開始します。

1. ［詳細］タブで、 ［**Account Restriction**］ を有効にし、使用するアカウント関連を選択します。

   ![アカウント制限をアクティブに切り替え、使用するアカウントリレーションシップを選択します。](./restricting-access-to-object-data-by-account/images/03.png)

1. ［**Save**］ をクリックします。

これにより、アカウント関連フィールドが必須となり、ユーザーはエントリーを作成する際にアカウントを選択する必要があります。 利用可能なアカウントオプションは、各ユーザーの 権限によって決定されます。 アカウント制限が有効な場合のロール権限の構成については、 [アカウント制限とユーザーロール](#account-restriction-and-user-roles) を参照してください。 エントリー作成後、選択されたアカウントはエントリーのオーナーとなり、変更することはできません。

## アカウント制限とユーザーロール

アカウントによるオブジェクトデータの制限を行った後、ユーザーの権限に従ってエントリーが表示されます。 標準ロール範囲での権限はすべてのオブジェクトデータに適用され、組織またはアカウント範囲での権限は特定のアカウントに適用されます。 例えば、ユーザーが閲覧権限がある標準ロールを持っている場合、すべてのアカウントのすべてのデータを閲覧することができます。 ただし、ユーザーが閲覧権限があるアカウントロールしか持っていない場合は、自分のアカウントに関連するオブジェクトデータしか閲覧できません。

| 許可範囲     | 説明                                                   |
|:-------- |:---------------------------------------------------- |
| 標準ロール    | アカウントや組織ロールの権限による制限を受けることなく、すべてのオブジェクトデータに適用される権限です。 |
| 組織ロール    | 組織およびそのサブ組織に関連する特定のアカウントのオブジェクトデータに適用される権限です。        |
| アカウントロール | 特定のアカウントのオブジェクトデータに適用される権限です。                        |

アカウント制限のためのロールを設定する場合、以下の点を考慮してください。

* 標準ロールには、 オブジェクトエントリーを作成するための`Accounts > Account Entry: View`権限が必要です。 これは、標準ロールがアカウントや組織と関連付けられていないためです。 この権限がないと、標準ロールを持つユーザーは、エントリーの作成時にアカウントを選択することができません。

* 組織ロールは、オブジェクトエントリーを作成するために次の権限を持っている必要があります：`User and Organizations &rarr; Organization: Manage Accounts`および`User and Organizations &rarr; Organization: Manage Suborganizations Accounts`。 この権限がないと、組織ロールを持つユーザーは、エントリーの作成時にアカウントを選択することができません。

* 組織およびアカウントロールユーザーがカスタムオブジェクトにアクセスするには、`Access in Control Panel` (company-scoped)もしくは`Access in Site`  (site-scoped)権限を付与する別の標準ロールを持つ必要があります。 詳しくは、 [オブジェクトアプリケーションの権限](../../understanding-object-integrations/permissions-framework-integration.md#application-permissions) を参照してください。

```{important}
アカウントと組織のロールは、アカウント制限が有効になっているオブジェクトでのみサポートされています。

アカウント制限では、デフォルトのアカウントメンバーおよび組織のユーザーロールはサポートされていません。 これらのロールは、関連するオブジェクトデータへのアクセスを自動的に付与するものではありません。

ユーザーが、異なるアカウントロールとオブジェクト権限を持つ複数のアカウントに所属している場合、これらの権限は、ユーザーが所属する各アカウントに適用されます。
```

## ユースケース例：保険金請求権

下記の条件がある保険のシナリオを考えてみます。

* ビジネスアカウントユーザーは、他のアカウントで行われた保険請求を表示することなく、保険請求を公開する必要がある。

* カスタマーサクセスマネージャー（CSM）は、自分が管理しているアカウントからの保険請求を確認する必要がある。

* 請求管理者は、すべての保険請求を監視しなければならない。

これを実現するために、 アカウント制限を有効にした保険請求オブジェクト を作成します。 次に、CSMをグループ化するための組織を作成し、各組織を適切なビジネスアカウントと関連付けます。 最後に、以下の [アカウント](#account-role) 、 [組織](#organization-role) 、 [通常](#regular-role) の役割を作成し、適切なユーザーに割り当てます。 保険請求オブジェクトは会社スコープなので、アカウントと組織のユーザーは、`Portal: View Control Panel Menu`および`Claims: Access in Control Panel`権限を付与する別の標準ロールも持っている必要があります。 利便性のため、これらの権限をデフォルトのユーザーロールに割り当てることができます。

```{note}
この例では、各ロールは特定請求エントリーを作成することができますが、組織と標準のロールにはその権限を付与する必要はありません。
```

### アカウントロール

アカウントのオブジェクトデータを作成および管理する権限をアカウントのユーザーに付与します。

| 権限                                | 説明                          |
|:--------------------------------- |:--------------------------- |
| Claims: View                      | オブジェクトのアプリケーションページを表示します。   |
| Claims > Claim: Delete            | オブジェクトのエントリーを削除します。         |
| Claims > Claim: Permissions       | 個々のオブジェクトエントリーの権限を表示・変更します. |
| Claims > Claim: Update            | オブジェクトのエントリーを更新します。         |
| Claims > Claims: Add Object Entry | オブジェクトエントリーを作成します。          |

```{important}
アカウントロールには、`Claims &rarr; Claim: View` リソース権限を割り当てないでください。 この権限は、標準的なロール行動を妨げる可能性があります。
```

### 組織ロール

組織とそのサブ組織に関連するすべてのアカウントのオブジェクトデータを作成および管理する権限を組織のユーザーに付与します。

| 権限                                                                      | 説明                          |
|:----------------------------------------------------------------------- |:--------------------------- |
| Claims: View                                                            | オブジェクトのアプリケーションページを表示します。   |
| Claims > Claim: Delete                                                  | オブジェクトのエントリーを削除します。         |
| Claims > Claim: Permissions                                             | 個々のオブジェクトエントリーの権限を表示・変更します. |
| Claims > Claim: Update                                                  | オブジェクトのエントリーを更新します。         |
| Claims > Claim: View                                                    | オブジェクトのエントリーを表示します。         |
| Claims > Claims: Add Object Entry                                       | オブジェクトエントリーを作成します。          |
| User and Organizations > Organization: Manage Accounts                  | 組織のアカウントを表示します。             |
| User and Organizations > Organization: Manage Suborganizations Accounts | サブ組織に関連するアカウントを表示します。       |

### 標準ロール

すべてのアカウントのオブジェクトデータを作成・管理する権限をユーザーに付与します。

| 権限                                | 説明                                                                                  |
|:--------------------------------- |:----------------------------------------------------------------------------------- |
| Accounts > Account Entry: View    | アカウントエントリーへのアクセスを表示します。                                                             |
| Portal: View Control Panel Menu   | グローバルメニュー（ ![Global Menu](../../../../images/icon-applications-menu.png) ）にアクセスします。 |
| Claims: Access in Control Panel   | グローバルメニューのオブジェクトにアクセスします.                                                           |
| Claims: View                      | オブジェクトのアプリケーションページを表示します。                                                           |
| Claims > Claim: Delete            | オブジェクトのエントリーを削除します。                                                                 |
| Claims > Claim: Permissions       | 個々のオブジェクトエントリーの権限を表示・変更します。                                                         |
| Claims > Claim: Update            | オブジェクトのエントリーを更新します。                                                                 |
| Claims > Claim: View              | オブジェクトのエントリーを表示します。                                                                 |
| Claims > Claims: Add Object Entry | オブジェクトエントリーを作成します。                                                                  |

## 関連トピック

* [アカウント](../../../../users-and-permissions/accounts.md)
* [システムオブジェクトの拡張](../extending-system-objects.md)
* [オブジェクトリレーションの定義](../relationships/defining-object-relationships.md)
* [カスタムオブジェクトからアカウントデータにアクセスする](./accessing-accounts-data-from-custom-objects.md)
* [ロールと権限について](../../../../users-and-permissions/roles-and-permissions/understanding-roles-and-permissions.md)
