# システムレベルでのSAMLの設定

ポータルインスタンスで SAML 認証を有効にする前に、システムレベルで構成して、これらのインスタンスで作業するための基礎を作る必要がある。 たとえば、ポータルインスタンスでSAMLを構成しているときに、ファイルシステムからドキュメントライブラリにキーストアを移動しなければならないことに気づくことはないだろう。 これでは、誰もが設定に頭を悩ませることになる。 システムレベルのオプションを先に設定するのがよいでしょう。

## キーストアマネージャーのターゲットを選ぶ

1. Liferay DXP に管理者資格でログインし、 _コントロールパネル_ &rarr; _システム設定_ &rarr; _セキュリティ_ &rarr; _SSO_ &rarr; _SAML KeyStoreManager 実装設定_.

1. _ファイルシステム_ （デフォルト）または _ドキュメントライブラリ_ のいずれかを選択します。

1. _アップデート_ をクリックします。

![ファイルシステム」または「ドキュメントライブラリ」のいずれかを選択します。](./configuring-saml-at-the-system-level/images/01.png)

必ずどちらかの場所にバックアップの設定をしてください。

## SAMLを設定する

デフォルトの設定がお使いのシステムに適切であることを確認します。

1. _コントロールパネル_ &rarr; _システム設定_ &rarr; _セキュリティ_ &rarr; _SSO_ &rarr; _SAML 設定_ にアクセスしてください。

1. キーストアのパスを設定します。 デフォルトでは、あなたの [Liferay Home](../../../reference/liferay-home.md) ディレクトリにあります。 ドキュメントライブラリをキーストアの場所として選択した場合、そのパスは現在のポータルインスタンスの `/saml/keystore.jks` にハードコードされており、ここに何かを入力しても何の効果もありません。

1. キーストアにアクセスするためのパスワードを設定します。

1. その他のオプション（下記参照）を確認し、適宜修正して、 _Save_ をクリックします。

設定できるオプションは様々です。

**キーストアタイプ。** キーストアタイプを設定します。 デフォルトは、 _jks_、つまりJava Key Storeです。 Java でサポートされている任意のオプション [を選択することができます](https://docs.oracle.com/en/java/javase/11/docs/specs/security/standard-names.html#keystore-types) 。

**SSO Session Check Interval（SSOセッションのチェック間隔）。** ここに入力した分ごとに、IdPは期限切れのセッションをチェックする必要があります。

**ランタイム・メタデータの更新間隔(Runtime Metadata Refresh Interval)。** ここに入力した秒数ごとにピアSAMLエンティティを更新する。

**Replay Cache Duration（リプレイキャッシュ期間）。** ここに入力したミリ秒数が経過した時点でIdPメッセージキャッシュエントリーを失効させる。 メッセージをキャッシュすることで、メッセージリプレイ攻撃から保護することができます。

**認証要求のチェック間隔。** SP は、期限切れの Authn リクエストがこの時間 (分) に達したときに削除します。

**Authn Request Maximum Age:** Authn リクエストが有効である時間をミリ秒単位で入力します。

**メッセージチェック間隔。** SP は、この分数より古い場合、IdP メッセージキャッシュから期限切れのエントリを削除する必要があります。

**Enable Identity Provider Role To Be Configured（アイデンティティプロバイダーロールを設定する）。** このボックスをチェックすると、この Liferay DXP インストール上のポータルインスタンスに IdP ロールを持たせることができます。 
