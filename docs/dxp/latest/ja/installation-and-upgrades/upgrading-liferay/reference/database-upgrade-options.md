# データベースアップグレードオプション

リリース、アップデート、フィックスパックなどでデータベーススキーマの変更がある場合、その変更を適用するためのオプションを知っておくと便利です。 ここでは、各スキーマ変更レベルのデータベースアップグレードオプションと、DXP/Portalインストールタイプで各アップグレードオプションを使用する際の一般的な手順をご紹介します。

データベースアップグレードオプションは次の通りです。

* [Docker image](../upgrade-basics/upgrading-via-docker.md): 新しいDXP/PortalのDockerイメージを実行する際に、以下の環境変数を使用して、設定されたデータベース上でデータベースアップグレードツールを自動実行します。

    ```bash
    -e LIFERAY_UPGRADE_PERIOD_DATABASE_PERIOD_AUTO_PERIOD_RUN=true
    ```

* [Gogo Shell](../upgrade-stability-and-performance/upgrading-modules-using-gogo-shell.md): サーバーの実行中に、Gogo Shellコマンドを実行して、モジュールのアップグレードをリストアップしたり、呼び出したりすることができます。 なお、コアデータベースのアップグレードには、Dockerイメージまたはデータベースアップグレードツールを使用する必要があります。

* [データベースアップグレードツール](../upgrade-basics/using-the-database-upgrade-tool.md): サーバーがオフラインの状態でも、データベースアップグレードツールを使用してコアおよびモジュールのデータベースのアップグレードを実行できます。

```{important}
DXP/Portalのデータベースをアップグレードするための補足説明です。 出発点として、DXP/Portalのアップグレード手順については、 [アップグレードの基本](../upgrade-basics.md) を参考にしてください。また、DXP/Portalのアップデートやフィックスパックの適用については、 [Liferay DXPインストールの管理](../../maintaining-a-liferay-installation.md) を参考にしてください。
```

## スキーマ変更レベルのデータベースアップグレードオプション

ここでは、リリース、アップデート、またはフィックスパックに含まれるデータベーススキーマの変更の種類と、それらの変更を適用するためのデータベースアップグレードオプションについて説明します。

| データベーススキーマの変更                            | データベースアップグレードオプション                                               |
|:---------------------------------------- |:---------------------------------------------------------------- |
| モジュールマイクロバージョン<br>(オプションのアップグレード)  | **Dockerイメージ<br>** Gogo Shell<br> * データベースアップグレードツール |
| モジュールメジャー/マイナーバージョン<br>(必須アップグレード) | **Dockerイメージ<br>** Gogo Shell<br> * データベースアップグレードツール |
| コアデータスキーマ(必須アップグレード)                     | **Dockerイメージ <br>** データベースアップグレードツール                       |

データベースのアップグレードは、対象となる新規インストールから行うことも、データベースのアップグレードに便利な別のインストールから行うこともできます。 例えば、アプリサーバーのLiferay WARの依存関係を使用している場合、新しいLiferay Dockerイメージを使用してデータベースをアップグレードし、新しいLiferay WARと依存関係をアプリサーバーにインストールし、アプリサーバーを再起動して新しいLiferayバージョンを実行することができます。

DXP/Portalのインストールには3つのタイプがあります。

1. [Liferay Dockerイメージ](../../installing-liferay/using-liferay-docker-images.md)
1. [Liferay Tomcat バンドル](../../installing-liferay/installing-a-liferay-tomcat-bundle.md)
1. [アプリケーションサーバー(app server) + Liferay WAR(WAR) + 依存関係](../../installing-liferay/installing-liferay-on-an-application-server/installing-on-tomcat.md)

ここでは、各インストールタイプでデータベースのアップグレードオプションを使用するための一般的な手順を説明します。

## Liferay Dockerイメージのデータベースアップグレード

ここでは、DockerイメージまたはTomcat Bundleを使用して、新規のLiferay Dockerイメージのデータベースアップグレードを実行するためのプロセス概要を示します。

| Dockerイメージオプション | Tomcatバンドルオプション | アップグレードプロセスの概要                                                                                                                      |
|:--------------- |:--------------- |:----------------------------------------------------------------------------------------------------------------------------------- |
| &#10004;        |                 | 1. 新しいイメージの設定を行います。<br>2. アップグレード環境変数を有効にして実行してください。<br>3. アップグレードが正常に完了したら、新規イメージの新規コンテナにデータベースを設定します（アップグレードを有効にしない）。 |
|                 | &#10004;        | 1. Liferay Tomcatバンドルの設定を行います。<br>2. バンドルからデータベースアップグレードツールを実行します。<br>3. アップグレードが正常に完了したら、新規のDockerイメージ上でデータベースを構成します。  |

## Liferay Tomcatバンドルのデータベースアップグレード

ここでは、DockerイメージまたはTomcatバンドルを使用して、新規のLiferay Tomcatバンドルのデータベーススアップグレードを実行するためのプロセス概要を示します。

| Dockerイメージオプション | Tomcatバンドルオプション | アップグレードプロセスの概要                                                                                                                  |
|:--------------- |:--------------- |:------------------------------------------------------------------------------------------------------------------------------- |
| &#10004;        |                 | 1. 新しいDockerイメージの設定を行います。<br>2. アップグレード環境変数を有効にして実行してください。<br>3. アップグレードが正常に完了したら、Liferay Tomcatバンドル上でデータベースを構成します。 |
|                 | &#10004;        | 1. 新しいLiferay Tomcatバンドルの設定を行います。<br>2. データベースアップグレードツールの実行                                                               |

## アプリケーションサーバインストール時のデータベースアップグレード

ここでは、DockerイメージまたはTomcatバンドルを使用して、アプリケーションサーバー上に新規のLiferay DXP/Portalをインストールする際に、データベースのアップグレードを実行するためのプロセス概要を示します。

| Dockerイメージオプション | Tomcatバンドルオプション | アップグレードプロセスの概要                                                                                                                                            |
|:--------------- |:--------------- |:--------------------------------------------------------------------------------------------------------------------------------------------------------- |
| &#10004;        |                 | 1. 新しいDockerイメージの設定を行います。<br>2. アップグレード環境変数を有効にして実行してください。<br>3. アップグレードが正常に完了したら、新しいLiferay WARとOSGiの依存関係をアプリケーションサーバーにインストールします。            |
|                 | &#10004;        | 1. 新規のLiferay Tomcatバンドルの設定を行います。<br>2. バンドルからデータベースアップグレードツールを実行します。<br>3. アップグレードが正常に完了したら、新規のLiferay WARとOSGiの依存関係をアプリケーションサーバーにインストールします。 |

## 追加情報

* [アップグレードの基本](../upgrade-basics.md)
* [Liferay DXPインストールの管理](../../maintaining-a-liferay-installation.md)
