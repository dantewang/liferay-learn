# OAuth 2のスコープ

OAuth 2.0では、アプリケーションはユーザーデータの制限されたサブセットへのアクセスを許可されます。 これらは **スコープ** と呼ばれます（Liferayスコープと混同しないでください）。 これらは2つの方法で作成されます。

* 管理者が、スコープのサービスアクセスポリシーを作成する。

* 開発者が、JAX-RSエンドポイントを作成する。 デフォルトでは、スコープはJAX-RSエンドポイントでサポートされるHTTP動詞に基づいて生成されます。 特殊なアノテーションは、この動作をオーバーライドし、特定のスコープを登録します。

## JSONWSサービスのスコープの作成

スコープを作成する最も一般的な方法は、`OAUTH2_`という名前のプレフィックスが付いた[サービス・アクセス・ポリシー](../../installation-and-upgrades/securing-liferay/securing-web-services/setting-service-access-policies.md)を作成することです。 この命名規則により、ポリシーはOAuthアプリケーションの設定画面にスコープとして表示されます。

たとえば、アプリケーションがメールアドレスを取得するためにユーザーのプロファイル情報にアクセスする必要があるとします。 アプリケーションにアクセスを許可するには、 ［**コントロールパネル**］ &rarr; ［**セキュリティ**］ &rarr; ［**サービス・アクセス・ポリシー**］ に移動し、次の図に示すポリシーを作成します。

![サービス・アクセス・ポリシーは、OAuth 2.0アプリケーションのスコープを定義します。](./oauth2-scopes/images/01.png)

このポリシーはデフォルトのポリシーではなく、`UserService`の1つのメソッドにのみアクセス権を付与することに注意してください。 これは、サービスビルダーによって生成されたJSONWS Webサービスです。 次のURLで、インストールで使用可能なすべてのサービスのリストを表示できます。

```
http://［host］:［port］/api/jsonws/
```

ポリシーを作成し、`OAUTH2_`プレフィックスを使用して名前を付けると、OAuth2管理の ［**Scopes**］ タブに表示されます。

![適切なプレフィックスを使用して名前が付けられたスコープが、アプリケーション設定の［Scopes］タブに表示されます。](./oauth2-scopes/images/02.png)

これを選択して、アプリケーションを保存できます。

## 認証ページの作成

このステップはオプションです。 ユーザーは自分のアカウントへのアクセスを承認するためのインターフェイスを必要とし、1つは自動的に提供されます。 ただし、ページをカスタマイズする場合は、サイトに認証ページを作成できます。

1. **Global Menu**(![Global Menu](../../images/icon-applications-menu.png)) を開き、 **Control Panel** タブをクリックし、 **Instance Settings** &rarr; **Security** &rarr; **OAuth 2** &rarr; **Authorize Screen** を開く。

   この画面では、Authorize Screen の URL フィールドをこのデフォルト値で表示します。 `/?p_p_id=com_liferay_oauth2_provider_web_internal_portlet_OAuth2AuthorizePortlet&p_p_state=maximized`. 内部ポートレットに相当します。

   ![OAuth 2 Authorize 画面を設定します。](./oauth2-scopes/images/03.png)

1. 認証画面に必要なURL（例： `/authorize`）を設定します。

1. 目的のサイトに移動し、 **Site Menu**(![Site Menu](../../images/icon-product-menu.png)) を開き、 **Site Builder** を展開し、 **Pages** をクリックします。

1. コレクションサイドバーの隣にある ［**Add**］ ボタン（![追加ボタン](../../images/icon-add.png)) ボタンを押して、 **ページ** を選択します。

   ```{note}
   Liferay DXP 7.3 以前の場合、Private Page を作成します。 プライベートページには、認証されたユーザーのみがアクセスできます。
   ```

1. ［**Full Page Application**］ タイプを選択します。

1. ステップ2で設定したのと同じ名前をページに付けます。

1. ［**ナビゲーションメニューウィジェットに表示しない**］ のスイッチをONにします。 このページをサイトのナビゲーションに表示させないためです。

1. 次に表示されるページで、フレンドリURLがステップ2で設定したURLと一致することを確認します。

1. ［**フルページアプリケーション**］ の下で、 ［**アプリケーションの認証リクエスト**］ を選択します。

1. ［**保存**］ をクリックします。

ユーザーは、デフォルトまたはカスタムUIを使用して、認証プロセスを実行できます。 UIを作成し、スコープについて理解したので、次にアプリケーションでの認証プロセスを作成します。
