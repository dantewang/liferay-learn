# SAML 관리자

SAML 관리자 패널은 SAML 인스턴스를 구성하기에 가장 좋은 곳입니다. 인스턴스 설정 대신 이를 사용하여 SAML 관리 환경을 간소화하십시오.

SAML Admin을 사용하여 ID 공급자(IdP), 서비스 공급자 및 서비스 공급자 연결을 구성할 수 있습니다. 액세스하려면 **글로벌 메뉴**(![Global Menu](../../../../images/icon-applications-menu.png)) &rarr; **제어판** &rarr; **SAML Admin** 을 클릭하십시오.

## 일반 탭

일반 탭에는 역할에 관계없이 SAML에 적용되는 옵션이 표시됩니다.

**활성화됨:** 모든 항목을 구성한 후 SAML 인증을 활성화하려면 이 상자를 선택합니다.

**SAML 역할:** ID 공급자 또는 서비스 공급자 중에서 SAML 역할을 선택합니다.

**엔터티 ID:** 이 SAML 엔터티(IdP 또는 SP)의 고유 식별자입니다. 최대 1024자까지 가능합니다.

인증서 및 개인 키 섹션에는 여기 또는 [시스템 설정](./configuring-saml-at-the-system-level.md)에서 키 저장소를 설정할 때 생성된 키가 표시됩니다. 여기에서 새 인증서를 생성하거나 다른 곳에서 만든 인증서를 가져와 인증서를 교체할 수 있으며 인증서를 다운로드하여 다른 곳에서 가져올 수도 있습니다.

자동 생성된 인증서를 교체해야 하는 경우 다음과 같이 간단합니다.

1. **인증서 교체** 을 클릭합니다.

1. 인증서 만들기 탭은 기본적으로 활성화되어 있습니다. 키에 필요한 필드를 작성하십시오.

1. 완료되면 **저장** 을 클릭합니다.

이제 새 키의 세부 정보가 표시됩니다.

키를 이미 생성한 경우 해당 키를 Liferay DXP로 가져오려면 [PKCS #12](https://en.wikipedia.org/wiki/PKCS_12) 아카이브에 저장해야 합니다.

1. **인증서 교체** 을 클릭합니다.

1. **인증서 가져오기** 탭을 클릭합니다.

1. 키 저장소의 비밀번호를 입력하고 PKCS #12 키 파일을 업로드 영역에 놓거나 파일 선택기를 사용하여 선택하십시오.

이제 키를 가져왔습니다.

## 서비스 공급자

1. SAML 역할 필드에서 **서비스 공급자** 역할을 선택합니다.

1. 인증서 및 개인 키 섹션은 SAML용 키 저장소를 생성하기 위한 것입니다. **인증서 생성** 을 클릭하고 다음 정보를 입력합니다.

    * 일반 이름(성과 이름)
    * 조직 이름
    * 조직 단위의 이름
    * 도시 또는 지역의 이름
    * 주 또는 도의 이름
    * 당신의 국가의 이름
    * 키 저장소가 유효한 상태로 유지되는 기간(키 저장소가 만료되기까지의 기간)
    * 키 알고리즘(RSA가 기본값임)
    * 키 길이(비트)(기본값은 2048)
    * 키 암호

    키 저장소에는 파일 시스템 스토리지(기본값)와 문서 및 미디어 스토리지의 두 가지 스토리지 옵션이 있습니다. 기본적으로 인증서는 암호화에 `SHA256` 알고리즘을 사용하고 `MD5` 및 `SHA256`를 통해 지문 및 자체 서명됩니다. 필수 정보를 모두 입력했으면 **저장** 을 클릭합니다.

1. **저장** 을 클릭한 후 인증서에 대한 정보를 보거나 인증서를 다운로드할 수 있는지 확인하십시오. 가능하다면 성공적으로 키 저장소를 생성한 것입니다. 키 저장소를 생성하면 추가 옵션이 나타납니다. 세 가지 탭이 있습니다.

    **일반** : SAML SP를 활성화 또는 비활성화하고 필요한 키 저장소를 관리합니다.

    **Service Provider** : 이 탭은 SP에 대한 기본 및 고급 구성을 관리합니다.

    **ID 공급자 연결** : 이 탭은 IdP에 대한 연결을 관리합니다. 여러 IdP 연결이 있을 수 있습니다.

1. 암호화 인증서를 생성할 수도 있습니다. 어설션 암호화를 위한 별도의 키입니다. 어설션을 암호화하려면 이에 대한 키를 생성해야 합니다. 절차는 위의 2단계에서 인증서를 생성하는 것과 완전히 동일합니다.

1. 다음으로 ID 제공자 연결을 구성해야 합니다. **ID 공급자 연결** 탭을 클릭합니다. ID 공급자의 이름을 입력하고 엔터티 ID를 입력한 다음 메타데이터 URL을 입력합니다. 이미 별도의 Liferay DXP 설치를 식별 공급자로 구성한 경우 다음 정보를 입력합니다.

    * 이름: **라이프레이 IdP**
    * 엔터티 ID: [IdP의 ID]
    * Clock Skew: SP와 IdP 사이의 허용 오차를 밀리초 단위로 설정합니다.
    * Force Authn: IdP가 컨텍스트에 관계없이 재인증을 강제해야 하는지 여부입니다.
    * 메타데이터 URL: `http://localhost:8080/c/portal/saml/metadata` (이 URL을 먼저 테스트)
    * 이름 식별자 형식: [설정](./saml-settings.md)참조.
    * 속성 매핑: [설정](./saml-settings.md)참조.
    * Keep Alive URL: [설정](./saml-settings.md)참조.

    ```{important}
    Liferay Connector to SAML 2.0 앱은 SAML IdP 메타데이터 파일 *또는* 실제(업로드된) SAML 메타데이터 XML 파일에 대한 URL *중 하나* 사용을 지원합니다. *메타데이터 URL* 필드에 입력된 값은 메타데이터 URL이 있고 지정된 메타데이터 XML 파일이 없는 경우에만 데이터베이스에 유지됩니다. 그렇지 않으면 Liferay DXP는 원본 메타데이터 URL을 데이터베이스에 보관합니다. 이 동작은 메타데이터 URL이 지정되면 데이터베이스에 항상 메타데이터 URL이 저장되도록 합니다. 이렇게 하면 이전에 입력한 메타데이터 URL 또는 해당 형식을 잊은 경우 표시된 메타데이터 URL을 보고 표시된 메타데이터 URL을 수정하거나 메타데이터 XML 파일을 지정하여 이전에 저장된 메타데이터 URL을 덮어쓸 수 있습니다.
    ```

1. 마지막으로 인증서 및 개인 키 정보를 저장하고 ID 공급자 연결을 구성한 후 일반 탭 상단의 **사용** 상자를 선택하고 **저장** 을 클릭합니다. Liferay는 이제 SAML 서비스 제공업체입니다!

SAML 서비스 공급자 세션은 애플리케이션 서버의 일반 세션에 연결되어 있습니다. 애플리케이션 서버의 세션 만료는 서비스 공급자의 세션을 종료하지만 싱글 로그아웃을 시작하지는 않습니다.

## 서비스 공급자 구성

서비스 공급자 탭에는 다음과 같은 몇 가지 구성 옵션이 표시됩니다.

**어설션 서명 필요:** 전체 SAML 메시지 외에 IdP가 SAML 어설션에 개별적으로 서명하도록 요구하려면 이 상자를 선택합니다.

**Clock Skew:** SP와 IdP 간의 시간 차이에 대한 허용 오차를 밀리초 단위로 설정합니다.

**LDAP 가져오기 사용:** 이 SP의 인스턴스 설정에서 선언된 LDAP 서버에서 사용자 속성을 가져오려면 이 확인란을 선택합니다.

**Sign Authn Requests?:** SP로 구성된 경우 Authn 요청에 디지털 서명합니다.

**서명 메타데이터?:** 피어 SAML 엔터티로 전송된 메타데이터에 서명합니다.

**SSL 필수:** 모든 SAML 메시지 전송에 SSL을 요구하려면 이 상자를 선택하십시오. 피어로 전송되는 메타데이터의 모든 URL에는 `https` 프로토콜 접두사가 붙습니다.

**로그인 포틀릿 표시 허용:** 로그인 요청과 일치하는 SAML IdP가 없을 때 로그인 포틀릿이 표시되도록 허용합니다. 이 시나리오의 사용자는 Liferay DXP에 로컬로 로그인합니다.

```{Important}
SAML 응답 자체가 서명되는 한 개별 어설션에 서명할 필요가 없습니다. SP와 IdP는 항상 'https'를 통해 통신해야 전송 수준에서 암호화됩니다. 

Liferay DXP에는 서명된 SAML 응답이 필요합니다. 메시지 가로채기(man-in-the-middle) 공격이 가능하고 어설션의 정보가 중요하다고 생각되면 서명하고 암호화할 수 있습니다. 
```

여러 IdP 연결을 추가할 수 있습니다. 다른 ID 공급자를 추가하려면 **ID 공급자 추가** 을 다시 클릭하고 다른 공급자에 대한 세부 정보를 입력합니다. 사용자가 로그인할 때 자격 증명 공급자를 선택하라는 메시지가 표시되므로 사용자가 알아볼 수 있도록 공급자 이름을 지정해야 합니다.

## 클러스터 환경에서 Liferay DXP를 SAML 서비스 공급자로 설정

Liferay Connector to SAML 2.0 앱을 클러스터 환경을 위한 SSO 솔루션으로 사용할 수 있습니다. 다중 노드 클러스터가 로드 밸런서 뒤에 있는 경우 모든 노드를 SP로 활성화하고 동일한 키 저장소 관리자를 공유해야 합니다.

Filesystem Keystore Manager를 사용하는 경우(기본값):

1. 위와 같이 SAML 서비스 공급자로 [Liferay 클러스터](../../../setting-up-liferay/clustering-for-high-availability/clustering-for-high-availability.md) 의 각 노드를 구성합니다.

1. 첫 번째 노드에서 나머지 노드로 키 저장소 파일(기본적으로`[Liferay Home]/data/keystore.jks`)을 복사합니다. 이 파일은 SAML 공급자 앱에서 생성한 Java 키 저장소입니다. 키 저장소에는 SAML 커넥터 앱에서 관리하는 유효하거나 자체 서명된 인증서가 포함되어 있습니다.

1. 서비스 제공자 메타데이터가 URL 또는 XML 파일로 사용되도록 생성되었는지 확인하십시오. 동일한 데이터베이스 백엔드로 인해 메타데이터는 모든 노드에서 동일합니다. IdP의 요청은 로드 밸런서를 통과합니다.

1. 이 시점에서 모든 노드는 동일한 SAML SP 구성을 가지며 각 노드는 웹 요청에 응답하고 SAML 프로토콜을 처리할 수 있습니다. SSO 솔루션을 테스트하려면 로드 밸런서를 통해 Liferay에 로그인하고 여러 사이트의 몇 페이지로 이동한 다음 로그아웃합니다.

문서 라이브러리 키 저장소 관리자를 사용하는 경우 키 저장소 파일이 모든 노드에서 공유하는 데이터베이스에 저장되므로 2단계를 건너뜁니다.

이제 Liferay DXP를 SAML ID 공급자 또는 서비스 공급자로 구성하는 방법을 알았습니다. 클러스터 환경에서 SAML을 구성하는 방법도 알고 있습니다.

## 아이덴터티 제공자

ID 공급자(IdP)의 SAML 역할을 선택한 경우 여기에서 구성할 수 있습니다. 이러한 필드는 동일한 항목을 구성할 수 있는 [인스턴스 설정](./configuring-saml-at-the-instance-level) 의 유사한 필드에 해당합니다.

**서명 메타데이터?:** 피어 SAML 엔터티로 전송된 메타데이터에 서명합니다.

**SSL 필수:** 모든 SAML 메시지 전송에 SSL을 요구하려면 이 상자를 선택하십시오. 피어로 전송되는 메타데이터의 모든 URL에는 `https` 프로토콜 접두사가 붙습니다.

**Authn 요청 서명 필요:** 보내는 서비스 공급자가 각 Authn 요청에 서명하도록 요구하려면 이 상자를 선택합니다. 대부분의 경우 이 기능을 활성화해야 합니다.

**세션 최대 기간:** IdP에서 관리하는 SSO 세션이 지속되는 시간(초)입니다.

**세션 유휴 시간 초과:** 유휴 세션이 만료되기 전에 지속되는 시간(초)입니다.

## 서비스 제공자 연결

이 인터페이스를 사용하여 하나 이상의 서비스 공급자 연결을 구성할 수 있습니다. 시작하려면 **서비스 제공자 추가** 를 클릭하십시오. 양식을 작성하고 완료되면 **저장** 을 클릭합니다.

**이름:** SP의 이름을 지정합니다. 이것은 설명적인 이름일 뿐입니다. 구성에서는 사용되지 않습니다.

**엔터티 ID:** 이 SP가 연결하는 IdP의 엔터티 ID를 여기에 입력합니다. 서비스 공급자 메타데이터에 선언된 엔터티 ID와 일치해야 합니다.

**활성화됨:** 서비스 공급자 연결을 활성화하려면 이 상자를 선택합니다.

**어설션 수명:** 어설션이 유효해야 하는 섹션 수를 입력합니다.

**강제 암호화:** SP가 어설션 암호화를 위한 공개 키를 제공하지 않는 경우 싱글 사인온을 중단합니다.

**메타데이터:** 서비스 제공자 메타데이터 XML 파일에 대한 URL을 제공하거나 서비스 제공자 메타데이터 XML 파일을 수동으로 업로드합니다. URL을 제공하면 XML 파일이 검색되고 업데이트를 위해 주기적으로 폴링됩니다. 업데이트 간격은 초 수를 지정하는 런타임 메타데이터 새로 고침 간격( `구성` 파일을 사용하는 경우`saml.metadata.refresh.interval` ) 속성을 사용하여 시스템 설정에서 구성할 수 있습니다. URL로 메타데이터 XML 파일 가져오기에 실패하면 서비스 공급자 연결을 활성화할 수 없습니다. ID 공급자 서버가 URL을 통해 메타데이터에 액세스할 수 없는 경우 XML 파일을 수동으로 업로드할 수 있습니다. 이 경우 메타데이터 XML 파일은 자동으로 업데이트되지 않습니다.

**이름 식별자 형식:** SAML 응답에 사용되는 이름 식별자 형식을 선택합니다. 서비스 제공자가 받을 것으로 예상하는 것에 따라 이것을 설정하십시오. Liferay 서비스 공급자의 경우 이메일 주소 이외의 선택 항목은 이름 식별자가 화면 이름을 참조함을 나타냅니다. 형식은 Liferay ID 공급자에게 특별한 의미가 없습니다. `NameID` 값은 이름 식별자 속성에 의해 정의됩니다. 다음 옵션을 참조하십시오.

**이름 식별자 속성 이름:** 이는 Liferay `사용자` 개체의 속성을 지정하여 `NameID` 값으로 사용합니다. 가능한 값에는 `emailAddress`, `screenName` 및 `uuid`가 포함됩니다. 이름 앞에 `static:` 또는 `expando:`을 붙일 수 있습니다. 접두사 `static`을 사용하는 경우 값은 `static:`뒤에 오는 값입니다. 접두사 `expando`을 사용하는 경우 값은 `expando:`뒤에 지정되는 모든 사용자 정의 필드입니다. 예를 들어 `expando:SSN` 은 이름이 `SSN`인 `사용자` 사용자 정의 필드를 조회합니다.

**속성 사용:** 어설션 속성을 포함하고 해결합니다.

**Attributes Namespace Enabled:** 다음과 같이 속성 이름을 네임스페이스로 지정하려면 이 상자를 선택합니다.

    urn:liferay:user:expando: urn:liferay:user: urn:liferay:groups: urn:liferay:organizationRole: urn:liferay:organization: urn:liferay:roles: urn:liferay:siteRole: urn:liferay:userGroupRole: urn:liferay:userGroups:

**속성:** 어설션에 포함할 속성 목록을 한 줄에 하나씩 입력합니다. 각 행은 구문 분석되는 표현식입니다. 예:

    organizations organizationRoles roles siteRoles userGroups static:[attributeName]=[attributeValue] expando:[userCustomFieldName]

전체 네임스페이스는 속성 이름에 따라 다릅니다. 특성 네임스페이스가 유용할 수 있습니다. 다른 네임스페이스의 속성 이름이 충돌할 수 있는 경우 이를 사용하십시오. 예를 들어 `expando:user` 대 `urn:liferay:roles:user`입니다.

**Keep Alive URL:** 사용자가 Liferay IdP를 통해 여러 Liferay SP 인스턴스에 로그인한 경우 세션 중 하나에 대해 브라우저 창을 열어 두는 한 해당 세션을 활성 상태로 유지할 수 있습니다. SP가 Liferay DXP인 경우에만 구성합니다. URL은 `https://[SP 호스트 이름]/c/portal/saml/keep_alive`입니다.
