# 주문 분할

{bdg-secondary}`사용 가능한 Liferay DXP 7.4 U84+/GA84+`

```{important}
주문 분할은 현재 릴리스 기능 플래그 뒤에 있습니다. 자세한 내용은 [릴리스 기능 플래그](https://learn.liferay.com/web/guest/w/dxp/system-administration/configuring-liferay/feature-flags#release-feature-flags)를 참조하세요. 
```

주문에 여러 제품 라인이 있거나 여러 공급업체에서 주문 처리하는 제품이 있는 경우가 있습니다. 이러한 경우 주문을 독립적으로 처리되는 하위 주문으로 분할할 수 있습니다.

주문 분할은 주문 품목의 카탈로그를 기반으로 고객 주문을 하나 이상의 공급업체 주문으로 분할합니다. 공급업체 역할과 함께 작동합니다. 자세한 내용은 [공급업체 역할](../suppliers/supplier-role.md) 을 참조하세요.

## 주문 분할 개체 액션 만들기

주문 분할 개체 액션을 생성하는 방법에는 두 가지가 있습니다. 첫 번째 방법은 상거래 주문 시스템 개체에서 수동으로 개체 작업을 생성하는 것입니다. 다른 방법은 미리 구성된 개체 작업을 자동으로 생성하는 커머스 상태 확인을 사용하는 것입니다.

### 주문 분할 개체 액션 수동으로 만들기

1. *글로벌 메뉴* (![Global Menu](../../images/icon-applications-menu.png))를 열고 *제어판* &rarr; *개체*로 이동합니다 .

1. *상거래 주문* 을 선택하고 *작업*을 클릭합니다.

1. *클릭* 추가 (![Add](../../images/icon-add.png)):

   **작업 레이블:** 카탈로그별 주문 분할

   **액션 이름:** splitOrderByCatalog

1. *활성* 토글을 사용하여 작업을 활성화합니다.

1. *액션 빌더* 탭을 클릭합니다.

1. 트리거 아래의 드롭다운에서 *주문 상태 업데이트 시* 를 선택합니다.

1. 조건에서 토글을 활성화하고 표현식을 입력합니다: `orderStatus = 10`

   각 주문 상태는 정수에 해당합니다. 다른 주문 상태를 사용하려면 다음 정수 중 하나를 사용합니다:

   | 주문 상태. | 정수 값 |
   |:------ |:---- |
   | 열려있는   | 2    |
   | 진도안에   | 6    |
   | 미정     | 1    |
   | 처리중    | 10   |
   | 배송됨    | 15   |
   | 완료하는   | 0    |
   | 취소됨    | 8    |
   | 부분 배송  | 14   |
   | 파악에    | 20   |

   표현식 빌더를 사용하여 주문 분할을 특정 주문 유형이나 채널로 제한할 수도 있습니다. 아래 예시를 참조하세요:

   `orderTypeId = 12345 AND channelId = 67890 AND orderStatus = 10`

   이 표현식은 채널 `67890` 의 모든 주문이 처리 상태로 이동할 때 주문 유형 ID `12345` 로 분할합니다.

1. 작업 아래의 드롭다운에서 *카탈로그별 주문 분할* 을 선택합니다.

1. *저장*을 클릭합니다.

### 상태 확인을 사용하여 주문 분할 개체 액션 만들기

상태 검사를 실행하여 커머스 주문 시스템 개체와 연결된 개체 작업을 생성할 수도 있습니다.

1. *글로벌 메뉴* (![Global Menu](../../images/icon-applications-menu.png))를 열고 *커머스* &rarr; *상태 확인*으로 이동합니다.

1. *카탈로그별 주문 분할 작업* 상태 확인을 찾습니다.

1. *문제 해결*을 클릭합니다.

   ![상태 확인을 사용하여 상거래 주문 개체 작업을 자동으로 생성합니다.](./order-splitting/images/01.png)

   이렇게 하면 상거래 주문 시스템 개체에 대한 개체 작업이 생성됩니다. 주문 분할 작업은 상태 확인을 통해 생성하면 비활성화됩니다. 활성화하려면,

1. (![Global Menu](../../images/icon-applications-menu.png))를 열고 *제어판* &rarr; *개체*으로 이동합니다.

1. *상거래 주문* 을 선택하고 *작업*을 클릭합니다.

1. 이미 생성된 개체 액션이 표시되어야 합니다. 이를 선택하고 *활성* 토글을 사용하여 작업을 활성화합니다.

이렇게 하면 서로 다른 카탈로그의 제품이 포함된 모든 주문에 대해 주문 분할이 가능합니다.

## 주문 분할 개념

### 고객 주문

고객이 여러 카탈로그의 제품을 포함하는 주문을 합니다. 고객이 각각 다른 카탈로그에서 두 개의 제품을 주문하는 경우 *주문됨* 페이지에 단일 항목으로 표시됩니다. 고객 주문입니다. 이 주문은 *주문* 페이지에서 주문을 수락한 경우에만 분할됩니다.

### 공급업체 주문

*글로벌 메뉴* (![Global Menu](../../images/icon-applications-menu.png))를 열고 *커머스* &rarr; *주문*으로 이동합니다. 고객 주문에 대한 단일 항목을 확인할 수 있습니다.

주문을 선택하고 *주문 수락*을 클릭합니다. 이제 상거래 주문 개체에 대한 개체 작업이 실행됩니다. 주문 페이지로 돌아가면 이제 고객 주문에 대한 항목 1개와 공급업체 주문에 대한 항목 2개 등 3개의 항목이 표시됩니다. 공급업체 주문은 자체 채널에 연결됩니다.

공급업체는 자신의 채널에 연결된 공급업체 주문만 보고 관리할 수 있습니다. 세 가지 카탈로그의 원래 주문에 세 가지 제품이 있는 경우 총 4개의 항목(고객 주문 1개 + 공급업체 주문 3개)이 있습니다. 고객은 발주된 주문 페이지에서 공급업체 주문을 볼 수 없습니다.

### 주문 레벨 분할 할인

기본 주문 분할 규칙을 사용하는 경우, 분할 주문을 이행하는 모든 공급업체에게 공평하게 적용되도록 원래 주문 대비 공급업체 주문의 백분율 값을 사용하여 공급업체 간에 할인을 분할합니다. 이는 주문 총액 및 소계 할인에 적용됩니다. 특정 주문 품목에 대한 할인은 변경되지 않습니다. 아래 그림을 참조하세요:

![할인은 원래 주문과 비교한 공급업체 주문의 백분율 값을 사용하여 분할됩니다.](./order-splitting/images/02.png)

원래 주문의 총 금액은 $100이며 고정 주문 할인은 $10입니다. 두 공급업체 A와 B가 각각 $25와 $75의 가치로 분할합니다. 할인은 원래 주문에 대한 공급업체 주문의 백분율 값에 따라 이 두 공급업체에 분배됩니다. 여기서 공급업체 A의 주문 금액 $25는 원래 주문 금액의 25%를 차지합니다. 따라서 공급업체 A의 주문은 원래 할인의 25%에 해당하는 할인을 받습니다.

```{note}
위의 예시는 고정 할인에만 적용됩니다. 백분율 할인의 경우 각 공급업체 주문에서 백분율 금액이 차감됩니다. 예를 들어 주문에 10% 할인이 있는 경우 각 공급업체 주문은 10% 할인을 받습니다. 
```

## 분할 주문 처리

고객 관점에서 볼 때 정보가 표시되는 방식은 변경되지 않습니다. 관리자만 공급업체 주문이 분할된 후 발주된 주문 화면에서 공급업체 주문을 볼 수 있습니다. 고객은 자신이 주문한 원본 주문만 볼 수 있고 공급업체는 자신의 공급업체 주문만 볼 수 있습니다.

공급업체 주문의 품목에 대한 업데이트는 고객 주문의 특정 품목에도 다시 전파됩니다. 예를 들어 한 공급업체가 주문을 배송하고 배송 중 하나에 대한 추적 번호를 업데이트하면 해당 제품에 대한 고객에게 이 번호가 표시됩니다. 주문 상태가 처리 중 상태에서 부분 배송으로 이동합니다. 두 공급업체 주문이 모두 배송되면 원래 고객 주문이 완료됩니다.

## 관련 주제

* [공급업체](../suppliers.md)