# 주문 분할

{bdg-secondary}`liferay DXP 7.4 U84+/GA84+`

```{important}
주문 분할은 현재 릴리스 기능 플래그 뒤에 있습니다. 자세한 내용은 [릴리스 기능 플래그](https://learn.liferay.com/web/guest/w/dxp/system-administration/configuring-liferay/feature-flags#release-feature-flags) 을 읽어보세요.
```

주문에 여러 제품 라인이 있거나 여러 공급자가 처리하는 제품이 있는 경우도 있습니다. 이러한 경우 주문을 독립적으로 처리된 하위 주문으로 분할할 수 있습니다.

주문 분할은 주문 항목의 카탈로그를 기준으로 고객 주문을 하나 이상의 공급업체 주문으로 분할합니다. 이는 공급업체 역할과 함께 작동합니다. 자세한 내용은 [공급업체 역할](../suppliers/supplier-role.md) 을 참조하세요.

## 주문 분할 개체 작업 생성

주문 분할 개체 작업을 생성하는 방법에는 두 가지가 있습니다. 첫 번째 방법은 상거래 주문 시스템 개체에 개체 작업을 수동으로 생성하는 것입니다. 다른 방법은 사전 구성된 개체 작업을 자동으로 생성하는 상거래 상태 확인을 사용하는 것입니다.

### 주문 분할 개체 작업을 수동으로 생성

1. **전역 메뉴**(![전역 메뉴](../../images/icon-applications-menu.png))를 열고 **제어판** &rarr; **개체** 로 이동합니다.

1. **상거래 주문** 을 선택하고 **작업** 을 클릭하세요.

1. **추가**(![추가](../../images/icon-add.png))를 클릭합니다.

   **작업 라벨:** 카탈로그별로 주문 분할

   **작업 이름:** SplitOrderByCatalog

1. **활성** 토글을 사용하여 작업을 활성화합니다.

1. **Action Builder** 탭을 클릭하세요.

1. 트리거 아래 드롭다운에서 **주문 상태 업데이트 시** 를 선택합니다.

1. 조건에서 토글을 활성화하고 `orderStatus = 10` 표현식을 입력합니다.

   각 주문 상태는 정수에 해당합니다. 다른 주문 상태를 사용하려면 다음 정수 중 하나를 사용하세요.

   | 주문 상태. | 정수값 |
   | :----- | :-- |
   | 열려있는   | 2   |
   | 진도안에   | 6   |
   | 미정     | 1   |
   | 처리중    | 10  |
   | 배송됨    | 15  |
   | 완료하는   | 0   |
   | 취소됨    | 8   |
   | 부분 배송  | 14  |
   | 파악에    | 20  |

   또한 표현식 빌더를 사용하여 주문 분할을 특정 주문 유형이나 채널로 제한할 수도 있습니다. 아래 예를 참조하세요.

   `orderTypeId = 12345 AND channelId = 67890 AND orderStatus = 10`

   이 표현식은 처리 상태로 이동할 때 주문 유형 ID가 '12345'인 채널 '67890'의 모든 주문을 분할합니다.

1. 작업 아래 드롭다운에서 **카탈로그별로 주문 분할** 을 선택합니다.

1. **저장** 을 클릭하세요.

### 상태 확인을 사용하여 주문 분할 객체 작업 생성

상태 확인을 실행하여 상거래 주문 시스템 개체와 관련된 개체 작업을 생성할 수도 있습니다.

1. **글로벌 메뉴**(![글로벌 메뉴](../../images/icon-applications-menu.png))를 열고 **Commerce** &rarr; **Health Check** 로 이동합니다.

1. **카탈로그 작업별로 주문 분할** 상태 확인을 찾습니다.

1. **문제 해결** 을 클릭하세요.

   ![Create the commerce order object action automatically using the health check.](./order-splitting/images/01.png)

   이는 상거래 주문 시스템 개체에 대한 개체 작업을 생성합니다. 상태 확인을 통해 생성되면 주문 분할 작업이 비활성화됩니다. 활성화하려면,

1. (![전역 메뉴](../../images/icon-applications-menu.png))를 열고 **제어판** &rarr; **개체** 로 이동합니다.

1. **상거래 주문** 을 선택하고 **작업** 을 클릭하세요.

1. 이미 생성된 개체 작업이 표시되어야 합니다. 이를 선택하고 **활성** 토글을 사용하여 작업을 활성화합니다.

이를 통해 서로 다른 카탈로그의 제품이 포함된 모든 주문에 대한 주문 분할이 가능해집니다.

## 주문 분할 개념

### 고객 주문

고객 주문은 여러 카탈로그의 제품을 포함하는 고객에 의해 이루어집니다. 고객이 각각 다른 카탈로그에 있는 두 가지 제품을 주문한 경우 해당 주문은 **주문한 항목** 페이지에 단일 항목으로 표시됩니다. 고객의 주문입니다. 이 주문은 **주문** 페이지에서 주문을 수락한 경우에만 분할됩니다.

### 공급업체 주문

**글로벌 메뉴**(![글로벌 메뉴](../../images/icon-applications-menu.png))를 열고 **Commerce** &rarr; **Orders** 로 이동합니다. 고객 주문에 대한 단일 항목을 볼 수 있습니다.

주문을 선택하고 **주문 수락** 을 클릭하세요. 이제 상거래 주문 개체에 대한 개체 작업이 실행됩니다. 주문 페이지로 돌아가면 이제 세 개의 항목이 표시됩니다. 하나는 고객 주문에 대한 항목이고 두 개는 공급업체 주문에 대한 항목입니다. 공급업체 주문은 자체 채널에 연결됩니다.

공급업체는 자신의 채널에 연결된 공급업체 주문만 보고 관리할 수 있습니다. 3개의 서로 다른 카탈로그의 원래 주문에 3개의 제품이 있는 경우 총 4개의 항목이 있습니다(고객 주문 1개 + 공급업체 주문 3개). 고객은 주문 페이지에서 공급업체 주문을 볼 수 없습니다.

### 주문 수준 할인 분할

기본 주문 분할 규칙을 사용하는 경우 분할 주문을 이행하는 모든 공급업체에 공평하도록 원래 주문과 비교하여 공급업체 주문의 백분율 값을 사용하여 공급업체 간에 할인이 분할됩니다. 이는 주문총액 및 소계할인에 적용됩니다. 특정 주문 품목에 대한 할인은 변경되지 않습니다. 아래 그림을 참조하세요.

![Discount is split using the percentage value of the supplier order in comparison to the original order.](./order-splitting/images/02.png)

원래 주문의 총 가치는 $100이고 고정 주문 할인은 $10입니다. 이 금액은 두 공급업체 A와 B 사이에 분할되며 가격은 각각 $25와 $75입니다. 할인은 원래 주문에 대한 공급자 주문의 백분율 값을 기준으로 두 공급자 간에 분할됩니다. 여기서 공급업체 A의 주문 가격 $25는 원래 주문 가격의 25%를 차지합니다. 따라서 공급자 A의 주문은 원래 할인의 25%에 해당하는 할인을 받습니다.

```{note}
위 그림은 고정 할인에만 유효합니다. 백분율 할인의 경우 각 공급업체 주문에서 백분율 금액이 공제됩니다. 예를 들어 주문에 10% 할인이 있는 경우 각 공급업체 주문에는 10% 할인이 적용됩니다.
```

## 분할 주문 이행

고객 관점에서 보면 정보가 표시되는 방식에는 변화가 없습니다. 관리자만 분할된 주문 화면에서 공급업체 주문을 볼 수 있습니다. 고객은 자신이 제출한 원래 주문만 볼 수 있고, 공급자는 자신의 공급자 주문만 볼 수 있습니다.

공급자 주문의 품목에 대한 업데이트는 고객 주문의 특정 품목에도 다시 전파됩니다. 예를 들어, 한 공급업체가 주문을 배송하고 배송 중 하나에 대한 추적 번호를 업데이트하면 해당 제품에 대한 고객이 이를 볼 수 있습니다. 주문 상태가 처리 중에서 부분 배송으로 변경됩니다. 두 공급업체 주문이 모두 배송되면 원래 고객 주문이 완료됩니다.

## 관련 주제

* [공급업체](../suppliers.md) 
