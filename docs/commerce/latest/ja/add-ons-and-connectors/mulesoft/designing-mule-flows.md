# Muleのフローをデザインする

[Liferay Connector to MuleSoft](./configuring-the-mulesoft-connector.md)を設定した後、Muleフローの構築を開始することができます。 これらの操作は、LiferayのOpenAPIエンドポイントで利用可能です。

* レコードの作成
* レコードの削除
* 記録取得
* 記録更新
* バッチ - レコードのエクスポート
* バッチ - レコードのインポート - 作成
* バッチ - インポートレコード - 削除
* バッチ - レコードのインポート - 更新

大規模なデータセットを扱う場合は、Liferayのバッチオペレーションを使用して、より迅速にデータを送信し、処理します。

## レコード作成操作

この操作は、選択された OpenAPI 3.0 文書の POST メソッドで処理されるすべてのエンドポイントを公開するものである。 Liferay の API Explorer `http://[host]:[port]/o/api` を、Liferay MuleSoft コネクタがサポートするさまざまな操作のリファレンスとして使用します。 また、コネクタの設定でエンドポイントからOpenAPIドキュメントを使用することも可能です。

![products エンドポイントは、HTTP POST を使用して新しい製品を作成します。](./designing-mule-flows/images/01.png)

エンドポイントを選択すると、コネクターは自動的に関連するメタデータを生成します。 そして、入力パラメータを指定することができます。 入力パラメータはすべての Liferay RESTful ウェブサービスをサポートしますが、すべてのエンドポイントに必要なわけではありません。

| パラメータ名   | 種類     | 説明                                  | 必須                  |
|:-------- |:------ |:----------------------------------- |:------------------- |
| エンドポイント  | 文字列    | create 操作をサポートするエンドポイントのドロップダウンリスト。 | はい                  |
| レコード     | オブジェクト | 作成するオブジェクト                          | はい                  |
| パス・パラメータ | オブジェクト | パスパラメータ値付きマップ                       | あり（エンドポイントに要求された場合） |
| クエリパラメータ | オブジェクト | クエリパラメータ値付きマップ                      | いいえ                 |

![SalesforceからLiferayに商品をインポートするフローでproductsエンドポイントを使用します。](./designing-mule-flows/images/02.png)

上記の手順で、フロー内の他の操作を設定し、使用することができます。

## 一括エクスポート操作

この操作により、1回のリクエストで指定したエンティティの全レコードを取得することができます。 レコードがたくさんあるときに便利です。 レコード数が少ない場合は、 **Get Records** オペレーションを使用してください。

![複数のレコードをエクスポートするには、Batch - Export Records オペレーションを使用します。](./designing-mule-flows/images/03.png)

一括エクスポート操作を設定するには、クラス名ドロップダウンを使用してエクスポートするエンティティを選択します。 一度選択すると、コネクタは関連する出力メタデータを動的に生成します。 必要であれば、Field names 入力を使用して、エクスポートされるエンティティに含めるフィールドを指定することができます。 フィールド名はカンマで区切らなければならない。 また、バッチ処理ロジックで必要な場合は、 **サイトID** パラメータを指定することができます。

| パラメータ名 | 種類  | 説明                                                                                                                                                             | 必須  |
|:------ |:--- |:-------------------------------------------------------------------------------------------------------------------------------------------------------------- |:--- |
| クラス名   | 文字列 | エクスポートされたエンティティのクラス名                                                                                                                                           | はい  |
| サイトID  | 文字列 | [siteId](https://learn.liferay.com/dxp/latest/ja/headless-delivery/consuming-apis/consuming-rest-services.html#identify-the-site-containing-the-data) クエリパラメータ | いいえ |
| フィールド名 | 文字列 | エクスポートされるエンティティフィールドのカンマ区切りリスト                                                                                                                                 | いいえ |

このフローを実行すると、JSON配列が生成され、別のアプリケーションに変換して読み込むことができます。

## 一括インポート操作

一括インポート操作には、作成、削除、更新の3種類があります。 各操作はエンティティのセットをインポートしますが、Liferayのバッチエンジンはそれらを異なる方法で処理します。 下図は、インポート作成一括操作のイメージです。

![レコードを一括してインポートするには、Batch - Import Records オペレーションを使用します。](./designing-mule-flows/images/04.png)

一括インポート操作を設定するには、まず、 **クラス名** ドロップダウンを使用して、インポートするエンティティを選択します。 一度選択すると、コネクターは関連する入力メタデータを動的に生成します。 次に、 **Record** フィールドを使用して、エンティティオブジェクトの JSON 配列を送信します。 必要に応じて、 **Field name mappings** ドロップダウンを使用して、異なるシステムの関連エンティティ間でフィールド名をマッピングします。

```{note}
Transform Message* モジュールを使用してソースとデスティネーション・システム間でエンティティ・ フィールドをマッピングしている場合は、*Field name mappings* を空のままにすることができます。
```

| パラメータ名      | 種類     | 説明                     | 必須  |
|:----------- |:------ |:---------------------- |:--- |
| クラス名        | 文字列    | インポートされたエンティティのクラス名    | はい  |
| フィールド名の対応付け | オブジェクト | フィールド名のマッピング定義が入力されている | いいえ |
| レコード        | オブジェクト | エンティティオブジェクトのJSON配列    | はい  |

利用可能なすべての操作と関連する入力パラメータを表示するには、 [Liferay MuleSoft Connector Technical Reference](https://github.com/liferay/liferay-etl-mulesoft/blob/master/docs/liferay-connector-tech-ref.adoc) をご覧ください。

## 追加情報

* [MuleSoftコネクタの設定](./configuring-the-mulesoft-connector.md)
* [Liferay MuleSoft Connector テクニカルリファレンス](https://github.com/liferay/liferay-etl-mulesoft/blob/master/docs/liferay-connector-tech-ref.adoc)
